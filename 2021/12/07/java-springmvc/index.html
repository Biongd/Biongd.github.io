<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="java," />










<meta name="description" content="springmvc">
<meta property="og:type" content="article">
<meta property="og:title" content="java-spring">
<meta property="og:url" content="http://yoursite.com/2021/12/07/java-springmvc/index.html">
<meta property="og:site_name" content="悦来客栈">
<meta property="og:description" content="springmvc">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211224144249.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211224144404.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211224144442.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211224144545.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211224144614.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221100834.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221102356.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221102755.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221103732.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221105054.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221105104.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221105352.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221105417.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221105509.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221110357.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221110416.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221155647.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221161705.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221161850.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221162023.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221164111.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221164509.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221191927.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221202400.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221204252.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221204449.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221204338.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211221204528.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211223200941.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20211223202826.png">
<meta property="article:published_time" content="2021-12-07T06:54:02.000Z">
<meta property="article:modified_time" content="2022-01-04T06:45:52.733Z">
<meta property="article:author" content="xujunjie&#39;blog">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/biongd/img/raw/master/img/20211224144249.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","display_updated":true,"offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/12/07/java-springmvc/"/>





  <title>java-spring | 悦来客栈</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">悦来客栈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">learn and better</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/12/07/java-springmvc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xujunjie'blog">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悦来客栈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">java-spring</h1>
        

        <div class="post-meta">
          <span class="post-time">
              
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-12-07T14:54:02+08:00">
                2021-12-07
              </time>
            
            
                <span class="post-updated">
                     &nbsp; | &nbsp; 更新于
                     <time itemprop="dateUpdated" datetime="2022-01-04T14:45:52+08:00" content="2022-01-04">
                          2022-01-04
                     </time>
                 </span>
             

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java%E5%AD%A6%E4%B9%A0-JVM-spring-Maven-IDEA-web-%E9%9B%86%E5%90%88-%E6%95%B0%E7%BB%84-String%E4%B8%93%E9%A2%98-%E5%89%8D%E7%AB%AF-web%E5%AE%9E%E6%88%98-%E5%9F%BA%E7%A1%80-redis-%E6%A6%82%E5%BF%B5/" itemprop="url" rel="index">
                    <span itemprop="name">java学习-JVM.spring.Maven.IDEA.web.集合/数组/String专题.前端.web实战.基础.redis.概念.</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>springmvc</p>
<a id="more"></a>
<h1 id="1-如何不用骨架创建springmvc项目"><a href="#1-如何不用骨架创建springmvc项目" class="headerlink" title="1. 如何不用骨架创建springmvc项目"></a>1. 如何不用骨架创建springmvc项目</h1><ol>
<li><p>添加web框架</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211224144249.png" alt="image-20211224144249574"></p>
</li>
<li><p>修改web文件的path</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211224144404.png" alt="image-20211224144403982"></p>
</li>
<li><p>修改xml的path</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211224144442.png" alt="image-20211224144442118"></p>
<p>注意后面要粘贴</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211224144545.png" alt="image-20211224144545150"></p>
</li>
<li><p><img src="https://gitee.com/biongd/img/raw/master/img/20211224144614.png" alt="image-20211224144614220"></p>
</li>
</ol>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221100834.png" alt="image-20211221100827099"></p>
<h2 id="3-6-配置视图解析器"><a href="#3-6-配置视图解析器" class="headerlink" title="3.6 配置视图解析器"></a>3.6 配置视图解析器</h2><p>在springmvc.xml配置文件中添加视图解析器的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"internalResourceViewResolver"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>annotation-driven是一种简写形式，也可以手动配置替代这种简写形式，简写形式可以让初学者快速应用默认配置方案。</p>
<p>该注解会自动注册DefaultAnnotationHandlerMapping与AnnotationMethodHandlerAdapter两个bean，是springMVC为@Controller分发用户请求所必须的，解决了</p>
<p>@Controller注解使用的前提配置。</p>
<p>同时它还提供了：数据绑定支持，@NumberFormatannotation支持，@DateTimeFormat支持，@Valid支持，读写XML的支持（JAXB，读写JSON的支持）。我们处理响应ajax请求时，就使用到了对json的支持（配置之后，在加入了jackson的core和mapper包之后，不写配置文件也能自动转换成json）。<img src="https://gitee.com/biongd/img/raw/master/img/20211221102356.png" alt="image-20211221102356707"></p>
<p>图中的两个bean的配置就是对controller注解的类和方法的配置</p>
<h1 id="4-SpringMVC工作流程"><a href="#4-SpringMVC工作流程" class="headerlink" title="4. SpringMVC工作流程"></a>4. SpringMVC工作流程</h1><h2 id="4-1-工作流程分析"><a href="#4-1-工作流程分析" class="headerlink" title="4.1 工作流程分析"></a>4.1 工作流程分析</h2><p><img src="https://gitee.com/biongd/img/raw/master/img/20211221102755.png" alt="image-20211221102755220"></p>
<ol>
<li><p>用户通过浏览器发送请求到前端控制器DispatcherServlet。</p>
</li>
<li><p>前端控制器直接将请求转给处理器映射器HandleMapping。</p>
</li>
<li><p>处理器映射器HandleMapping会根据请求，找到负责处理该请求的处理器，并将其封装为处理器执行链HandlerExecutionChina后返回给前端控制器DispatcherServlet。</p>
</li>
<li><p>前端控制器DispatcherServlet根据处理器执行链中的处理器，找到能够执行该处理器的处理器适配器HandlerAdaptor。</p>
<p><strong>注意：这里的处理器适配器可以采用构建HandlerAdaptor对象的方式，也可以采用使用注解的方式“@controller”</strong></p>
</li>
<li><p>处理器适配器HandlerAdaptor调用执行处理器Controller。</p>
</li>
<li><p>处理器Controller将处理结果及要跳转的视图封装到一个对象 ModelAndView 中，并将其返回给处理器适配器HandlerAdaptor。</p>
</li>
<li><p>处理器适配器直接将结果返回给前端控制器DispatcherServlet。</p>
</li>
<li><p>前端控制器调用视图解析器，将 ModelAndView 中的视图名称封装为视图对象。</p>
</li>
<li><p>视图解析器ViewResolver将封装了的视图View对象返回给前端控制器DispatcherServlet.</p>
</li>
<li><p>前端控制器DispatcherServlet调用视图对象，让其自己进行渲染，即进行数据填充，形成响应对象。</p>
</li>
<li><p>前端控制器响应浏览器。</p>
</li>
</ol>
<h2 id="SpringMVC组件"><a href="#SpringMVC组件" class="headerlink" title="SpringMVC组件"></a>SpringMVC组件</h2><ol>
<li><p>DispatcherServlet：前端控制器,也称为中央控制器或者核心控制器。</p>
<p>用户请求的入口控制器，它就相当于 mvc 模式中的c，DispatcherServlet 是整个流程控制的中心，相当于是 SpringMVC 的大脑，由它调用其它组件处理用户的请求，DispatcherServlet 的存在降低了组件之间的耦合性。SpringMVC框架提供的该核心控制器需要我们在web.xml文件中配置。</p>
</li>
<li><p>HandlerMapping：处理器映射器<br>HandlerMapping也是控制器，派发请求的控制器。我们不需要自己控制该类，但是他是springmvc运转历程中的重要的一个控制器。 HandlerMapping负责根据用户请求找到 Handler 即处理器（也就是我们所说的 Controller），SpringMVC 提供了不同的映射器实现不同的映射方式，例如：配置文件方式，实现接口方式，注解方式等，在实际开发中，我们常用的方式是注解方式。</p>
</li>
<li><p>Handler：处理器<br>Handler 是继 DispatcherServlet 前端控制器的后端控制器，在DispatcherServlet 的控制下 Handler 对具体的用户请求进行处理。由于 Handler 涉及到具体的用户业务请求，所以一般情况需要程序员根据业务需求开发 Handler。（这里所说的 Handler 就是指我们的 Controller）</p>
</li>
<li><p>HandlAdapter：处理器适配器<br>通过 HandlerAdapter 对处理器进行执行，这是适配器模式的应用，通过扩展处理器适配器，支持更多类型的处理器,调用处理器传递参数等工作。</p>
</li>
<li><p>ViewResolver：视图解析器<br>ViewResolver 负责将处理结果生成 View 视图，ViewResolver 首先根据逻辑视图名解析成物理视图名称，即具体的页面地址，再生成 View 视图对象，最后对 View 进行渲染将处理结果通过页面展示给用户。 SpringMVC 框架提供了很多的 View 视图类型，包括：jstlView、freemarkerView、pdfView 等。一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由程序员根据业务需求开发具体的页面。</p>
</li>
</ol>
<h1 id="5-RequestMapping-注解"><a href="#5-RequestMapping-注解" class="headerlink" title="5. @RequestMapping 注解"></a>5. @RequestMapping 注解</h1><h2 id="5-1-RequestMapping出现的位置"><a href="#5-1-RequestMapping出现的位置" class="headerlink" title="5.1@RequestMapping出现的位置"></a>5.1@RequestMapping出现的位置</h2><p>过@RequestMapping 注解定义了处理器对于请求的映射规则。该注解可以定义在类上，也可以定义在方法上，但是含义不同。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221103732.png" alt="image-20211221103732875"></p>
<p>一个@Controller 所注解的类中，可以定义多个处理器方法。当然，不同的处理器方法所匹配的 URI 是不同的。这些不同的 URI 被指定在注解于方法之上的@RequestMapping 的value 属性中。<strong>但若这些请求具有相同的 URI 部分，则这些相同的 URI，可以被抽取到注解在类之上的RequestMapping 的 value属性中</strong>。此时的这个 URI 表示模块的名称。URI 的请求是相对于 Web 的根目录。在类的级别上的注解会将一个特定请求或者请求模式映射到一个控制器之上。之后你还可以另外添加方法级别的注解来进一步指定到处理方法的映射关系。</p>
<p>示例：修改TeamController.java 如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.controller;</span><br><span class="line"><span class="keyword">import</span> com.kkb.service.TeamService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ClassName: TeamController</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wanglina</span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"team"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeamController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeamService teamService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"add.do"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">addTeam</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"TeamController----addTeam---"</span>);</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.setViewName(<span class="string">"team/add"</span>);<span class="comment">// 映射成为物理资源路径：/jsp/team/add.jsp</span></span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"update.do"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">updateTeam</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"TeamController----updateTeam---"</span>);</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.setViewName(<span class="string">"team/update"</span>);<span class="comment">//映射成为物理资源路径：/jsp/team/update.jsp</span></span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"hello.do"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"TeamController----add---"</span>);</span><br><span class="line">        teamService.add();</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"teamName"</span>,<span class="string">"湖人"</span>);<span class="comment">//相当于</span></span><br><span class="line">        request.setAttrubuite(<span class="string">"teanName"</span>,<span class="string">"湖人"</span>);</span><br><span class="line">        mv.setViewName(<span class="string">"index"</span>);<span class="comment">//未来经过springmvc的视图解析器处理，转换成物理资源路径,</span></span><br><span class="line">        相当于request.getRequestDispatcher(<span class="string">"index.jsp"</span>).forward();</span><br><span class="line">        <span class="comment">//经过InternalResourceViewResolver对象的处理之后加上前后缀就变为了</span></span><br><span class="line">        /jsp/index.jsp</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221105054.png" alt="image-20211221105054435"></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221105104.png" alt="image-20211221105104868"></p>
<h2 id="5-2-指定请求提交方式"><a href="#5-2-指定请求提交方式" class="headerlink" title="5.2 指定请求提交方式"></a>5.2 指定请求提交方式</h2><p>@RequestMapping的method属性，用来对被注解方法所处理请求的提交方式进行限制，即只有满足method 属性指定的提交方式的请求，才会执行该被注解方法。Method 属性的取值为 RequestMethod 枚举常量。常用的为 RequestMethod.GET 与RequestMethod.POST，分别表示提交方式的匹配规则为 GET 与 POST 提交。<br><img src="https://gitee.com/biongd/img/raw/master/img/20211221105352.png" alt="image-20211221105352775"></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221105417.png" alt="image-20211221105417899"></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221105509.png" alt="image-20211221105509833"></p>
<p>此时要想完成update.do的请求就只能通过form表单进行页面跳转的方式进行访问了</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"/team/update.do"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    &lt;button type="submit"&gt;post提交到/team/update.do&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h2 id="5-3-补充url-pattern解析"><a href="#5-3-补充url-pattern解析" class="headerlink" title="5.3 补充url-pattern解析"></a>5.3 补充url-pattern解析</h2><h3 id="5-3-1-url-pattern解析"><a href="#5-3-1-url-pattern解析" class="headerlink" title="5.3.1 url-pattern解析"></a>5.3.1 url-pattern解析</h3><p>在web.xml配置SpringMVC的前端控制器时有这个节点。这个节点中的值一般有两种写法：</p>
<p>1、<em>.do<br>在没有特殊要求的情况下，SpringMVC 的前端控制器 DispatcherServlet 的常使用后辍匹配方<br>式，可以写为</em>.do 或者 <em>.action, </em>.mvc 等。<br>2、/<br>可以写为/，但是 DispatcherServlet 会将向静态内容—例如.css、.js、图片等资源的获取请求<br>时，也会当作是一个普通的 Controller 请求。前端控制器会调用处理器映射器为其查找相应的处理器。肯<br>定找不到啊，所以所有的静态资源获取请求也均会报 404 错误。</p>
<p>案例：</p>
<p>在index.jsp页面添加一张图片，如果节点中的值为*.do,图片可以正常访问，但是如果为/就不能访问。<br>1、项目中添加图片，同时修改index.jsp页面</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221110357.png" alt="image-20211221110357439"></p>
<p>2、修改web.xml</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221110416.png" alt="image-20211221110416549"></p>
<p>3、此时访问图片无法显示</p>
<h3 id="5-3-2-静态资源访问"><a href="#5-3-2-静态资源访问" class="headerlink" title="5.3.2 静态资源访问"></a>5.3.2 静态资源访问</h3><p>如果的值配置为/后，静态资源可以通过以下两种方法解决。</p>
<ol>
<li><p>使用&lt; mvc:default-servlet-handler/ &gt;<br>在springmvc的配置文件中添加如下内容：</p>
<p><code>&lt;mvc:default-servlet-handler/&gt;</code></p>
<p>声 明 了 <mvc:default-servlet-handler /> 后 ，springmvc框架会在容器中创建DefaultServletHttpRequestHandler处理器对象。该对象会对所有进入 </p>
<p>DispatcherServlet的URL进行检查。如果发现是静态资源的请求，就将该请求转由Web应用服务器默认的Servlet 处理。一般的服务器都有默认的 Servlet。例如咱</p>
<p>们使用的Tomcat服务器中，有一个专门用于处理静态资源访问的 Servlet 名叫 DefaultServlet。其<code>&lt;servlet-name/&gt;</code>为default。可以处理各种静态资源访问请</p>
<p>求。该Servlet注册在 Tomcat 服务器的 web.xml 中。在 Tomcat安装目录/conf/web.xml。</p>
</li>
<li><p>使用 &lt; mvc:resources/ &gt;<br>在springmvc的配置文件中添加如下内容：</p>
<p><code>&lt;mvc:resources location=&quot;/images/&quot; mapping=&quot;/images/**&quot; /&gt;</code></p>
<p>location: 表示静态资源所在目录。当然，目录不要使用/WEB-INF/及其子目录。</p>
<p>mapping: 表示对该资源的请求。注意，后面是两个星号<code>**</code>。</p>
</li>
</ol>
<h1 id="6、处理器方法的参数"><a href="#6、处理器方法的参数" class="headerlink" title="6、处理器方法的参数"></a>6、处理器方法的参数</h1><p>处理器方法可以包含以下四类参数，这些参数会在系统调用时由系统自动赋值.所以我们可以在方法内直<br>接使用。以下是这四类参数:<br>HttpServletRequest<br>HttpServletResponse<br>HttpSession<br>请求中所携带的请求参数<br>准备工作：创建新的控制器ParamController.java和前端页面hello.jsp页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"param"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>直接使用方法的参数逐个接收</li>
<li>使用对象接收多个参数</li>
<li>请求参数和方法名称的参数不一致</li>
<li>使用HttpServletRequest 对象获取参数</li>
<li>直接使用URL地址传参</li>
<li>获取日期类型的参数</li>
<li>获取数组类型的参数</li>
<li>获取集合类型的参数<br>SpringMVC不支持直接从参数中获取对象集合类型，需要将对象集合封装到实体类中。</li>
</ol>
<p>案例源码：<br><strong>修改实体类Team.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.pojo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer teamId;</span><br><span class="line">    <span class="keyword">private</span> String teamName;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Team&#123;"</span> +</span><br><span class="line">        <span class="string">"teamId="</span> + teamId +</span><br><span class="line">        <span class="string">", teamName='"</span> + teamName + <span class="string">'\''</span> +</span><br><span class="line">        <span class="string">", location='"</span> + location + <span class="string">'\''</span> +</span><br><span class="line">        <span class="string">", createTime="</span> + createTime +</span><br><span class="line">        <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//省略set get方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>创建实体类QueryVO.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.vo;</span><br><span class="line"><span class="keyword">import</span> com.kkb.pojo.Team;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryVO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Team&gt; teamList;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Team&gt; <span class="title">getTeamList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teamList;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeamList</span><span class="params">(List&lt;Team&gt; teamList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.teamList = teamList;	</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-1-前端页面hello-jsp"><a href="#6-1-前端页面hello-jsp" class="headerlink" title="6.1 前端页面hello.jsp"></a>6.1 前端页面hello.jsp</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;hello&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h3&gt;8、获取集合类型的参数&lt;/h3&gt;</span><br><span class="line">    &lt;form action=<span class="string">"/param/test08"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队名称<span class="number">1</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称<span class="number">2</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称<span class="number">3</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">        &lt;form action=<span class="string">"/param/test09"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队id1：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamList[0].teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队id2：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamList[1].teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队id3：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamList[2].teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称<span class="number">1</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamList[0].teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称<span class="number">2</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamList[1].teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称<span class="number">3</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamList[2].teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;h3&gt;7、获取数组类型的参数&lt;/h3&gt;</span><br><span class="line">        &lt;form action=<span class="string">"/param/test07"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队名称<span class="number">1</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称<span class="number">2</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称<span class="number">3</span>：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;h3&gt;6、获取日期类型的参数&lt;/h3&gt;</span><br><span class="line">    &lt;form action=<span class="string">"/param/test06"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队id：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队位置：&lt;input type=<span class="string">"text"</span> name=<span class="string">"location"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        创建日期：&lt;input type=<span class="string">"text"</span> name=<span class="string">"createTime"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">        控制器ParamController.java</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;h3&gt;5、直接使用URL地址传参&lt;/h3&gt;</span><br><span class="line">    &lt;h3&gt;4、使用HttpServletRequest 对象获取参数&lt;/h3&gt;</span><br><span class="line">        &lt;form action=<span class="string">"/param/test04"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队id：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队位置：&lt;input type=<span class="string">"text"</span> name=<span class="string">"location"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;h3&gt;3、请求参数和方法名称的参数不一致&lt;/h3&gt;</span><br><span class="line">        &lt;form action=<span class="string">"/param/test03"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队id：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队位置：&lt;input type=<span class="string">"text"</span> name=<span class="string">"location"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;h3&gt;2、使用对象接收多个参数&lt;/h3&gt;</span><br><span class="line">    &lt;form action=<span class="string">"/param/test02"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队id：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队位置：&lt;input type=<span class="string">"text"</span> name=<span class="string">"location"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;h3&gt;1、直接使用方法的参数逐个接收&lt;/h3&gt;</span><br><span class="line">    &lt;form action=<span class="string">"/param/test01"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">        球队id：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamId"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队名称：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamName"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        球队位置：&lt;input type=<span class="string">"text"</span> name=<span class="string">"teamLocation"</span>/&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;提交&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="6-2-控制器ParamController-java"><a href="#6-2-控制器ParamController-java" class="headerlink" title="6.2 控制器ParamController.java"></a>6.2 控制器ParamController.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.controller;</span><br><span class="line"><span class="keyword">import</span> com.kkb.pojo.Team;</span><br><span class="line"><span class="keyword">import</span> com.kkb.vo.QueryVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"param"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//8、获取集合类型的参数: 简单类型的可以通过@RequestParam注解实现；对象集合不支持直接获取，必须封装在类中，作为一个属性操作</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test08"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test08</span><span class="params">(@RequestParam(<span class="string">"teamName"</span>)</span> List&lt;String&gt; nameList)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test08-----------------"</span>);</span><br><span class="line">         <span class="keyword">for</span> (String s : nameList) &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test09"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test09</span><span class="params">(QueryVO vo)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test09-----------------"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Team team : vo.getTeamList()) &#123;</span><br><span class="line">        System.out.println(team);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7、获取数组类型的参数</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test07"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test07</span><span class="params">(String[] teamName,HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test07-----------------"</span>);</span><br><span class="line">        <span class="comment">//方式1：</span></span><br><span class="line">        <span class="keyword">for</span> (String s : teamName) &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"---------------"</span>);</span><br><span class="line">        <span class="comment">//方式2：</span></span><br><span class="line">        String[] teamNames = request.getParameterValues(<span class="string">"teamName"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String name : teamNames) &#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6、获取日期类型的参数</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test06"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test06</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test06-----------------"</span>);</span><br><span class="line">        System.out.println(team);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5、直接使用URL地址传参: 借助@PathVariable 注解</span></span><br><span class="line">    <span class="comment">// 例如http://localhost:8080/param/test05/1001/lacker/las</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test05/&#123;id&#125;/&#123;name&#125;/&#123;loc&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test05</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer teamId,</span></span><br><span class="line"><span class="function">        						@<span class="title">PathVariable</span><span class="params">(<span class="string">"name"</span>)</span> String teamName,</span></span><br><span class="line"><span class="function">        						@<span class="title">PathVariable</span><span class="params">(<span class="string">"loc"</span>)</span> String teamLocation)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test05-----------------"</span>);</span><br><span class="line">        System.out.println(teamId);</span><br><span class="line">        System.out.println(teamName);</span><br><span class="line">        System.out.println(teamLocation);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4、使用HttpServletRequest 对象获取参数：跟原来的javaWeb项目中使用的方式是一样的</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test04"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test04</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test04-----------------"</span>);</span><br><span class="line">        String teamId = request.getParameter(<span class="string">"teamId"</span>);</span><br><span class="line">        String teamName = request.getParameter(<span class="string">"teamName"</span>);</span><br><span class="line">        String location = request.getParameter(<span class="string">"location"</span>);</span><br><span class="line">        <span class="keyword">if</span>(teamId!=<span class="keyword">null</span>)</span><br><span class="line">        	System.out.println(Integer.valueOf(teamId));</span><br><span class="line">        System.out.println(teamName);</span><br><span class="line">        System.out.println(location);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3、请求参数和方法名称的参数不一致:使用@RequestParam进行矫正，</span></span><br><span class="line">    <span class="comment">// value属性表示请求中的参数名称</span></span><br><span class="line">    <span class="comment">// required属性表示参数是否是必须的：true:必须赋值，否则报出400错；false：可以不赋值    结果就是null</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test03"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test03</span><span class="params">(@RequestParam(value = <span class="string">"teamId"</span>,required = <span class="keyword">false</span>)</span> Integer id,</span></span><br><span class="line"><span class="function">    							@<span class="title">RequestParam</span><span class="params">(value = <span class="string">"teamName"</span>,required = <span class="keyword">true</span>)</span> String name,</span></span><br><span class="line"><span class="function">   								@<span class="title">RequestParam</span><span class="params">(<span class="string">"location"</span>)</span> String loc)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test03-----------------"</span>);</span><br><span class="line">        System.out.println(id);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(loc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2、使用对象接收多个参数：要求用户请求中携带的参数名称必须是实体类中的属性保持一致，否则就获取不到</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test02"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test02</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test02-----------------"</span>);</span><br><span class="line">        System.out.println(team);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1、直接使用方法的参数逐个接收:方法的参数名称必须与用户请求中携带的参数名称保持一致，否则就获取不到</span></span><br><span class="line"><span class="comment">    * 好处：不需要类型转换</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test01"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test01</span><span class="params">(Integer teamId,String teamName,StringteamLocation)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test01-----------------"</span>);</span><br><span class="line">        System.out.println(teamId);</span><br><span class="line">        System.out.println(teamName);</span><br><span class="line">        System.out.println(teamLocation);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"ok"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="7、请求参数中文乱码"><a href="#7、请求参数中文乱码" class="headerlink" title="7、请求参数中文乱码"></a>7、请求参数中文乱码</h1><p>对于前面所接收的请求参数，若含有中文，则会出现中文乱码问题。Spring 对于请求参数中的中文乱码问题，给出了专门的字符集过滤器CharacterEncodingFilter 类。如图所示。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221155647.png" alt="image-20211221155647581"></p>
<h2 id="7-1-乱码解决方案"><a href="#7-1-乱码解决方案" class="headerlink" title="7.1 乱码解决方案"></a>7.1 乱码解决方案</h2><p>在 web.xml 中注册字符集过滤器，推荐将该过滤器注册在其它过滤器之前。因为过滤器的执行是按照其注册顺序进行的。在web.xml配置文件直接注册字符集</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册字符集过滤器：post请求中文乱码问题的解决方案--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--指定字符集--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--强制request使用字符集encoding--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--强制response使用字符集encoding--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="8-处理器方法的返回值"><a href="#8-处理器方法的返回值" class="headerlink" title="8. 处理器方法的返回值"></a>8. 处理器方法的返回值</h1><p>使用@Controller 注解的处理器的处理器方法，其返回值常用的有四种类型：</p>
<ol>
<li>ModelAndView</li>
<li>String</li>
<li>返回自定义类型对象</li>
<li>无返回值 void<br>咱们根据实际的业务选择不同的返回值。<br>案例准备工作：<br>创建控制器ResultController.java</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.controller;</span><br><span class="line"><span class="keyword">import</span> com.kkb.pojo.Team;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"result"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在jsp文件夹中添加页面result.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    	&lt;title&gt;result&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    	&lt;h1&gt;result----------------&lt;/h1&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="8-1-返回ModelAndView"><a href="#8-1-返回ModelAndView" class="headerlink" title="8.1 返回ModelAndView"></a>8.1 返回ModelAndView</h2><p>如果是前后端不分的开发，大部分情况下，我们返回 ModelAndView，即数据模型+视图：<br>控制器ResultController.java中添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、返回值是ModelAndView： 这种方式既有数据的携带还有资源的跳转，可以选择该种方式</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test01"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ModelAndView mv=<span class="keyword">new</span> ModelAndView();<span class="comment">//模型与视图</span></span><br><span class="line">    <span class="comment">//携带数据</span></span><br><span class="line">    mv.addObject(<span class="string">"teamName"</span>,<span class="string">"湖人队"</span>);<span class="comment">//相当于request。</span></span><br><span class="line">    setAttribute(<span class="string">"teamName"</span>,<span class="string">"湖人队“);</span></span><br><span class="line"><span class="string">    mv.setViewName("</span>result<span class="string">");</span></span><br><span class="line"><span class="string">    // 经过视图解析器InternalResourceViewResolver的处理，将逻辑视图名称加上前后缀变为物理资源路径 /jsp/result.jsp</span></span><br><span class="line"><span class="string">    return mv;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Model 中，放我们的数据，然后在 ModelAndView 中指定视图名称。<br>当处理器方法处理完后，需要跳转到其它资源的同时传递数据，选择返回 ModelAndView 比较好，但是<br>如果只是需要传递数据或者跳转之一，这个时候ModelAndView 就不是最优选择。<br>result.jsp页面中添加如下内容：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;test01------$&#123;teamName&#125;---&lt;/h3&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221161705.png" alt="image-20211221161705092"></p>
<h2 id="8-2-返回String"><a href="#8-2-返回String" class="headerlink" title="8.2 返回String"></a>8.2 返回String</h2><p>上一种方式中的 ModelAndView 可以拆分为两部分，Model 和 View，在 SpringMVC 中，Model 我们可以直接在参数中指定，然后返回值是逻辑视图名，视图解析器解析可以将逻辑视图名称转换为物理视图地址。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221161850.png" alt="image-20211221161850945"></p>
<p>视图解析器通过内部资源视图解析器InternalResourceViewResolver将字符串与解析器中的prefix和suffix结合形成要跳转的额URI。<br>控制器ResultController.java中添加方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2、返回字符串</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test02"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test02</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    Team team=<span class="keyword">new</span> Team();</span><br><span class="line">    team.setLocation(<span class="string">"迈阿密"</span>);</span><br><span class="line">    team.setTeamId(<span class="number">1002</span>);</span><br><span class="line">    team.setTeamName(<span class="string">"热火"</span>);</span><br><span class="line">    <span class="comment">//携带数据</span></span><br><span class="line">    request.setAttribute(<span class="string">"team"</span>,team);</span><br><span class="line">    request.getSession().setAttribute(<span class="string">"team"</span>,team);</span><br><span class="line">    <span class="comment">//资源的跳转</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"result"</span>;<span class="comment">// 经过视图解析器InternalResourceViewResolver的处理，将逻辑视图名称加上前后缀变为物理资源路径 /jsp/result.jsp</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>result.jsp页面中添加如下内容：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;test02---request作用域获取:---$&#123;requestScope.team.teamName&#125;--</span><br><span class="line">-$&#123;requestScope.team.teamId&#125;---$&#123;requestScope.team.location&#125;&lt;/h3&gt;</span><br><span class="line">&lt;h3&gt;test02---session作用域获取:---$&#123;sessionScope.team.teamName&#125;--</span><br><span class="line">-$&#123;sessionScope.team.teamId&#125;---$&#123;sessionScope.team.location&#125;&lt;/h3&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221162023.png" alt="image-20211221162023058"></p>
<h2 id="8-3-返回对象类型"><a href="#8-3-返回对象类型" class="headerlink" title="8.3 返回对象类型"></a>8.3 返回对象类型</h2><p>@ResponseBody + 两个依赖</p>
<p>当处理器方法返回Object对象类型的时候，可以是Integer、String、Map、List，也可以是自定义的对象类型。但是无论是什么类型，都不是作为逻辑视图出现，而是直接作为数据返回然后展示的。一般前端发起Ajax请求的时候都会使用直接返回对象的形式。<strong>返回对象的时候，需要使用@ResponseBody 注解，将转换后的 JSON 数据放入到响应体中。</strong></p>
<p>pom.xml文件中添加两个依赖:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>返回基础类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>、返回对象类型：Integer Double String 自定义类型 List Map 返回的不是逻辑视图的名</span><br><span class="line">称，而直接就是数据返回 ，一般是ajax请求搭配使用 ，将json格式的数据直接返回给响应体</span><br><span class="line"><span class="comment">// 一定要与@ResponseBody</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test03-1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">test031</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">666</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test03-2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test032</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"test"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回自定义对象类型</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test03-3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Team <span class="title">test033</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Team team=<span class="keyword">new</span> Team();</span><br><span class="line">    team.setLocation(<span class="string">"迈阿密"</span>);</span><br><span class="line">    team.setTeamId(<span class="number">1002</span>);</span><br><span class="line">    team.setTeamName(<span class="string">"热火"</span>);</span><br><span class="line">    <span class="keyword">return</span> team;</span><br><span class="line">&#125;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;button type="button" id="btn1"&gt;ajax请求自定义对象&lt;/button&gt;</span><br><span class="line">    &lt;h3&gt;ajax请求自定义对象的结果展示&lt;/h3&gt;</span><br><span class="line">    &lt;p id="res"&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(<span class="string">"#btn1"</span>).click(function () &#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">"POST"</span>,</span><br><span class="line">            url: <span class="string">"/result/test03-3"</span>,</span><br><span class="line">            data: <span class="string">""</span>,</span><br><span class="line">            success: function(msg)&#123;</span><br><span class="line">                alert( <span class="string">"Data Saved: "</span> + msg );</span><br><span class="line">                <span class="keyword">var</span> name=msg.teamName;</span><br><span class="line">                <span class="keyword">var</span> id=msg.teamId;</span><br><span class="line">                <span class="keyword">var</span> loc=msg.location;</span><br><span class="line">                $(<span class="string">"#res"</span>).html(<span class="string">"name:"</span>+name+<span class="string">",id:"</span>+id+<span class="string">",location:"</span>+loc);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221164111.png" alt="image-20211221164110994"></p>
</li>
</ol>
<h2 id="8-4-返回集合List"><a href="#8-4-返回集合List" class="headerlink" title="8.4  返回集合List"></a>8.4  返回集合List</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test03-4"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Team&gt; <span class="title">test034</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Team&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">5</span>;i++) &#123;</span><br><span class="line">        Team team = <span class="keyword">new</span> Team();</span><br><span class="line">        team.setLocation(<span class="string">"迈阿密"</span>+i);</span><br><span class="line">        team.setTeamId(<span class="number">1002</span>+i);</span><br><span class="line">        team.setTeamName(<span class="string">"热火"</span>+i);</span><br><span class="line">        list.add(team);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;button type="button" id="btn1"&gt;ajax请求自定义对象&lt;/button&gt;</span><br><span class="line">    &lt;h3&gt;ajax请求自定义对象的结果展示&lt;/h3&gt;</span><br><span class="line">    &lt;p id="res"&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(<span class="string">"#btn2"</span>).click(function () &#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="string">"POST"</span>,</span><br><span class="line">                url: <span class="string">"/result/test03-4"</span>,</span><br><span class="line">                data: <span class="string">""</span>,</span><br><span class="line">                success: function(list)&#123;</span><br><span class="line">                    alert( <span class="string">"Data Saved: "</span> + list );</span><br><span class="line">                    <span class="keyword">var</span> str=<span class="string">""</span>;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;list.length;i++)&#123;</span><br><span class="line">                        <span class="keyword">var</span> obj=list[i];</span><br><span class="line">                        str+=<span class="string">"name:"</span>+obj.teamName+<span class="string">",id:"</span>+obj.teamId+<span class="string">",location:"</span>+obj.location+<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $(<span class="string">"#res2"</span>).html(str);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221164509.png" alt="image-20211221164509598"></p>
<h2 id="8-5-返回集合Map"><a href="#8-5-返回集合Map" class="headerlink" title="8.5 返回集合Map"></a>8.5 返回集合Map</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test03-5"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Team&gt; <span class="title">test035</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Map&lt;String,Team&gt; map=<span class="keyword">new</span> HashMap();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">5</span>;i++) &#123;</span><br><span class="line">        Team team = <span class="keyword">new</span> Team();</span><br><span class="line">        team.setLocation(<span class="string">"金州"</span>+i);</span><br><span class="line">         team.setTeamId(<span class="number">1000</span>+i);</span><br><span class="line">        team.setTeamName(<span class="string">"勇士"</span>+i);</span><br><span class="line">        <span class="comment">//日期类型，在返回的时候是个数字，如果想要按日期格式展示需要在实体类对应属性添加注解</span></span><br><span class="line">        <span class="meta">@JsonFormat</span>(pattern = <span class="string">"yyyy-MM-dd"</span>)</span><br><span class="line">        team.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        map.put(team.getTeamId()+<span class="string">""</span>,team);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">&lt;button type="button" id="btn3"&gt;ajax请求Map&lt;/button&gt;</span><br><span class="line">&lt;h3&gt;ajax请求Map的结果展示&lt;/h3&gt;</span><br><span class="line">&lt;p id="res3"&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(<span class="string">"#btn3"</span>).click(function () &#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="string">"POST"</span>,</span><br><span class="line">                url: <span class="string">"/result/test03-5"</span>,</span><br><span class="line">                data: <span class="string">""</span>,</span><br><span class="line">                success: function(map)&#123;</span><br><span class="line">                    alert( <span class="string">"Data Saved: "</span> + map );</span><br><span class="line">                    <span class="keyword">var</span> str=<span class="string">""</span>;</span><br><span class="line">                    $.each(map,function (i,obj) &#123;</span><br><span class="line">                    str+=<span class="string">"name:"</span>+obj.teamName+<span class="string">",id:"</span>+obj.teamId+<span class="string">",location:"</span>+obj.location+<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    $(<span class="string">"#res3"</span>).html(str);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221191927.png" alt="image-20211221191927483"></p>
<h1 id="9-页面导航的方式"><a href="#9-页面导航的方式" class="headerlink" title="9.页面导航的方式"></a>9.页面导航的方式</h1><p>页面导航分为两种：1、转发 2、重定向</p>
<p>springMVC有以下两种方式实现页面的转发或重定向：<br>1、返回字符串<br>2、使用ModelAndView</p>
<p>在SpringMVC中两种导航进行页面导航的时候使用不同的前缀指定转发还是重定向</p>
<p>前缀： 转发： forward:url 默认<br>重定向： redirect:url<br>准备工作：创建一个新的控制器NavigationController.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ClassName: NavigationController</span></span><br><span class="line"><span class="comment">* SpringMVC导航的方式</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wanglina</span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"navigation"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NavigationController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-1-转发到一个jsp页面"><a href="#9-1-转发到一个jsp页面" class="headerlink" title="9.1 转发到一个jsp页面"></a>9.1 转发到一个jsp页面</h2><p><strong>字符串方式转发</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test01-1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test011</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    request.setAttribute(<span class="string">"teamName"</span>,<span class="string">"湖人"</span>);</span><br><span class="line">    <span class="comment">//return "ok";//默认方式:由视图解析器处理之后将逻辑视图转为物理资源路径</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"forward:/jsp/ok.jsp"</span>;<span class="comment">//当添加了forward前缀之后，视图解析器中的前后缀就失效了，必须自己编写绝对路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ModelAndView转发</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test01-2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test012</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.addObject(<span class="string">"teamName"</span>,<span class="string">"热火"</span>);</span><br><span class="line">    <span class="comment">//mv.setViewName("ok");//默认方式:由视图解析器处理之后将逻辑视图转为物理资源路径</span></span><br><span class="line">    mv.setViewName( <span class="string">"forward:/jsp/ok.jsp"</span>);<span class="comment">//当添加了forward前缀之后，视图解析器中的前后缀就失效了，必须自己编写绝对路径</span></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-2-重定向到一个jsp页面"><a href="#9-2-重定向到一个jsp页面" class="headerlink" title="9.2 重定向到一个jsp页面"></a>9.2 重定向到一个jsp页面</h2><p> <strong>字符串方式重定向</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test02-1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test021</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    request.setAttribute(<span class="string">"teamName"</span>,<span class="string">"勇士"</span>);<span class="comment">//页面上无法获取到存储在request作用域中的值，请求中断了</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/jsp/ok.jsp"</span>;<span class="comment">//当添加了redirect前缀之后，视图解析器中的前后缀就失效了，必须自己编写绝对路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <strong>ModelAndView方式重定向</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test02-2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test022</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.addObject(<span class="string">"teamName"</span>,<span class="string">"huangfeng"</span>);</span><br><span class="line">    <span class="comment">//存储在request作用域中的值以参数的形式追加在URL后面 http://localhost:8080/jsp/ok.jsp?teamName=huangfeng&amp;teamId=1002</span></span><br><span class="line">    mv.addObject(<span class="string">"teamId"</span>,<span class="string">"1002"</span>);</span><br><span class="line">    mv.setViewName( <span class="string">"redirect:/jsp/ok.jsp"</span>);<span class="comment">//当添加了redirect前缀之后，视图解析器中的前后缀就失效了，必须自己编写绝对路径</span></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-3-重定向或者转发到控制器"><a href="#9-3-重定向或者转发到控制器" class="headerlink" title="9.3 重定向或者转发到控制器"></a>9.3 重定向或者转发到控制器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test03-1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test031</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"test03-1---转发到控制器"</span>);</span><br><span class="line">    ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.addObject(<span class="string">"teamName"</span>,<span class="string">"达拉斯小牛"</span>);</span><br><span class="line">    mv.setViewName(<span class="string">"forward:/navigation/test01-1"</span>); <span class="comment">//重定向到01-1，teamName被test01-1覆盖为“湖人”</span></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test03-2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test032</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"test03-1---重定向到控制器"</span>);</span><br><span class="line">    ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.addObject(<span class="string">"teamName"</span>,<span class="string">"kaierteren"</span>);</span><br><span class="line">    mv.addObject(<span class="string">"teamId"</span>,<span class="string">"1003"</span>);</span><br><span class="line">    mv.setViewName(<span class="string">"redirect:/navigation/test01-1"</span>);<span class="comment">//参数值直接追加到URL后面</span></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"test-----------------"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="10-异常处理"><a href="#10-异常处理" class="headerlink" title="10. 异常处理"></a>10. 异常处理</h1><p>SpringMVC框架常用@ExceptionHandler 注解处理异常</p>
<h2 id="10-1-ExceptionHandler-注解"><a href="#10-1-ExceptionHandler-注解" class="headerlink" title="10.1 @ExceptionHandler 注解"></a>10.1 @ExceptionHandler 注解</h2><p>@ExceptionHandler 可以将一个方法指定为异常处理方法。被注解的方法，其返回值可以是 ModelAndView、String，或 void，方法名随意，方法参数可以是Exception </p>
<p>及其子类对象、HttpServletRequest、HttpServletResponse 等。系统会自动为这些方法参数赋值。</p>
<p>对于异常处理注解的用法，也可以直接将异常处理方法注解于 Controller 之。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221202400.png" alt="image-20211221202400776"></p>
<h2 id="10-2-实现步骤"><a href="#10-2-实现步骤" class="headerlink" title="10.2 实现步骤"></a>10.2 实现步骤</h2><ol>
<li><p>自定义异常类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeamException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TeamException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TeamException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeamIdException</span> <span class="keyword">extends</span> <span class="title">TeamException</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TeamIdException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TeamIdException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeamNameException</span> <span class="keyword">extends</span> <span class="title">TeamException</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TeamNameException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TeamNameException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"ex"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"test01/&#123;id&#125;/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test01</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer teamId,</span></span><br><span class="line"><span class="function">                               @<span class="title">PathVariable</span><span class="params">(<span class="string">"name"</span>)</span> String teamName) <span class="keyword">throws</span> TeamIdException,TeamNameException</span>&#123;</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        <span class="keyword">if</span>(teamId&lt;=<span class="number">1000</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> TeamIdException(<span class="string">"teamId不合法！必须在1000之上！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"test"</span>.equals(teamName))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> TeamNameException(<span class="string">"teamName不合法！不能使用test!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="number">10</span>/<span class="number">0</span>);</span><br><span class="line">        mv.setViewName(<span class="string">"ok"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value =&#123;TeamIdException<span class="class">.<span class="keyword">class</span>,<span class="title">TeamNameException</span>.<span class="title">class</span>,<span class="title">Exception</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ModelAndView</span> <span class="title">exHandler</span>(<span class="title">Exception</span> <span class="title">ex</span>)</span>&#123;</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"msg"</span>,ex.getMessage());</span><br><span class="line">        <span class="keyword">if</span>(ex <span class="keyword">instanceof</span> TeamIdException)</span><br><span class="line">            mv.setViewName(<span class="string">"idError"</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(ex <span class="keyword">instanceof</span> TeamNameException)</span><br><span class="line">            mv.setViewName(<span class="string">"nameError"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            mv.setViewName(<span class="string">"error"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写error.jsp、idError.jsp、nameError.jsp页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;title&gt;error&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;默认的错误页面--$&#123;msg&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;title&gt;id error&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;teamId Error----$&#123;msg&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;title&gt;name error&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;teamName error---$&#123;msg&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><strong>测试结果</strong></p>
<p>正确的参数</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221204252.png" alt="image-20211221204252335"></p>
<p>teamId改错：</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221204449.png" alt="image-20211221204449558"></p>
<p>teamName改错：</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221204338.png" alt="image-20211221204338225"></p>
<p>都错（如果不加默认的异常处理类Exception.class）：</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211221204528.png" alt="image-20211221204528076"></p>
</li>
</ol>
<h2 id="10-3-优化"><a href="#10-3-优化" class="headerlink" title="10.3 优化"></a>10.3 优化</h2><p>一般将异常处理方法专门定义在一个类中，作为全局的异常处理类，对所有的异常处理类进行汇总。使用注解@ControllerAdvice，就是“控制器增强”，是给控制器对象增强功能的。使用</p>
<p>@ControllerAdvice 修饰的类中可以使用@ExceptionHandler。当使用@RequestMapping 注解修饰的方法抛出异常时，会执行@ControllerAdvice 修饰的类中的异常</p>
<p>处理方法。</p>
<p><strong>@ControllerAdvice 注解所在的类需要进行包扫描，否则无法创建对象。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.kkb.exceptions"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>定义全局的异常处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = TeamIdException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ModelAndView</span> <span class="title">exHandler1</span>(<span class="title">Exception</span> <span class="title">ex</span>)</span>&#123;</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"msg"</span>,ex.getMessage());</span><br><span class="line">        mv.setViewName(<span class="string">"idError"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = TeamNameException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ModelAndView</span> <span class="title">exHandler2</span>(<span class="title">Exception</span> <span class="title">ex</span>)</span>&#123;</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"msg"</span>,ex.getMessage());</span><br><span class="line">        mv.setViewName(<span class="string">"nameError"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = TeamException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ModelAndView</span> <span class="title">exHandler4</span>(<span class="title">Exception</span> <span class="title">ex</span>)</span>&#123;</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"msg"</span>,ex.getMessage());</span><br><span class="line">        mv.setViewName(<span class="string">"nameError"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ModelAndView</span> <span class="title">exHandler3</span>(<span class="title">Exception</span> <span class="title">ex</span>)</span>&#123;</span><br><span class="line">        ModelAndView mv=<span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">"msg"</span>,ex.getMessage());</span><br><span class="line">        mv.setViewName(<span class="string">"error"</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="11-拦截器"><a href="#11-拦截器" class="headerlink" title="11. 拦截器"></a>11. 拦截器</h1><p>SpringMVC 中的 拦截器（ Interceptor）是非常重要的，它的主要作用是拦截指定的用户请求，并进行相应的预处理与后处理。</p>
<p>拦截的时间点在“处理器映射器HandlerMapping根据用户提交的请求映射出了所要执行的处理器类，并且也找到了要执行该处理器类的处理器适配器，在处理器适配器HandlerAdaptor执行处理器之前”。在处理器映射器映射出所要执行的处理器类时，已经将拦截器与处理器组合为了一个处理器执行链HandlerExecutionChain，并返回给了前端控制器。</p>
<p>自定义拦截器，需要实现 HandlerInterceptor 接口。而该接口中含有三个方法：</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211223200941.png" alt="image-20211223200941385"></p>
<ol>
<li><p>preHandle(request,response, Object handler)：</p>
<p><strong>该方法在处理器方法执行之前执行</strong>。其返回值为boolean，若为true，则紧接着会执行处理器方法，且会将afterCompletion()方法放入到一个专门的方法栈中等待执行。</p>
<p>使用场景：登录验证</p>
</li>
<li><p>postHandle(request,response, Object handler,modelAndView)：</p>
<p><strong>该方法在处理器方法执行之后，在ModelAndView返回之前执行</strong>。处理器方法若最终未被执行，则该方法不会执行。由于该方法是在处理器方法执行完后执行，且<strong>该方法参数中包含 ModelAndView</strong>，所以该方法可以修改处理器方法的处理结果数据，且可以修改跳转方向。</p>
<p>使用场景：日记，纪录登录ID，时间</p>
</li>
<li><p>afterCompletion(request,response, Object handler, Exception ex)：</p>
<p><strong>该方法在ModelAndView返回之后执行</strong>。当 preHandle()方法返回true时，会将该方法放到专门的方法栈中，等到对请求进行响应的所工作完成之后才执行该方法。即该方法是在前端控制器渲染（数据填充）了响应页面之后执行的，此时对ModelAndView再操作也对响应无济于事。afterCompletion最后执行的方法，清除资源，例如在Controller方法中加入数据</p>
<p>使用场景：全局资源的操作</p>
</li>
</ol>
<h2 id="11-1-自定义拦截器"><a href="#11-1-自定义拦截器" class="headerlink" title="11.1 自定义拦截器"></a>11.1 自定义拦截器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.interceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ClassName: MyInterceptor</span></span><br><span class="line"><span class="comment">* 自定义拦截器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wanglina</span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"><span class="comment">//执行时间： 控制器方法执行之前，在ModelAndView返回之前</span></span><br><span class="line"><span class="comment">//使用场景: 登录验证</span></span><br><span class="line"><span class="comment">// 返回值 true : 继续执行控制器方法 表示放行 false: 不会继续执行控制器方法，表示拦截</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> System.out.println(<span class="string">"preHandle-------------------"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行时间： 控制器方法执行之hou后，在ModelAndView返回之前，有机会修改返回值</span></span><br><span class="line"><span class="comment">//使用场景: 日记记录，记录登录的ip,时间</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"postHandle-------------------"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行时间： 控制器方法执行之后，在ModelAndView返回之后，没有机会修改返回值</span></span><br><span class="line"><span class="comment">//使用场景: 全局资源的一些操作</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"afterCompletion-------------------"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">package</span> com.kkb.interceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ClassName: MyInterceptor</span></span><br><span class="line"><span class="comment">* 自定义拦截器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wanglina</span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor2</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"><span class="comment">//执行时间： 控制器方法执行之前，在ModelAndView返回之前</span></span><br><span class="line"><span class="comment">//使用场景: 登录验证</span></span><br><span class="line"><span class="comment">// 返回值 true : 继续执行控制器方法 表示放行 false: 不会继续执行控制器方法，表示拦截</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"preHandle2-------------------"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行时间： 控制器方法执行之hou后，在ModelAndView返回之前，有机会修改返回值</span></span><br><span class="line"><span class="comment">//使用场景: 日记记录，记录登录的ip,时间</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"postHandle-2------------------"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行时间： 控制器方法执行之后，在ModelAndView返回之后，没有机会修改返回值</span></span><br><span class="line"><span class="comment">//使用场景: 全局资源的一些操作</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"afterCompletion2-------------------"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="11-2-配置拦截器"><a href="#11-2-配置拦截器" class="headerlink" title="11.2 配置拦截器"></a>11.2 配置拦截器</h2><p>在springmvc.xml中添加如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里可以同时配置多个拦截器，配置的顺序就是拦截器的拦截顺序 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 拦截器要拦截的请求路径 拦截所有用/** --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定干活的拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.kkb.interceptor.MyInterceptor2"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"myInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 拦截器要拦截的请求路径 拦截所有用/** --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定干活的拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.kkb.interceptor.MyInterceptor2"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"myInterceptor2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果有多个拦截器的时候：<br>preHandle：按照配置前后顺序执行<br>postHandle：按照配置前后逆序执行<br>afterCompletion：按照配置前后逆序执行</p>
<h1 id="12-文件上传和下载"><a href="#12-文件上传和下载" class="headerlink" title="12. 文件上传和下载"></a>12. 文件上传和下载</h1><p>Spring MVC为文件上传提供了直接支持,这种支持是通过即插即用的MultipartResolver实现.Spring中有一个MultipartResolver的实现类:CommonsMultipartResolver。<br>在SpringMVC上下文中默认没有装配MultipartResolver,因此默认情况下不能处理文件上传工作。如果想使用Spring的文件上传功能,则需要先在上下文中配置MultipartResolver。</p>
<h2 id="12-1-文件上传"><a href="#12-1-文件上传" class="headerlink" title="12.1 文件上传"></a>12.1 文件上传</h2><ol>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>springmvc.xml文件中配置MultipartResolver:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>fileHandle.jsp页面表单</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">   	 &lt;title&gt;文件操作&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action=<span class="string">"/file/upload"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">        请选择文件：&lt;input type=<span class="string">"file"</span> name=<span class="string">"myFile"</span> /&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type="submit"&gt;上传文件&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置java代码(注意要创建文件夹保存上传之后的文件)</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20211223202826.png" alt="image-20211223202826848"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"file"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"upload"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(@RequestParam(<span class="string">"myFile"</span>)</span> MultipartFile myFile,HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="comment">//获取文件的原始名称 d:\te.aa\txcat.jpg</span></span><br><span class="line">        String originalFilename = myFile.getOriginalFilename();</span><br><span class="line">        <span class="comment">// 实际开发中，一般都要将文件重新名称进行存储</span></span><br><span class="line">        <span class="comment">// 存储到服务器的文件名称=随机的字符串+根据实际名称获取到源文件的后缀</span></span><br><span class="line">        String fileName= UUID.randomUUID().toString().replace(<span class="string">"-"</span>,<span class="string">""</span>)</span><br><span class="line">        	+originalFilename.substring(originalFilename.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">        System.out.println(fileName);</span><br><span class="line">        <span class="comment">//文件存储路径</span></span><br><span class="line">        String realPath =request.getServletContext().getRealPath(<span class="string">"/uploadFile"</span>)+<span class="string">"/"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            myFile.transferTo(<span class="keyword">new</span> File(realPath+fileName));<span class="comment">//真正的文件上传到服务器指定的位置</span></span><br><span class="line">            System.out.println(<span class="string">"上传成功！"</span>+realPath+fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ok"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"fileHandle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="12-2-优化：限定上传文件的大小和类型"><a href="#12-2-优化：限定上传文件的大小和类型" class="headerlink" title="12.2 优化：限定上传文件的大小和类型"></a>12.2 优化：限定上传文件的大小和类型</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">......</span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.kkb.interceptor.FileInterceptor"</span> <span class="attr">id</span>=<span class="string">"fileInterceptor"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--文件上传的大小限制 以字节B为单位 5m :1024*1024*5 1M=1024KB 1KB=1024B--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"5242880"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kkb.interceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartHttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ClassName: FileInterceptor</span></span><br><span class="line"><span class="comment">* 文件后缀处理的拦截器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wanglina</span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 在文件上传之前判断文件后缀是否合法</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponseresponse, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//判断是否是文件上传的请求</span></span><br><span class="line">        <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(request <span class="keyword">instanceof</span> MultipartHttpServletRequest)&#123;</span><br><span class="line">            MultipartHttpServletRequest multipartRequest=</span><br><span class="line">            (MultipartHttpServletRequest) request;</span><br><span class="line">            Map&lt;String, MultipartFile&gt; fileMap = multipartRequest.getFileMap();</span><br><span class="line">            <span class="comment">//遍历文件</span></span><br><span class="line">            Iterator&lt;String&gt; iterator = fileMap.keySet().iterator();</span><br><span class="line">            <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">                String key = iterator.next();</span><br><span class="line">                MultipartFile file = multipartRequest.getFile(key);</span><br><span class="line">                String originalFilename = file.getOriginalFilename();</span><br><span class="line">                String hz =</span><br><span class="line">                originalFilename.substring(originalFilename.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">                <span class="comment">//判断后缀是否合法</span></span><br><span class="line">                <span class="keyword">if</span>(!hz.toLowerCase().equals(<span class="string">".png"</span>) &amp;&amp;!hz.toLowerCase().equals(<span class="string">".jpg"</span>))&#123;</span><br><span class="line">                    request.getRequestDispatcher(<span class="string">"/jsp/fileTypError.jsp"</span>).forward(request,response)</span><br><span class="line">                    ;</span><br><span class="line">                    flag=<span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="13-restful风格"><a href="#13-restful风格" class="headerlink" title="13. restful风格"></a>13. restful风格</h1><p>REST概念：</p>
<p>REST(英文：Representational State Transfer，简称REST，意思：表述性状态转换，描述了一个架构样式的网络系统，比如web应用)。<br>它是一种软件架构风格、设计风格，而不是标准，只是提供了一组设计原则和约束条件，它主要用于客户端和服务端交互类的软件。基于这个风格设计的软件可以更简介，更有层次，更易于实现缓存等机制。<br>它本身并没有什么使用性，其核心价值在于如何设计出符合REST风格的网络接口。</p>
<p>RESTful概念：<br>REST指的是一组架构约束条件和原则。满足这些约束条件和原则的应用程序或设计就是RESTful。</p>
<p>RESTful的特性：<br>资源(Resources)：互联网所有的事物都可以被抽象为资源 。它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的存在。可以用一个URI（统一资源定位符）指向它，每种资源对应一个特性的URI。要获取这个资源，访问它的URI就可以，因此URI即为每一个资源的独一无二的识别符。</p>
<p>表现层(Representation)：把资源具体呈现出来的形式，叫做它的表现层(Representation)。比如，文本可以用txt格式表现，也可以用HTML格式、XML格式、JSON格式表现，甚至可以采用二进制格式。</p>
<p>状态转换(State Transfer)：每发出一个请求，就代表了客户端和服务器的一次交互过程。HTTP协议，是一个无状态协议，即所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生“状态转换”(State Transfer)。而这种转换是建立在表现层之上的，所以就是“表现层状态转换”。</p>
<p>具体来说就是HTTP协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。他们分别对应四种基本操作：GET用来获取资源，POST用来新建资源，PUT用来更新资源，DELETE用来删除资源。</p>
<p>原来的操作资源的方式：<br><a href="http://localhost:8080/getExpress.do?id=1" target="_blank" rel="noopener">http://localhost:8080/getExpress.do?id=1</a><br><a href="http://localhost:8080/saveExpress.do" target="_blank" rel="noopener">http://localhost:8080/saveExpress.do</a><br><a href="http://localhost:8080/updateExpress.do" target="_blank" rel="noopener">http://localhost:8080/updateExpress.do</a><br><a href="http://localhost:8080/deleteExpress.do?id=1" target="_blank" rel="noopener">http://localhost:8080/deleteExpress.do?id=1</a><br>原来用的方式当然没有问题，但是如果有更简洁的方式就更好了，此时就是RESTful风格。</p>
<p>使用RESTful操作资源：（使用旧的技术，但是采用不同的风格）</p>
<p>GET /expresses #查询所有的快递信息列表<br>GET /express/1006 #查询一个快递信息<br>POST /express #新建一个快递信息<br>PUT /express/1006 #更新一个快递信息(全部更新)<br>PATCH /express/1006 #更新一个快递信息（部分更新）<br>DELETE /express/1006 #删除一个快递信息</p>
<h2 id="13-1-API设计-URL设计"><a href="#13-1-API设计-URL设计" class="headerlink" title="13.1 API设计/URL设计"></a>13.1 API设计/URL设计</h2><p><strong>动词+宾语</strong></p>
<p>RESTful 的核心思想就是客户端的用户发出的数据操作指令都是”动词 + 宾语”的结构。例如GET/expresses 这个命令，GET是动词，/expresses 是宾语。</p>
<p><strong>动词通常就是五种 HTTP 方法，对应 CRUD 操作:</strong></p>
<p>GET：读取（Read）<br>POST：新建（Create）<br>PUT：更新（Update）<br>PATCH：更新（Update），通常是部分更新<br>DELETE：删除（Delete）</p>
<p>PS: </p>
<p>1、根据 HTTP 规范，动词一律大写。</p>
<p>2、一些代理只支持POST和GET方法， 为了使用这些有限方法支持RESTful API，需要一种办法覆盖http原来的方法。使用订制的HTTP头 X-HTTP-Method-Override 来覆盖POST 方法.</p>
<p><strong>宾语必须是名词:</strong></p>
<p>宾语就是 API 的 URL，是 HTTP 动词作用的对象。它应该是名词，不能是动词。比如，/expresses 这个 URL 就是正确的。</p>
<p>以下这些URL都是不推荐的，因为带上了动词，不是推荐写法。<br>/getAllExpresses<br>/getExpress<br>/createExpress<br>/deleteAllExpress</p>
<p>ps:不要混淆名词单数和复数，为了保持简单，只对所有资源使用复数</p>
<p><strong>避免多级URL</strong>:</p>
<p>如果资源中有多级分类，也不建议写出多级的URL。例如要获取球队中某个队员，有人可能这么写：</p>
<p>GET /team/1001/player/1005</p>
<p>这种写法的语义不够明确，所以推荐使用查询字符串做后缀，改写为GET /team/1001?player=1005.</p>
<p><strong>再例如查询所有的还未取出的快递，你该如何编写呢？</strong></p>
<p>GET /expresses/statu 不推荐<br>GET /expresses?statu=false 推荐</p>
<h2 id="13-2-HTTP状态码"><a href="#13-2-HTTP状态码" class="headerlink" title="13.2 HTTP状态码"></a>13.2 HTTP状态码</h2><p>客户端的用户发起的每一次请求，服务器都必须给出响应。响应包括 HTTP 状态码和数据两部分。</p>
<p>HTTP 状态码就是一个三位数，分成五个类别。这五大类总包含了100多种状态码（不需要全都记住，不用紧张哈，覆盖了绝大部分可能遇到的情况。每一种状态码都有标准的（或者约定的）解释，客户端只需查看状态码，就可以判断出发生了什么情况，所以服务器应该返回尽可能精确的状态码。</p>
<p><strong>五类状态码分别如下：</strong><br>1xx：相关信息<br>2xx：操作成功<br>3xx：重定向<br>4xx：客户端错误<br>5xx：服务器错误<br>PS：API 不需要1xx状态码，所以这个类别直接忽略。</p>
<ol>
<li><p>状态码2xx<br>200 状态码表示操作成功，但是不同的方法可以返回更精确的状态码。</p>
<p>GET: 200 OK 表示一切正常<br>POST: 201 Created 表示新的资源已经成功创建<br>PUT: 200 OK<br>PATCH: 200 OK<br>DELETE: 204 No Content 表示资源已经成功删除</p>
</li>
<li><p>状态码3xx</p>
<p>API 用不到 301 状态码（永久重定向）和 302 状态码（暂时重定向， 307 也是这个含义），因为它们可以由应用级别返回，浏览器会直接跳转，API 级别可以不考虑这两种情况。<br>API 用到的 3xx 状态码，主要是 303 See Other ，表示参考另一个 URL。它与 302 和 307 的含义一样，也是”暂时重定向”，区别在于 302 和 307 用于 GET 请求，而 303 用于 POST 、 PUT 和 DELETE 请求。<br>收到 303 以后，浏览器不会自动跳转，而会让用户自己决定下一步怎么办。</p>
<p>我们只需要关注一下304状态码就可以了<br><strong>304 ： Not Modified 客户端使用缓存数据</strong></p>
</li>
<li><p>状态码4xx<br>4xx 状态码表示客户端错误。</p>
<p>400 Bad Request：服务器不理解客户端的请求，未做任何处理。<br>401 Unauthorized：用户未提供身份验证凭据，或者没有通过身份验证。<br>403 Forbidden：用户通过了身份验证，但是不具有访问资源所需的权限。<br>404 Not Found：所请求的资源不存在，或不可用。<br>405 Method Not Allowed：用户已经通过身份验证，但是所用的 HTTP 方法不在他的权限之内。<br>410 Gone：所请求的资源已从这个地址转移，不再可用。<br>415 Unsupported Media Type：客户端要求的返回格式不支持。比如，API 只能返回 JSON 格式，但是客户端要求返回 XML 格式。<br>422 Unprocessable Entity ：客户端上传的附件无法处理，导致请求失败。<br>429 Too Many Requests：客户端的请求次数超过限额。</p>
</li>
<li><p>状态码5xx<br>5xx 状态码表示服务端错误。一般来说，API 不会向用户透露服务器的详细信息，所以只要两个状态码就够了。</p>
<p>500 Internal Server Error：客户端请求有效，服务器处理时发生了意外。<br>503 Service Unavailable：服务器无法处理请求，一般用于网站维护状态。</p>
</li>
</ol>
<h2 id="13-3-服务器响应"><a href="#13-3-服务器响应" class="headerlink" title="13.3 服务器响应"></a>13.3 服务器响应</h2><p>服务器返回的信息一般不推荐纯文本，而是建议大家选择JSON 对象，因为这样才能返回标准的结构化数据。<br>所以，服务器回应的 HTTP 头的 Content-Type 属性要设为 application/json 。客户端请求时，也要明确告诉服务器，可以接受 JSON 格式，即请求的 HTTP 头的 ACCEPT 属性也要设成application/json 。当发生错误的时候，除了返回状态码之外，也要返回错误信息。所以我们可以自己封装要返回的信息。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"># java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/08/30/IC%E9%AA%8C%E8%AF%81-%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1%E5%9F%BA%E7%A1%80/" rel="next" title="IC验证-数字设计基础">
                <i class="fa fa-chevron-left"></i> IC验证-数字设计基础
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/12/09/java-Mybatis/" rel="prev" title="java-spring">
                java-spring <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="xujunjie'blog" />
            
              <p class="site-author-name" itemprop="name">xujunjie'blog</p>
              <p class="site-description motion-element" itemprop="description">使一个人有限的生命更加有效也即等于延长了人的生命</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-如何不用骨架创建springmvc项目"><span class="nav-text">1. 如何不用骨架创建springmvc项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-配置视图解析器"><span class="nav-text">3.6 配置视图解析器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-SpringMVC工作流程"><span class="nav-text">4. SpringMVC工作流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-工作流程分析"><span class="nav-text">4.1 工作流程分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringMVC组件"><span class="nav-text">SpringMVC组件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-RequestMapping-注解"><span class="nav-text">5. @RequestMapping 注解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-RequestMapping出现的位置"><span class="nav-text">5.1@RequestMapping出现的位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-指定请求提交方式"><span class="nav-text">5.2 指定请求提交方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-补充url-pattern解析"><span class="nav-text">5.3 补充url-pattern解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1-url-pattern解析"><span class="nav-text">5.3.1 url-pattern解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-2-静态资源访问"><span class="nav-text">5.3.2 静态资源访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6、处理器方法的参数"><span class="nav-text">6、处理器方法的参数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-前端页面hello-jsp"><span class="nav-text">6.1 前端页面hello.jsp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-控制器ParamController-java"><span class="nav-text">6.2 控制器ParamController.java</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7、请求参数中文乱码"><span class="nav-text">7、请求参数中文乱码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-乱码解决方案"><span class="nav-text">7.1 乱码解决方案</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-处理器方法的返回值"><span class="nav-text">8. 处理器方法的返回值</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-返回ModelAndView"><span class="nav-text">8.1 返回ModelAndView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-返回String"><span class="nav-text">8.2 返回String</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-返回对象类型"><span class="nav-text">8.3 返回对象类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-返回集合List"><span class="nav-text">8.4  返回集合List</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-返回集合Map"><span class="nav-text">8.5 返回集合Map</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-页面导航的方式"><span class="nav-text">9.页面导航的方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-转发到一个jsp页面"><span class="nav-text">9.1 转发到一个jsp页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-重定向到一个jsp页面"><span class="nav-text">9.2 重定向到一个jsp页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-重定向或者转发到控制器"><span class="nav-text">9.3 重定向或者转发到控制器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-异常处理"><span class="nav-text">10. 异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-ExceptionHandler-注解"><span class="nav-text">10.1 @ExceptionHandler 注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-实现步骤"><span class="nav-text">10.2 实现步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-3-优化"><span class="nav-text">10.3 优化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-拦截器"><span class="nav-text">11. 拦截器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-自定义拦截器"><span class="nav-text">11.1 自定义拦截器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-2-配置拦截器"><span class="nav-text">11.2 配置拦截器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-文件上传和下载"><span class="nav-text">12. 文件上传和下载</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#12-1-文件上传"><span class="nav-text">12.1 文件上传</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-2-优化：限定上传文件的大小和类型"><span class="nav-text">12.2 优化：限定上传文件的大小和类型</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13-restful风格"><span class="nav-text">13. restful风格</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#13-1-API设计-URL设计"><span class="nav-text">13.1 API设计&#x2F;URL设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-2-HTTP状态码"><span class="nav-text">13.2 HTTP状态码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-3-服务器响应"><span class="nav-text">13.3 服务器响应</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xujunjie'blog</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>


  
  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>


  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "./public/search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  

</body>
</html>
