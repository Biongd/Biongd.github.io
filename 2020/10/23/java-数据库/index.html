<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="数据库," />










<meta name="description" content="java基础的系统性学习或者说复习已经告一段落，正式开始数据库学习，当然基础部分的内容还是不能丢下，要时长复习，尚存的问题还有很多：数据库的优化（索引），悲观锁和乐观锁，Map的底层原理红黑树等！">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库">
<meta property="og:url" content="http://yoursite.com/2020/10/23/java-%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="悦来客栈">
<meta property="og:description" content="java基础的系统性学习或者说复习已经告一段落，正式开始数据库学习，当然基础部分的内容还是不能丢下，要时长复习，尚存的问题还有很多：数据库的优化（索引），悲观锁和乐观锁，Map的底层原理红黑树等！">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329164221.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329164247.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329164304.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329213652.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214145.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214217.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214334.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214356.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214424.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214505.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214615.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329214642.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329215646.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210329215705.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210331104222.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210331104257.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210331104510.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210331105111.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210331105236.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210331105830.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210331143814.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210401095444.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210401101450.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210401102540.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210401103400.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210406101715.jpeg">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210406104012.jpeg">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210406113542.jpeg">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210406165844.jpeg">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210401194652.png">
<meta property="og:image" content="https://gitee.com/biongd/img/raw/master/img/20210404162953.png">
<meta property="article:published_time" content="2020-10-23T02:13:23.000Z">
<meta property="article:modified_time" content="2021-07-29T15:01:25.309Z">
<meta property="article:author" content="xujunjie&#39;blog">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/biongd/img/raw/master/img/20210329164221.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","display_updated":true,"offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/10/23/java-数据库/"/>





  <title>数据库 | 悦来客栈</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">悦来客栈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">learn and better</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/23/java-%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xujunjie'blog">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悦来客栈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">数据库</h1>
        

        <div class="post-meta">
          <span class="post-time">
              
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-23T10:13:23+08:00">
                2020-10-23
              </time>
            
            
                <span class="post-updated">
                     &nbsp; | &nbsp; 更新于
                     <time itemprop="dateUpdated" datetime="2021-07-29T23:01:25+08:00" content="2021-07-29">
                          2021-07-29
                     </time>
                 </span>
             

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index">
                    <span itemprop="name">计算机基础-操作系统.数据库.计算机网络.</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>java基础的系统性学习或者说复习已经告一段落，正式开始数据库学习，当然基础部分的内容还是不能丢下，要时长复习，尚存的问题还有很多：数据库的优化（索引），悲观锁和乐观锁，Map的底层原理红黑树等！</p>
<a id="more"></a>
<h1 id="1-数据库简介"><a href="#1-数据库简介" class="headerlink" title="1. 数据库简介"></a>1. 数据库简介</h1><h2 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h2><p>数据库（DataBase，DB）：指长期保存在计算机的存储设备上，按照一定规则组织起来，可以被各种用户或应用共享的数据集合。</p>
<p>数据库管理系统（DataBase Management System，DBMS）：指一种操作和管理数据库的大型软件，用于建立、使用和维护数据库，对数据库进行统一管理和控制，以保证数据库的安全性和完整性。用户通过数据库管理系统访问数据库中的数据。</p>
<p>数据库软件应该为<strong>数据库管理系统</strong>，数据库是通过数据库管理系统创建和操作的。</p>
<p>数据库：存储、维护和管理数据的集合。</p>
<h2 id="1-2-常见数据库管理系统"><a href="#1-2-常见数据库管理系统" class="headerlink" title="1.2 常见数据库管理系统"></a>1.2 常见数据库管理系统</h2><ul>
<li><p>Oracle：Oracle数据库被认为是业界目前比较成功的关系型数据库管理系统。Oracle数据库可以运行在UNIX、Windows等主流操作系统平台，完全支持所有的工业标准，并获得最高级别的ISO标准安全性认证。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329164221.png" alt="image-20210329164221802"></p>
</li>
<li><p>MySQL：MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS(Relational Database Management System，关系数据库管理系统) 应用软件。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329164247.png" alt="image-20210329164247271"></p>
</li>
<li><p>DB2：DB2是IBM公司的产品，DB2数据库系统采用多进程多线索体系结构，其功能足以满足大中公司的需要，并可灵活地服务于中小型电子商务解决方案。</p>
</li>
<li><p>Microsoft SQL Server：SQL Server 是Microsoft 公司推出的关系型数据库管理系统。具有使用方便<br>可伸缩性好与相关软件集成程度高等优点。</p>
</li>
</ul>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329164304.png" alt="image-20210329164304470"></p>
<h2 id="1-3-三大范式（规范）"><a href="#1-3-三大范式（规范）" class="headerlink" title="1.3 三大范式（规范）"></a>1.3 三大范式（规范）</h2><p>什么是三大范式：</p>
<ul>
<li><p>第一范式：<strong>无重复的列。</strong></p>
<p>当关系模式R的所有属性都不能在分解为更基本的数据单位时，称R是满足第一范式的，简记为1NF。满足第一范式是关系模式规范化的最低要求，否则，将有很多基本操作在这样的关系模式中实现不了。</p>
</li>
<li><p>第二范式：属性完全依赖于主键 [ 消除部分子函数依赖 ]。</p>
<p>如果关系模式R满足第一范式，并且R得所有非主属性都完全依赖于R的每一个候选关键属性，称R满足第二范式，简记为2NF。第二范式（2NF）是在第一范式（1NF）的基础上建立起来的，即满足第二范式（2NF）必须先满足第一范式（1NF）。<strong>第二范式（2NF）要求数据库表中的每个实例或行必须可以被唯一地区分。</strong>为实现区分通常需要为表加上一个列，以存储各个实例的唯一标识。这个唯一属性列被称为主关键字或主键、主码。</p>
</li>
<li><p>第三范式：属性不依赖于其它非主属性 [ 消除传递依赖 ]。</p>
<p>设R是一个满足第一范式条件的关系模式，X是R的任意属性集，如果X非传递依赖于R的任意一个候选关键字，称R满足第三范式，简记为3NF. 满足第三范式（3NF）必须先满足第二范式（2NF）。<strong>第三范式（3NF）要求一个数据库表中不包含已在其它表中已包含的非主关键字信息。</strong></p>
</li>
<li><p>注：关系实质上是一张二维表，其中每一行是一个元组，每一列是一个属性第二范式（2NF）和第三范式（3NF）的概念很容易混淆，区分它们的关键点在于，2NF：非主键列是否完全依赖于主键，还是依赖于主键的一部分；3NF：非主键列是直接依赖于主键，还是直接依赖于非主键列。</p>
</li>
</ul>
<h2 id="1-4-MySQL安装和卸载"><a href="#1-4-MySQL安装和卸载" class="headerlink" title="1.4 MySQL安装和卸载"></a>1.4 MySQL安装和卸载</h2><h3 id="1-4-1-安装"><a href="#1-4-1-安装" class="headerlink" title="1.4.1 安装"></a>1.4.1 安装</h3><p><strong>步骤1:访问地址</strong>:<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a></p>
<p><strong>步骤2:下载压缩包</strong>，下载后解压，放在非C盘下，将解压文件夹下的bin路径添加到系统变量path中</p>
<p><strong>步骤3:在mysql文件夹下找到my.ini或my-default.ini</strong>，如果没有.ini结尾的文件,直接创建该文件。新增内容为如下，注意basedir和datadir是我自己的路径位置，自定义。记得新增一个文件Data文件夹</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329213652.png" alt="image-20210329213652378"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># 设置3306端口</span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\mysql</span><br><span class="line"># 设置mysql数据库的数据的存放目录</span><br><span class="line">datadir=D:\mysql\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=<span class="number">200</span></span><br><span class="line"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span><br><span class="line">max_connect_errors=<span class="number">10</span></span><br><span class="line"># 服务端使用的字符集默认为UTF8</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line"><span class="keyword">default</span>-storage-engine=INNODB</span><br><span class="line"># 默认使用“mysql_native_password”插件认证</span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line"><span class="keyword">default</span>-character-set=utf8</span><br><span class="line">[client]</span><br><span class="line"># 设置mysql客户端连接服务端时默认使用的端口</span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line"><span class="keyword">default</span>-character-set=utf8</span><br></pre></td></tr></table></figure>
<p><strong>步骤4:安装mysql</strong><br>在mysql的安装目录中，打开bin文件夹，运行cmd.执行初始化数据库的指令：</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">mysqld</span> --<span class="comment">initialize</span> --<span class="comment">console</span></span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214145.png" alt="image-20210329214145500"></p>
<p>root用户的初始化密码:d?fwd_+ku2#M、d_g60Sd%geQg、66MV(e2l1E6n</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214217.png" alt="image-20210329214217299"></p>
<p>要是你不小心关掉cmd，或者没记住，那也没事，删掉初始化的 datadir 目录，再执行一遍初始化命令，又会重新生成的。</p>
<p><strong>步骤5:安装服务</strong><br>在MySQL安装目录的 bin 目录下执行命令：<br><code>mysqld --install [服务名]</code>这里的服务名默认是mysql，可以自定义</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214334.png" alt="image-20210329214334595"></p>
<p>如果提示上述错误，需要关闭cmd,重新打开，使用管理员身份执行</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214356.png" alt="image-20210329214356106"></p>
<p><strong>安装完成之后</strong><br>通过命令net start mysql启动MySQL的服务了。<br>通过命令net stop mysql停止服务。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214424.png" alt="image-20210329214424250"></p>
<p>注意:安装时，卸载其他版本的mysql数据库<br><strong>步骤6:链接数据库</strong></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214505.png" alt="image-20210329214505501"></p>
<p>修改账户密码:</p>
<p><code>alter user &#39;root&#39;@&#39;localhost&#39; identified with mysql_native_password BY &#39;新密码&#39;;</code></p>
<p>修改密码，注意命令尾的分号一定要有，这是mysql的语法</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214615.png" alt="image-20210329214615689"></p>
<p><strong>步骤7:退出数据库</strong></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329214642.png" alt="image-20210329214642746"></p>
<h3 id="1-4-2-卸载"><a href="#1-4-2-卸载" class="headerlink" title="1.4.2 卸载"></a>1.4.2 卸载</h3><p><strong>步骤1:</strong>使用管理员身份运行cmd,关闭mysql服务</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329215646.png" alt="image-20210329215646002"></p>
<p><strong>步骤2:</strong>删除mysql服务</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令:sc <span class="keyword">delete</span> mysql 或者 mysqld <span class="built_in">remove</span> mysql</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210329215705.png" alt="image-20210329215705121"></p>
<p>步骤3:刪除mysqlDB目录文件（ 安裝mysql时my.ini指定的目录）</p>
<h2 id="1-5-数据库的导入和导出"><a href="#1-5-数据库的导入和导出" class="headerlink" title="1.5 数据库的导入和导出"></a>1.5 数据库的导入和导出</h2><p>导入：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p输入密码登录mysql</span><br><span class="line"><span class="keyword">use</span> yhp;进入数据库</span><br><span class="line">source d:/student.sql；将路径下的数据库文件导入</span><br></pre></td></tr></table></figure>
<p>导出：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p yhp &gt;<span class="string">D:</span>/student.sql将数据库文件导出到指定路径</span><br></pre></td></tr></table></figure>
<h1 id="2-SQL语言"><a href="#2-SQL语言" class="headerlink" title="2. SQL语言"></a>2. SQL语言</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><p><strong>什么是SQL</strong></p>
<ul>
<li>SQL：Structure Query Language（结构化查询语言），SQL被美国国家标准局（ANSI）确定为关系型数据库语言的美国标准，后来被国际化标准组织（ISO）采纳为关系数据库语言的国际标准。</li>
<li>各数据库厂商都支持ISO的SQL标准，<strong>普通话</strong></li>
<li>各数据库厂商在标准的基础上做了自己的扩展，<strong>方言</strong></li>
<li>SQL 是一种标准化的语言，它允许你在数据库上执行操作，如创建项目，查询内容，更新内容，并删除条目等操作。<br>Create, Read, Update, and Delete 通常称为CRUD操作。</li>
</ul>
<p><strong>SQL语句分类</strong></p>
<ul>
<li>DDL（Data Definition Language）：数据定义语言，用来定义数据库对象：库、表、列等。</li>
<li>DML（Data Manipulation Language）：数据操作语言，用来定义数据库记录（数据）增删改。</li>
<li>DCL（Data Control Language）：数据控制语言，用来定义访问权限和安全级别。</li>
<li>DQL（Data Query Language）：数据查询语言，用来查询记录（数据）查询。</li>
</ul>
<p><strong>注意：sql语句以;结尾 。mysql中的关键字不区分大小写</strong></p>
<h2 id="2-2-DDL-数据定义"><a href="#2-2-DDL-数据定义" class="headerlink" title="2.2 DDL(数据定义)"></a>2.2 DDL(数据定义)</h2><p><strong>1 创建</strong><br><code>CREATE DATABASE</code>语句用于创建新的数据库：</p>
<p>编码方式:gb2312,utf-8,gbk,iso-8859-1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//<span class="keyword">create</span> <span class="keyword">database</span> 数据库名</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> mydb1;</span><br><span class="line">//<span class="keyword">create</span> <span class="keyword">database</span> 数据库名 <span class="built_in">character</span> <span class="keyword">set</span> 编码方式</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> mydb2 <span class="built_in">character</span> <span class="keyword">SET</span> GBK;</span><br><span class="line">//<span class="keyword">create</span> <span class="keyword">database</span> 数据库名 <span class="keyword">set</span> 编码方式 <span class="keyword">collate</span> 排序规则</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> mydb3 <span class="built_in">character</span> <span class="keyword">SET</span> GBK <span class="keyword">COLLATE</span> gbk_chinese_ci;</span><br></pre></td></tr></table></figure>
<p><strong>2 查看数据库</strong><br>查看当前数据库服务器中的所有数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>
<p>查看前面创建的mydb2数据库的定义信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//<span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">database</span> 数据库名;</span><br><span class="line"><span class="keyword">Show</span> <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> mydb2;</span><br></pre></td></tr></table></figure>
<p><strong>3 修改数据库</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> 数据库名 <span class="type">character</span> <span class="keyword">set</span> 编码方式</span><br></pre></td></tr></table></figure>
<p>查看服务器中的数据库，并把mydb2的字符集修改为utf8;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> mydb2 <span class="built_in">character</span> <span class="keyword">SET</span> utf8;</span><br></pre></td></tr></table></figure>
<p><strong>4 删除数据库</strong><br>drop database 数据库名</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> mydb3;</span><br></pre></td></tr></table></figure>
<p><strong>5 其他语句</strong><br>查看当前使用的数据库</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">database</span>();</span><br></pre></td></tr></table></figure>
<p>切换数据库: use 数据库名</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="title">mydb2</span>;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-DDL操作表"><a href="#2-3-DDL操作表" class="headerlink" title="2.3 DDL操作表"></a>2.3 DDL操作表</h2><h3 id="2-3-1-创建新表"><a href="#2-3-1-创建新表" class="headerlink" title="2.3.1 创建新表:"></a>2.3.1 <strong>创建新表:</strong></h3><p>语法：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">CREATE</span> <span class="selector-tag">TABLE</span> 表名(</span><br><span class="line">    列名1 数据类型 <span class="selector-attr">[约束]</span>,</span><br><span class="line">    列名2 数据类型 <span class="selector-attr">[约束]</span>,</span><br><span class="line">    列名<span class="selector-tag">n</span> 数据类型 <span class="selector-attr">[约束]</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>说明:表名，列名是自定义，多列之间使用逗号间隔，最后一列的逗号不能写<br>[约束] 表示可有可无<br>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Employees(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> ,</span><br><span class="line">age <span class="built_in">INT</span> ,</span><br><span class="line"><span class="keyword">first</span> <span class="built_in">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">last</span> <span class="built_in">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>常用数据类型：</p>
<ul>
<li>int：整型</li>
<li>double：浮点型，例如double(5,2)表示最多5位，其中必须有2位小数，即最大值为999.99；默认支持四舍五入</li>
<li>char：固定长度字符串类型； char(10) ‘aaa ‘ 占10位</li>
<li>varchar：可变长度字符串类型； varchar(10) ‘aaa’ 占3位</li>
<li>text：字符串类型，比如小说信息；</li>
<li>blob：字节类型，保存文件信息(视频，音频，图片)；</li>
<li>date：日期类型，格式为：yyyy-MM-dd；</li>
<li>time：时间类型，格式为：hh:mm:ss</li>
<li>timestamp：时间戳类型 yyyy-MM-dd hh:mm:ss 会自动赋值</li>
<li>datetime:日期时间类型 yyyy-MM-dd hh:mm:ss</li>
</ul>
<h3 id="2-3-2-CRUD"><a href="#2-3-2-CRUD" class="headerlink" title="2.3.2 CRUD"></a>2.3.2 CRUD</h3><ul>
<li><p>查:</p>
<p>当前数据库中的所有表：<code>show tables;</code></p>
<p>查看表的字段信息：<code>desc 表名；</code></p>
<p>查看表的创建细节：<code>show create table 表名;</code></p>
<p>查看表的全部内容：<code>select * from 表名</code></p>
</li>
<li><p>增：</p>
<p>增加列：<code>alter table 表名 add 新列名 新的数据类型</code></p>
</li>
<li><p>改：</p>
<p>修改列：<code>alter table 表名 change 旧列名 新列名 新的数据类型</code></p>
<p>修改表名：<code>alter table 旧表名 rename 新表名;</code></p>
<p>修改表的字符集：<code>alter table 表名 character set 编码方式</code></p>
</li>
<li><p>删：</p>
<p>删除列：<code>alter table 表名 drop 列名；</code></p>
<p>删除表：<code>drop table 表名；</code></p>
</li>
</ul>
<h2 id="2-4-DML（数据操作）"><a href="#2-4-DML（数据操作）" class="headerlink" title="2.4 DML（数据操作）"></a>2.4 DML（数据操作）</h2><p>DML是对<strong>表中的数据</strong>进行增、删、改的操作。不要与DDL混淆了。<br>主要包括：INSERT 、UPDATE、 DELETE<br><strong>小知识：</strong><br>在mysql中，字符串类型和日期类型都要用单引号括起来。<br>空值：null</p>
<p><strong>sql中的运算符:</strong></p>
<ul>
<li><p>算术运算符：<code>+，-，*，/(除法),求余(%)</code></p>
</li>
<li><p>赋值运算符：<code>=</code></p>
</li>
<li><p>逻辑运算符：<code>and(并且),or(或者),not（取非）</code><br>作用:用于连接多个条件时使用</p>
</li>
<li><p>关系运算符：</p>
<p><code>&gt;,&lt;,&gt;=,&lt;=,!=(不等于),=(等于),&lt;&gt;(不等于)</code></p>
</li>
</ul>
<h3 id="2-4-1-插入操作：INSERT"><a href="#2-4-1-插入操作：INSERT" class="headerlink" title="2.4.1 插入操作：INSERT"></a>2.4.1 插入操作：INSERT</h3><ul>
<li><p>常用命令：</p>
<p><code>insert into 表名(列名) values(数据值);</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student(stuname,stuage,stusex,birthday) <span class="keyword">values</span>(<span class="string">'张三1'</span>,<span class="number">18</span>,<span class="string">'a'</span>,<span class="string">'2000-1-1'</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意:</p>
<p>1多列和多个列值之间使用逗号隔开 </p>
<p>2.列名要和列值一一对应</p>
<p>3.非数值的列值两侧需要加单引号<br>  常见错误: <code>Data too long for column &#39;stusex&#39; at row 1</code></p>
<ul>
<li><p><strong>插入操作的简便写法：</strong></p>
<p>当给所有列添加数据的时候，添加数据的时候可以将列名省略，此时列值的顺序按照数据表中列的顺序执行</p>
<p><code>insert into student values(&#39;李四&#39;,12,&#39;1111&#39;,189.98,&#39;2000-1-1&#39;,&#39;男&#39;,&#39;2007-1-1&#39;);</code></p>
</li>
<li><p>同时添加多行:</p>
<p><code>insert into 表名(列名) values(第一行数据),(第二行数据),(),();</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">insert into student(stuname,stuage,stusex,birthday)</span><br><span class="line">values(&#39;张三3&#39;,18,&#39;a&#39;,&#39;2000-1-1&#39;),</span><br><span class="line">(&#39;张三4&#39;,18,&#39;a&#39;,&#39;2000-1-1&#39;),</span><br><span class="line">(&#39;张三5&#39;,18,&#39;a&#39;,&#39;2000-1-1&#39;),</span><br><span class="line">(&#39;张三6&#39;,18,&#39;a&#39;,&#39;2000-1-1&#39;),</span><br><span class="line">(&#39;张三7&#39;,18,&#39;a&#39;,&#39;2000-1-1&#39;),</span><br><span class="line">(&#39;张三8&#39;,18,&#39;a&#39;,&#39;2000-1-1&#39;);</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ul>
<li>列名与列值的类型、个数、顺序要一一对应。</li>
<li>参数值不要超出列定义的长度。</li>
<li>如果插入空值，请使用null</li>
<li>插入的日期和字符一样，都使用引号括起来。</li>
</ul>
</li>
</ul>
<h3 id="2-4-2-修改操作：update"><a href="#2-4-2-修改操作：update" class="headerlink" title="2.4.2 修改操作：update"></a>2.4.2 修改操作：update</h3><p><code>UPDATE 表名 SET 列名1=列值1,列名2=列值2 ... WHERE 列名=值</code></p>
<p>实例：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">将所有员工薪水修改为<span class="number">5000</span>元。</span><br><span class="line">将姓名为’zhangssan’的员工薪水修改为<span class="number">3000</span>元。</span><br><span class="line">将姓名为’lisi’的员工薪水修改为<span class="number">4000</span>元,resume改为ccc。</span><br><span class="line">将<span class="string">'你好'</span>的薪水在原有基础上增加<span class="number">1000</span>元。</span><br><span class="line"></span><br><span class="line">mysql&gt; update emp <span class="keyword">set</span> salary=<span class="number">5000</span>;</span><br><span class="line">Query OK, <span class="number">3</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line">Rows matched: <span class="number">3</span>  Changed: <span class="number">3</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql&gt; update emp <span class="keyword">set</span> salary=<span class="number">3000</span> where name=zhangsan;</span><br><span class="line">ERROR <span class="number">1054</span> (<span class="number">42</span>S22): Unknown column <span class="string">'zhangsan'</span> <span class="keyword">in</span> <span class="string">'where clause'</span></span><br><span class="line">mysql&gt; update emp <span class="keyword">set</span> salary=<span class="number">3000</span> where name=<span class="string">'zhangsan'</span>;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.01</span> sec)</span><br><span class="line">Rows matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql&gt; update emp <span class="keyword">set</span> salary=<span class="number">4000</span>,resume=<span class="string">'ccc'</span> where name=<span class="string">'lisi'</span>;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.01</span> sec)</span><br><span class="line">Rows matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql&gt;  update emp <span class="keyword">set</span> salary=salary+<span class="number">1000</span> where name=<span class="string">'你好'</span>;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.01</span> sec)</span><br><span class="line">Rows matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select * <span class="keyword">from</span> emp;</span><br><span class="line">+----+----------+--------+------------+---------+------------+----------+</span><br><span class="line">| id | name     | gender | birthday   | salary  | entry_date | resume   |</span><br><span class="line">+----+----------+--------+------------+---------+------------+----------+</span><br><span class="line">|  <span class="number">1</span> | zhangsan | female | <span class="number">1990</span><span class="number">-05</span><span class="number">-10</span> | <span class="number">3000.00</span> | <span class="number">2015</span><span class="number">-05</span><span class="number">-05</span> | goodgirl |</span><br><span class="line">|  <span class="number">2</span> | lisi     | male   | <span class="number">1995</span><span class="number">-05</span><span class="number">-10</span> | <span class="number">4000.00</span> | <span class="number">2015</span><span class="number">-05</span><span class="number">-05</span> | ccc      |</span><br><span class="line">|  <span class="number">3</span> | 你好     | male   | <span class="number">1995</span><span class="number">-05</span><span class="number">-10</span> | <span class="number">6000.00</span> | <span class="number">2015</span><span class="number">-05</span><span class="number">-05</span> | good boy |</span><br><span class="line">+----+----------+--------+------------+---------+------------+----------+</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="2-4-3-删除操作：DELETE"><a href="#2-4-3-删除操作：DELETE" class="headerlink" title="2.4.3 删除操作：DELETE"></a>2.4.3 删除操作：DELETE</h3><p><code>DELETE from 表名 【WHERE 列名=值】</code>或<code>TRUNCATE table 表名</code></p>
<p><strong>两种删除方法的区别（重要）</strong></p>
<ul>
<li>DELETE 删除表中的数据，表结构还在，删除后的数据可以找回</li>
<li>TRUNCATE 删除是把表直接DROP掉，然后再创建一个同样的新表。删除的数据不能找回。执行速度比DELETE快。</li>
</ul>
<h2 id="2-5-DCL（数据控制）"><a href="#2-5-DCL（数据控制）" class="headerlink" title="2.5 DCL（数据控制）"></a>2.5 DCL（数据控制）</h2><h3 id="2-5-1-创建用户"><a href="#2-5-1-创建用户" class="headerlink" title="2.5.1 创建用户"></a>2.5.1 创建用户</h3><ul>
<li><code>create user 用户名@指定ip identified by 密码;</code></li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create<span class="built_in"> user </span>test123@localhost IDENTIFIED by <span class="string">'test123'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>create user 用户名@客户端ip identified by 密码;</code> 指定IP才能登陆</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create<span class="built_in"> user </span>test456@10.4.10.18 IDENTIFIED by <span class="string">'test456'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>create user 用户名@‘% ’ identified by 密码;</code>任意IP均可登陆</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create<span class="built_in"> user </span>test7@<span class="string">'%'</span> IDENTIFIED by <span class="string">'test7'</span></span><br></pre></td></tr></table></figure>
<h3 id="2-5-2-用户授权"><a href="#2-5-2-用户授权" class="headerlink" title="2.5.2 用户授权"></a>2.5.2 用户授权</h3><ul>
<li><p>给指定用户授予指定数据库指定权限：</p>
<p><code>grant 权限1,权限2,........,权限n on 数据库名.* to 用户名@IP;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant select,insert,update,delete,create on</span><br><span class="line">chaoshi.* to &#39;test456&#39;@&#39;127.0.0.1&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>给指定用户授予所有数据库所有权限：</p>
<p><code>grant all on *.* to 用户名@IP</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant all on *.* to &#39;test456&#39;@&#39;127.0.0.1&#39;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-5-3-用户权限查询"><a href="#2-5-3-用户权限查询" class="headerlink" title="2.5.3 用户权限查询"></a>2.5.3 用户权限查询</h3><p><code>show grants for 用户名@IP;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show grants for &#39;root&#39;@&#39;%&#39;;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-4-撤销用户权限"><a href="#2-5-4-撤销用户权限" class="headerlink" title="2.5.4 撤销用户权限"></a>2.5.4 撤销用户权限</h3><p><code>revoke 权限1,权限2,........,权限n on 数据库名.* from 用户名@IP;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REVOKE SELECT ON *.* FROM &#39;root&#39;@&#39;%&#39; ;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-5-删除用户"><a href="#2-5-5-删除用户" class="headerlink" title="2.5.5 删除用户"></a>2.5.5 删除用户</h3><p><code>drop user 用户名@IP;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop user test123@localhost;</span><br></pre></td></tr></table></figure>
<h2 id="2-6-DQL数据查询"><a href="#2-6-DQL数据查询" class="headerlink" title="2.6 DQL数据查询"></a>2.6 DQL数据查询</h2><p>数据库执行DQL语句不会对数据进行改变，而是让数据库发送结果集给客户端。<strong>查询返回的结果集是一张虚拟表</strong>。</p>
<p>查询关键字：SELECT</p>
<p><code>语法： SELECT 列名 FROM 表名 【修饰条件——见下表】</code></p>
<p>列名可以用*代替，表示所有列！！</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 要查询的列名称</span><br><span class="line"><span class="keyword">FROM</span> 表名称</span><br><span class="line"><span class="keyword">WHERE</span> 限定条件 <span class="comment">/*行条件*/</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> grouping_columns <span class="comment">/*对结果分组*/</span></span><br><span class="line"><span class="keyword">HAVING</span> condition <span class="comment">/*分组后的行条件*/</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sorting_columns <span class="comment">/*对结果分组*/</span></span><br><span class="line"><span class="keyword">LIMIT</span> offset_start, <span class="built_in">row_count</span> <span class="comment">/*结果限定*/</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-1-简单查询"><a href="#2-6-1-简单查询" class="headerlink" title="2.6.1 简单查询"></a>2.6.1 简单查询</h3><p>查询所有列</p>
<p><code>SELECT * FROM stu;</code></p>
<p>查询指定列</p>
<p><code>SELECT sid, sname, age FROM stu;</code></p>
<h3 id="2-6-2-条件查询"><a href="#2-6-2-条件查询" class="headerlink" title="2.6.2 条件查询"></a>2.6.2 条件查询</h3><p>条件查询就是在查询时给出WHERE子句，在WHERE子句中可以使用如下运算符及关键字：<br>=、!=、&lt;&gt;、&lt;、&lt;=、&gt;、&gt;=; BETWEEN…AND； IN(set)； IS NULL； AND；OR； NOT；</p>
<ul>
<li><p>IN的用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询学号为S_1001，S_1002，S_1003的记录:</span><br><span class="line">SELECT * FROM stu WHERE sid IN (&#39;S_1001&#39;,&#39;S_1002&#39;,&#39;S_1003&#39;);</span><br><span class="line">查询学号不是S_1001，S_1002，S_1003的记录</span><br><span class="line">SELECT * FROM tab_student WHERE sid NOT IN(&#39;S1001&#39;,&#39;S1002&#39;,&#39;S_1003&#39;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>null的用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询年龄为null的记录</span><br><span class="line">SELECT * FROM stu WHERE age IS NULL;</span><br></pre></td></tr></table></figure>
</li>
<li><p>between and的用法(包含临界值)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询年龄在20到40之间的学生记录</span><br><span class="line">SELECT * FROM stu WHERE age BETWEEN 20 AND 40;</span><br><span class="line">&#x3D;&#x3D;</span><br><span class="line">SELECT * FROM stu WHERE age&gt;&#x3D;20 AND age&lt;&#x3D;40;</span><br></pre></td></tr></table></figure>
</li>
<li><p>“非”的条件判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询性别非男的学生记录:</span><br><span class="line">1.SELECT * FROM stu WHERE gender!&#x3D;&#39;male&#39;;</span><br><span class="line">2.SELECT * FROM stu WHERE NOT gender&#x3D;&#39;male&#39;;</span><br><span class="line">3.SELECT * FROM stu WHERE gender&lt;&gt;&#39;male&#39;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-6-3-模糊查询"><a href="#2-6-3-模糊查询" class="headerlink" title="2.6.3 模糊查询"></a>2.6.3 模糊查询</h3><p>百度搜索就是比较典型的模糊查询</p>
<p>当想查询“姓名中包含a字母的学生“时就需要使用模糊查询了。模糊查询需要使用关键字LIKE。</p>
<p><code>列名 like &#39;表达式&#39;</code>//表达式必须是字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通配符:(类似正则表达)</span><br><span class="line">_(下划线): 任意一个字符</span><br><span class="line">%：任意0~n个字符,&#39;张%&#39;</span><br></pre></td></tr></table></figure>
<p>实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(1)查询姓名由3个字构成的学生记录</span><br><span class="line">SELECT * FROM stu WHERE sname LIKE &#39;___&#39;;</span><br><span class="line">(2)查询姓名由5个字母构成，并且第5个字母为“i”的学生记录</span><br><span class="line">SELECT * FROM stu WHERE sname LIKE &#39;____i&#39;;</span><br><span class="line">(3)查询姓名中第2个字母为“i”的学生记录</span><br><span class="line">SELECT * FROM stu WHERE sname LIKE &#39;_i%&#39;;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-4-字段控制查询"><a href="#2-6-4-字段控制查询" class="headerlink" title="2.6.4 字段控制查询"></a>2.6.4 字段控制查询</h3><p>(1)去除重复记录<br>去除重复记录（两行或两行以上记录的数据相同），例如stu表中gender字段就存在相同的记录(只有男和女)。当只查询stu表的gender字段时，那么会出现重复记录，那么想去除重复记录，需要使用<br><code>DISTINCT</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT gender FROM stu;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 查询性别列，去除重复记录</span><br><span class="line">mysql&gt; select distinct gender from stu;</span><br><span class="line">+--------+</span><br><span class="line">| gender |</span><br><span class="line">+--------+</span><br><span class="line">| male   |</span><br><span class="line">| female |</span><br><span class="line">| NULL   |</span><br><span class="line">+--------+</span><br><span class="line">3 rows in set (0.04 sec)</span><br><span class="line"># 执行加法运算，排除空值得可能</span><br><span class="line">mysql&gt; select 100+ifnull(age,0) from stu;</span><br><span class="line">+-------------------+</span><br><span class="line">| 100+ifnull(age,0) |</span><br><span class="line">+-------------------+</span><br><span class="line">|               135 |</span><br><span class="line">|               115 |</span><br><span class="line">|               195 | </span><br><span class="line">+-------------------+</span><br><span class="line">11 rows in set (0.00 sec)</span><br><span class="line"># 执行加法运算，同时对新的列重命名</span><br><span class="line">mysql&gt; select 100+ifnull(age,0) As total from stu;</span><br><span class="line">+-------+</span><br><span class="line">| total |</span><br><span class="line">+-------+</span><br><span class="line">|   135 |</span><br><span class="line">|   115 |</span><br><span class="line">|   195 |</span><br><span class="line">+-------+</span><br><span class="line">11 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>给列起别名时，是可以省略AS关键字的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT *,sal+IFNULL(comm,0) total FROM emp;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-5-排序"><a href="#2-6-5-排序" class="headerlink" title="2.6.5 排序"></a>2.6.5 排序</h3><p><code>order by 列名 asc/desc</code></p>
<p>//asc：升序； desc：降序；默认不写的话是升序</p>
<p>多列排序：当前面的列的值相同的时候，才会按照后面的列值进行排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询所有雇员，按月薪降序排序，如果月薪相同时，按编号升序排序</span><br><span class="line">SELECT * FROM emp ORDER BY sal DESC,empno ASC;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-6-聚合函数"><a href="#2-6-6-聚合函数" class="headerlink" title="2.6.6 聚合函数"></a>2.6.6 聚合函数</h3><p>聚合函数是用来做纵向运算的函数：</p>
<ul>
<li>COUNT(列名)：统计指定列不为NULL的记录行数；</li>
<li>MAX(列名)：计算指定列的最大值，如果指定列是字符串类型，那么使用字符串排序运算；</li>
<li>MIN(列名)：计算指定列的最小值，如果指定列是字符串类型，那么使用字符串排序运算；</li>
<li>SUM(列名)：计算指定列的数值和，如果指定列类型不是数值类型，那么计算结果为0；</li>
<li>AVG(列名)：计算指定列的平均值，如果指定列类型不是数值类型，那么计算结果为0；</li>
</ul>
<p><strong>1.count的用法</strong></p>
<ul>
<li><p>查询emp表中记录数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) AS cnt FROM emp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询emp表中有佣金的人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(comm) cnt FROM emp;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>因为count()函数中给出的是comm列，那么只统计comm列非NULL的行数。</p>
</li>
<li><p>统计月薪与佣金之和大于2500元的人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) AS cnt FROM empWHERE sal+IFNULL(comm,0) &gt; 2500;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>2.SUM和AVG</strong></p>
<ul>
<li><p>查询所有雇员月薪和，以及所有雇员佣金和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(sal), SUM(comm) FROM emp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>统计所有员工平均工资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(sal) FROM emp;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>3.MAX和MIN</strong></p>
<ul>
<li><p>查询最高工资和最低工资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT MAX(sal), MIN(sal) FROM emp;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-6-7-分组查询"><a href="#2-6-7-分组查询" class="headerlink" title="2.6.7 分组查询"></a>2.6.7 分组查询</h3><p><code>group by</code><br><strong>注意:</strong>如果查询语句中有分组操作，则select后面能添加的只能是聚合函数和被分组的列名</p>
<ul>
<li><p>查询每个部门的部门编号以及每个部门的人数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select deptno,count(*) from emp group by deptno;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询每个部门的部门编号以及每个部门工资大于1500的人数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select deptno,count(*) from emp where sal&gt;1500 group by deptno;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>多列分组</strong></p>
<p><code>group by 列名，列名</code></p>
<ul>
<li><p>统计出stu表中每个班级的男女生各多少人</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select gradename,gender ,count(*) from stu group by gradename,gender</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-6-8-having"><a href="#2-6-8-having" class="headerlink" title="2.6.8 having"></a>2.6.8 having</h3><p>类似于where 的条件语句（或者说过滤语句）</p>
<p><strong>注：having与where的区别:</strong></p>
<ol>
<li>having是在分组后对数据进行过滤，where是在分组前对数据进行过滤</li>
<li>having后面可以使用分组函数(统计函数)，where后面不可以使用分组函数。</li>
<li>WHERE是对分组前记录的条件，如果某行记录没有满足WHERE子句的条件，那么这行记录不会参加分组；而HAVING是对分组后数据的约束。</li>
</ol>
<p>最关键的一点：having的出现必然伴随着<code>group by</code>语句</p>
<ul>
<li>查询工资总和大于9000的部门编号以及工资和</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select deptno,sum(sal) from emp group by deptno having sum(sal)&gt;9000;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-9-limit（分页"><a href="#2-6-9-limit（分页" class="headerlink" title="2.6.9 limit（分页)"></a>2.6.9 limit（分页)</h3><p>LIMIT用来限定查询结果的起始行，以及总行数。</p>
<p><code>limit 开始下标,显示条数；</code>//开始下标从0开始<br><code>limit 显示条数；</code>//表示默认从0开始获取数据</p>
<ul>
<li><p>查询10行记录，起始行从3开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT* FROM emp limit 3,10;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>页数多就会出现一个问题，如果一页记录为10条，希望查看第3页记录应该怎么查呢？</p>
</blockquote>
<p>l 第一页记录起始行为0，一共查询10行； limit 0,10<br>l 第二页记录起始行为10，一共查询10行；limit 10,10<br>l 第三页记录起始行为20，一共查询10行； limit 20,10</p>
<p>此时可以通过函数的方式简单解决：</p>
<p>pageIndex 页码值 pageSize 每页显示条数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from stu limit (pageindex-1)*pagesize,  pagesize;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-总结"><a href="#2-6-总结" class="headerlink" title="2.6 总结"></a>2.6 总结</h3><p>查询语句书写顺序：select – from- where- groupby- having- order by-limit<br>查询语句执行顺序：from - where -group by -having - select - order by-limit</p>
<h2 id="2-7-客户端工具"><a href="#2-7-客户端工具" class="headerlink" title="2.7 客户端工具"></a>2.7 客户端工具</h2><p>4.1 基于Navicat实现数据库操作<br>4.2 基于SQLyog实现数据库操作</p>
<h1 id="3-数据库高级"><a href="#3-数据库高级" class="headerlink" title="3. 数据库高级"></a>3. 数据库高级</h1><h2 id="3-1-数据库的完整性"><a href="#3-1-数据库的完整性" class="headerlink" title="3.1 数据库的完整性"></a>3.1 数据库的完整性</h2><p>用来保证存放到数据库中的数据是有效的,即数据的有效性和准确性</p>
<p>确保数据的完整性 = 在创建表时给表中添加约束（核心就是约束两个字）</p>
<p>完整性的分类：</p>
<ul>
<li><p>实体完整性(行完整性):</p>
</li>
<li><p>域完整性(列完整性):</p>
</li>
<li><p>引用完整性(关联表完整性):</p>
<p>体现：</p>
<p>主键约束：primary key<br>唯一约束：unique [key]<br>非空约束：not null<br>默认约束：default<br>自动增长：auto_increment<br>外键约束: foreign key<br>建议这些约束应该在创建表的时候设置，多个约束条件之间使用空格间隔</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table student(</span><br><span class="line">    studentno int primary key auto_increment,</span><br><span class="line">    loginPwd varchar(20) not null default &#39;123456&#39;,</span><br><span class="line">    studentname varchar(50) not null,</span><br><span class="line">    sex char(2) not null,</span><br><span class="line">    gradeid int not null,</span><br><span class="line">    phone varchar(255) not null,</span><br><span class="line">    address varchar(255) default &#39;学生宿舍&#39;,</span><br><span class="line">    borndate datetime,</span><br><span class="line">    email varchar(50)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="3-2-实体完整性（记录）"><a href="#3-2-实体完整性（记录）" class="headerlink" title="3.2 实体完整性（记录）"></a>3.2 实体完整性（记录）</h2><p><strong>实体：即表中的一行(一条记录)代表一个实体（entity）</strong><br><strong>实体完整性的作用：标识每一行数据不重复。</strong><br><strong>约束类型（3）：主键约束（primary key），唯一约束(unique)， 自动增长列(auto_increment)</strong></p>
<ul>
<li><p>主键约束（primary key）（特点：数据唯一，且不能为null）</p>
<p>注：每个表中要有一个主键。</p>
<p>3种添加主键的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#常规</span><br><span class="line">CREATE TABLE student( id int primary key, name varchar(50) );</span><br><span class="line">#创建联和主键</span><br><span class="line">CREATE TABLE student( id int, name varchar(50), primary key(id) );</span><br><span class="line">CREATE TABLE student( classid int, stuid int, name varchar(50), primary</span><br><span class="line">key(classid,stuid) );</span><br><span class="line">#第三种</span><br><span class="line">CREATE TABLE student( id int, name varchar(50) );</span><br><span class="line">ALTER TABLE student ADD PRIMARY KEY (id);</span><br></pre></td></tr></table></figure>
</li>
<li><p>唯一约束(unique)（特点：数据唯一，且不能为null）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student( Id int primary key, Name varchar(50) unique );</span><br></pre></td></tr></table></figure>
</li>
<li><p>自动增长列(auto_increment)</p>
<p>sqlserver数据库 (identity-标识列)  //  oracle数据库(sequence-序列)<br>注意：给主键添加自动增长的数值，列只能是整数类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student( Id int primary key auto_increment, Name varchar(50) );</span><br><span class="line">INSERT INTO student(name) values(‘tom’);</span><br></pre></td></tr></table></figure>
<p>此时再添加记录时不需要在填入id的值，可以自动增长</p>
</li>
</ul>
<h2 id="3-3-域完整性"><a href="#3-3-域完整性" class="headerlink" title="3.3 域完整性"></a>3.3 域完整性</h2><p><strong>域：代表当前单元格</strong>（单元格）</p>
<p><strong>域完整性的作用：限制此单元格的数据正确，不对照此列的其它单元格比较</strong></p>
<p><strong>域完整性约束（4）：数据类型，非空约束（not null），默认值约束(default) ，check约束（mysql不支持，check(sex=’男’ or sex=’女’)</strong></p>
<h3 id="3-3-1-数据类型"><a href="#3-3-1-数据类型" class="headerlink" title="3.3.1 数据类型"></a>3.3.1 数据类型</h3><ul>
<li><p>数值类型</p>
<p>| 类型      | 大小   | 范围（有符号）                                               | 范围（无符号 ）                                              | 用途           |<br>| ————- | ——— | —————————————————————————————— | —————————————————————————————— | ——————— |<br>| tinyint   | 1 字节 | (-128，127)                                                  | (0，255)                                                     | 小整数值       |<br>| smallint  | 2 字节 | (-32 768，32 767)                                            | (0，65 535)                                                  | 大整数值       |<br>| mediumint | 3 字节 | (-8 388 608，8 388 607)                                      | (0，16 777 215)                                              | 大整数值       |<br>| INT       | 4 字节 | (-2 147 483 648，2 147 483 647)                              | (0，4 294 967 295)                                           | 大整数值       |<br>| bigint    | 8 字节 | (-9 233 372 036 854 775 808，9 223 372 036 854 775 807)      | (0，18 446 744073 709 551 615)                               | 极大整数值     |<br>| float     | 4 字节 | (-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402823 466 351 E+38) | 0，(1.175 494 351 E-38，3.402 823 466 E+38)                  | 单精度浮点数值 |<br>| double    | 8 字节 | (-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 0，(2.225 073 858 507 201 4E-308，1.797 693 134 862 315 7 E+308) | 双精度浮点数值 |</p>
</li>
<li><p>日期类型</p>
<p>表示时间值的日期和时间类型为DATETIME、DATE、TIMESTAMP、TIME和YEAR。<br>每个时间类型有一个有效值范围和一个”零”值，当指定不合法的MySQL不能表示的值时使用”零”值。<br>TIMESTAMP类型有专有的自动更新特性</p>
<p>| 类型      | 大小(字节) | 范围                                                         | 格式                | 用途                                                       |<br>| ————- | ————— | —————————————————————————————— | —————————- | ————————————————————————————— |<br>| TIMESTAMP | 4          | 1970-01-01 00:00:00/2038 结束时间是第 <em>2147483647</em> 秒，北京时间 <em>2038-1-19 11:14:07</em>，格林尼治时间 2038年1月19日 凌晨 03:14:07 | YYYYMMDD HHMMSS     | 混合日期和时间值，时间戳 ,当更新数据的时候自动添加更新时间 |<br>| DATETIME  | 8          | 1000-01-01 00:00:00/9999-12-31 23:59:59                      | YYYY-MM-DD HH:MM:SS | 混合日期和时间值                                           |<br>| DATE      | 3          | 1000-01-01/9999-12-31                                        | YYYY-MM-DD          | 日期值                                                     |<br>| TIME      | 3          | ‘-838:59:59’/‘838:59:59’                                     | HH:MM:SS            | 时间值或持续时间                                           |<br>| YEAR      | 1          | 1901/2155                                                    | YYYY                | 年份值                                                     |</p>
</li>
<li><p>字符串类型</p>
<p>字符串类型指CHAR、VARCHAR、BINARY、VARBINARY、BLOB、TEXT、ENUM和SET</p>
<p>| 类型       | 大小                | 用途                            |<br>| ————— | —————————- | ———————————————- |<br>| CHAR       | 0-255字节           | 定长字符串                      |<br>| VARCHAR    | 0-65535 字节        | 变长字符串                      |<br>| TINYBLOB   | 0-255字节           | 不超过 255 个字符的二进制字符串 |<br>| TINYTEXT   | 0-255字节           | 短文本字符串                    |<br>| BLOB       | 0-65 535字节        | 二进制形式的长文本数据          |<br>| TEXT       | 0-65 535字节        | 长文本数据                      |<br>| MEDIUMBLOB | 0-16 777 215字节    | 二进制形式的中等长度文本数据    |<br>| MEDIUMTEXT | 0-16 777 215字节    | 中等长度文本数据                |<br>| LONGBLOB   | 0-4 294 967 295字节 | 二进制形式的极大文本数据        |<br>| LONGTEXT   | 0-4 294 967 295字节 | 极大文本数据                    |</p>
<ul>
<li>CHAR和VARCHAR类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检索过程中不进行大小写转换</li>
<li>BINARY和VARBINARY类类似于CHAR和VARCHAR，不同的是它们包含二进制字符串而不要非二进制字符串。也就是说，它们包含字节字符串而不是字符字符串。这说明它们没有字符集，并且排序和比较基于列值字节的数值</li>
<li>BLOB是一个二进制大对象，可以容纳可变数量的数据。有4种BLOB类型：TINYBLOB、BLOB、MEDIUMBLOB和LONGBLOB。它们只是可容纳值的最大长度不同</li>
<li>有4种TEXT类型：TINYTEXT、TEXT、MEDIUMTEXT和LONGTEXT。这些对应4种BLOB类型，有相同的最大长度和存储需求</li>
</ul>
</li>
</ul>
<h3 id="3-3-2-非空和默认约束（not-null-default）"><a href="#3-3-2-非空和默认约束（not-null-default）" class="headerlink" title="3.3.2 非空和默认约束（not null/default）"></a>3.3.2 非空和默认约束（not null/default）</h3><ul>
<li><p>not null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student( Id int primary key, Name varchar(50) not null, Sexvarchar(10) ); </span><br><span class="line">INSERT INTO student values(1,’tom’,null);</span><br></pre></td></tr></table></figure>
</li>
<li><p>default</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student( Id int primary key, Name varchar(50) not null, Sexvarchar(10) default &#39;男&#39; );</span><br><span class="line">insert intostudent1 values(1,&#39;tom&#39;,&#39;女&#39;);</span><br><span class="line">insert intostudent1 values(2,&#39;jerry&#39;,default);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-4-引用完整性"><a href="#3-4-引用完整性" class="headerlink" title="3.4 引用完整性"></a>3.4 引用完整性</h2><p>外键约束：FOREIGN KEY</p>
<p><strong>外键列的数据类型一定要与主键的类型一致</strong></p>
<p>constraint 自定义外键名称 foreign key(外键列名) references 主键表名(主键列名)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student(id int primary key, name varchar(50) not null, sex varchar(10) default &#39;男&#39; );</span><br><span class="line">create table score(</span><br><span class="line">    id int primary key,</span><br><span class="line">    score int,</span><br><span class="line">    sid int ,#(外键名称)</span><br><span class="line">    constraint fk_score_sid foreign key(sid) references student(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE score ADD CONSTRAINT fk_stu_score FOREIGN KEY(sid) REFERENCES stu(id)</span><br></pre></td></tr></table></figure>
<h1 id="4-多表查询（联查）"><a href="#4-多表查询（联查）" class="headerlink" title="4. 多表查询（联查）"></a>4. 多表查询（联查）</h1><p>多个表之间是有关系的，那么关系靠谁来维护?<br>多表约束：外键列</p>
<h2 id="4-1-多表的关系"><a href="#4-1-多表的关系" class="headerlink" title="4.1 多表的关系"></a>4.1 多表的关系</h2><h3 id="4-1-1-一对多-多对一关系"><a href="#4-1-1-一对多-多对一关系" class="headerlink" title="4.1.1 一对多/多对一关系"></a>4.1.1 一对多/多对一关系</h3><p>客户和订单，分类和商品，部门和员工</p>
<p>站在客户的角度，就是一对多，换位置站在订单的角度就是多对一！</p>
<p><strong>一对多建表原则：在多的一方创建一个字段，字段作为外键指向一的一方的主键</strong></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以雇员和部门为例：</span><br><span class="line">部门表（部门<span class="built_in">id</span>，部门名称）</span><br><span class="line">员工表（员工<span class="built_in">id</span>，员工名称）</span><br><span class="line">如果按一到多的形式添加外键（将员工<span class="built_in">id</span>作为外键添加到部门表）：则部门表一定出现重复</span><br><span class="line">如果部门的主键<span class="built_in">id</span>字段传入员工表作为外键，此时只需要外键重复，员工记录无需重复</span><br></pre></td></tr></table></figure>
<h3 id="4-1-2-多对多关系"><a href="#4-1-2-多对多关系" class="headerlink" title="4.1.2 多对多关系"></a>4.1.2 多对多关系</h3><p>学生和课程的关系</p>
<p>多对多关系建表原则：需要创建第三张表，中间表中至少两个字段，这两个字段分别作为外键指向各自一方的主键</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">课程表的主键classid，学生表的主键stuid</span><br><span class="line">中间表middle的内容如何建立：</span><br><span class="line">主键：middleid</span><br><span class="line">映射：stuid，classid</span><br><span class="line">对于stuid为<span class="number">1</span>的学生，学习哪几门课程，就将classid填入</span><br></pre></td></tr></table></figure>
<h3 id="4-1-3-一对一关系"><a href="#4-1-3-一对一关系" class="headerlink" title="4.1.3 一对一关系"></a>4.1.3 一对一关系</h3><p>夫妻关系</p>
<p>在实际的开发中应用不多.因为一对一可以创建成一张表.</p>
<p><strong>两种建表原则：</strong></p>
<p><strong>唯一外键对应：在一方创建一个外键指向另一方的主键，但这时候仍可能出现一对多的问题，此时，可以对外键设置为unique约束</strong></p>
<p>主键对应：让一对一的双方的主键建立关系（一方的主键同时也是外键，和另一方的主键挂钩），此时，主键自身的无重复就取代了unique约束，也不用再额外创建外键列</p>
<h2 id="4-2-多表查询方式"><a href="#4-2-多表查询方式" class="headerlink" title="4.2 多表查询方式"></a>4.2 多表查询方式</h2><p>多表查询有如下几种：</p>
<ol>
<li><p>合并结果集：<code>UNION</code>、 <code>UNION ALL</code></p>
</li>
<li><p><strong>连接查询</strong></p>
<ul>
<li><p>内连接 <code>[INNER] JOIN ON</code></p>
</li>
<li><p>外连接 <code>OUTER JOIN ON</code></p>
<ul>
<li><p>左外连接 <code>LEFT [OUTER] JOIN</code></p>
</li>
<li><p>右外连接 <code>RIGHT [OUTER] JOIN</code></p>
</li>
<li><p>全外连接（MySQL不支持）<code>FULL JOIN</code></p>
</li>
</ul>
</li>
<li><p>自然连接 <code>NATURAL JOIN</code></p>
</li>
</ul>
</li>
<li><p><strong>子查询</strong></p>
</li>
</ol>
<h3 id="4-2-1-合并结果集"><a href="#4-2-1-合并结果集" class="headerlink" title="4.2.1 合并结果集"></a>4.2.1 合并结果集</h3><p>作用：合并结果集就是把两个select语句的查询结果合并到一起！</p>
<p><strong>前提：两个select语句的列数和列的类型相同</strong></p>
<p>合并结果集有两种方式：</p>
<ul>
<li><p>UNION：去除重复记录，例如：<code>SELECT* FROM t1 UNION SELECT * FROM t2；</code></p>
</li>
<li><p>UNION ALL：不去除重复记录，例如：<code>SELECT * FROM t1 UNION ALL SELECT * FROM t2;</code></p>
</li>
</ul>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210331104222.png" alt="image-20210331104215408"></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210331104257.png" alt="image-20210331104257106"></p>
<h3 id="4-2-2-连接查询"><a href="#4-2-2-连接查询" class="headerlink" title="4.2.2 连接查询"></a>4.2.2 连接查询</h3><p>连接查询就是求出多个表的乘积，例如t1连接t2，那么查询出的结果就是t1*t2。</p>
<p><code>select * from t1,t2;</code></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210331104510.png" alt="image-20210331104510793"></p>
<p>连接查询会产生笛卡尔积，假设集合A={a,b}，集合B={0,1,2}，则两个集合的笛卡尔积为{(a,0),(a,1),(a,2),(b,0),(b,1),(b,2)}。可以扩展到多个集合的情况。</p>
<blockquote>
<p>那么多表查询产生这样的结果并不是我们想要的，那么怎么去除重复的，不想要的记录呢，当然是通过条件过滤。通常要查询的多个表之间都存在关联关系，那么就通过关联关系去除笛卡尔积。</p>
</blockquote>
<p>实例：emp-员工表，dept-部门表</p>
<ul>
<li>笛卡尔积结果</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE dept1(</span><br><span class="line">    deptno int primary key,</span><br><span class="line">    dname varchar(14),</span><br><span class="line">    loc varchar(13)</span><br><span class="line">);</span><br><span class="line">insert into dept1 values(10,&#39;服务部&#39;,&#39;北京&#39;);</span><br><span class="line">insert into dept1 values(20,&#39;研发部&#39;,&#39;北京&#39;);</span><br><span class="line">insert into dept1 values(30,&#39;销售部&#39;,&#39;北京&#39;);</span><br><span class="line">insert into dept1 values(40,&#39;主管部&#39;,&#39;北京&#39;);</span><br><span class="line">CREATE TABLE emp1(</span><br><span class="line">    empno int,</span><br><span class="line">    ename varchar(50),</span><br><span class="line">    job varchar(50),</span><br><span class="line">    mgr int,</span><br><span class="line">    hiredate date,</span><br><span class="line">    sal double,</span><br><span class="line">    comm double,</span><br><span class="line">    deptno int</span><br><span class="line">);</span><br><span class="line">insert into emp1 values(1001,&#39;张三&#39;,&#39;文员&#39;,1006,&#39;2019-1-1&#39;,1000,2010,10);</span><br><span class="line">insert into emp1 values(1002,&#39;李四&#39;,&#39;程序员&#39;,1006,&#39;2019-2-1&#39;,1100,2000,20);</span><br><span class="line">insert into emp1 values(1003,&#39;王五&#39;,&#39;程序员&#39;,1006,&#39;2019-3-1&#39;,1020,2011,20);</span><br><span class="line">insert into emp1 values(1004,&#39;赵六&#39;,&#39;销售&#39;,1006,&#39;2019-4-1&#39;,1010,2002,30);</span><br><span class="line">insert into emp1 values(1005,&#39;张猛&#39;,&#39;销售&#39;,1006,&#39;2019-5-1&#39;,1001,2003,30);</span><br><span class="line">insert into emp1 values(1006,&#39;谢娜&#39;,&#39;主管&#39;,1006,&#39;2019-6-1&#39;,1011,2004,40);</span><br><span class="line">select * from emp,dept;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210331105111.png" alt="image-20210331105111685"></p>
<p>可以看到笛卡尔积的重复情况是非常可怕的</p>
<ul>
<li><p>使用主外键关系做为条件来去除无用信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp,dept WHERE emp.deptno&#x3D;dept.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210331105236.png" alt="image-20210331105236904"></p>
<p>上面查询结果会把两张表的所有列都查询出来，也许你不需要那么多列，这时就可以指定要查询的列了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT emp.ename,emp.sal,emp.comm,dept.dname </span><br><span class="line">FROM emp,dept </span><br><span class="line">WHERE emp.deptno&#x3D;dept.deptno;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210331105830.png" alt="image-20210331105830732"></p>
</li>
</ul>
<p>上面的连接语句就是内连接，但它不是SQL标准中的查询方式，可以理解为方言！</p>
<h3 id="4-2-3-连接查询-内联查询"><a href="#4-2-3-连接查询-内联查询" class="headerlink" title="4.2.3 连接查询-内联查询"></a>4.2.3 连接查询-内联查询</h3><ul>
<li><p>语法1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select 列名 from 表1</span><br><span class="line">inner join 表2</span><br><span class="line">on 表1.列名&#x3D;表2.列名 #外键列的关系</span><br><span class="line">where.....</span><br></pre></td></tr></table></figure>
</li>
<li><p>等价于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select 列名 from 表1,表2</span><br><span class="line">where 表1.列名&#x3D;表2.列名 and ...(其他条件)</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意点：</p>
<p><1>表1和表2的顺序可以互换<br><2><strong>找两张表的等值关系时,找表示相同含义的列作为等值关系</strong><br><3>点操作符表示“的”，格式：<code>表名.列名</code><br><4>可以使用as，给表名起别名，注意定义别名之后，统一使用别名</p>
</li>
<li><p>实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;查询学生表中的学生姓名和分数表中的分数</span><br><span class="line">select name,score from student as s</span><br><span class="line">inner join scores as c</span><br><span class="line">on s.studentid&#x3D;c.stuid</span><br><span class="line">等价于：</span><br><span class="line">select name,score from student as s,scores as c</span><br><span class="line">where s.studentid&#x3D;c.stuid</span><br></pre></td></tr></table></figure>
</li>
<li><p>三表联查</p>
<p>语法：<br><code>select 列名 from 表1
inner join 表2 on 表1.列名=表2.列名
inner join 表3 on 表1或表2.列名=表3.列名 where</code><br>等价于:<br><code>select 列名 from 表1,表2,表3
where 表1.列名=表2.列名 and 表1/表2.列名=表3.列名</code></p>
<p>上述语法中提到的“表1或表2”，指三表中和另外两张表都有联系的表，作为桥梁</p>
</li>
<li><p><strong>内联查询的特点：查询结果必须满足条件，这也意味着表中不满足条件的数据会被抛弃</strong></p>
</li>
</ul>
<h3 id="4-3-3-连接查询-外联查询"><a href="#4-3-3-连接查询-外联查询" class="headerlink" title="4.3.3 连接查询-外联查询"></a>4.3.3 连接查询-外联查询</h3><p>外连接的特点：查询出的结果存在不满足条件的可能（主表的数据被全数保存下来）</p>
<p>使用场景：一般会作为子查询的语句使用</p>
<p>左外联：<code>select 列名 from 主表 left join 次表 on 主表.列名=次表.列名</code></p>
<p>右外联：<code>select 列名 from 次表 right join 主表 on 主表.列名=次表.列名</code></p>
<blockquote>
<p>主表数据全部显示，次表数据匹配显示，能匹配到的显示数据，匹配不成功的显示null<br>主表和次表不能随意调换位置</p>
</blockquote>
<p><strong>实例：</strong></p>
<p>以上面雇员和部门的两张表为例，在雇员中添加一行员工记录，部门50（部门表中不存在）</p>
<p><code>insert into emp values(1007,&#39;何炅&#39;,&#39;主管&#39;,1006,&#39;2019-6-1&#39;,1011,2004,50);</code></p>
<p>以员工表为主表进行外联查询，同样以部门的等值关系作为条件，如图，不符合条件的50部门同样能够显示</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210331143814.png" alt="image-20210331143814404"></p>
<p>同样可以把主表和次表按照右外联进行组织，部门表在前，雇员表在后</p>
<p><strong>连接查询心得：</strong></p>
<p>连接不限与两张表，连接查询也可以是三张、四张，甚至N张表的连接查询。通常连接查询不可能需要整个笛卡尔积，而只是需要其中一部分，那么这时就需要使用条件来去除不需要的记录。这个条件大多数情况下都是使用主外键关系去除。</p>
<p>两张表的连接查询一定有一个主外键关系，三张表的连接查询就一定有两个主外键关系，所以在大家不是很熟悉连接查询时，首先要学会去除无用笛卡尔积，那么就是用主外键关系作为条件来处理。如果两张表的查询，那么至少有一个主外键条件，三张表连接至少有两个主外键条件。</p>
<h3 id="4-3-4-连接查询-自然连接"><a href="#4-3-4-连接查询-自然连接" class="headerlink" title="4.3.4 连接查询-自然连接"></a>4.3.4 连接查询-自然连接</h3><p>自然连接（NATURAL INNER JOIN）：</p>
<p>自然连接是一种特殊的等值连接，他要求两个关系表中进行连接的必须是相同的属性列（名字相同），无须添加连接条件，并且在结果中消除重复的属性列，下面给出几个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp e natural join dept d;</span><br></pre></td></tr></table></figure>
<h3 id="4-3-5-子查询"><a href="#4-3-5-子查询" class="headerlink" title="4.3.5 子查询"></a>4.3.5 子查询</h3><p>一个select语句中包含另一个完整的select语句。</p>
<p>子查询就是嵌套查询，即SELECT中包含SELECT，如果一条语句中存在两个，或两个以上SELECT，那么就是子查询语句了。</p>
<ul>
<li><p>子查询出现的位置：</p>
<ul>
<li><p>where后，作为条为被查询的一条件的一部分；</p>
<p>当子查询出现在where后作为条件时，还可以使用如下关键字：</p>
<ul>
<li>any</li>
<li>all</li>
</ul>
</li>
<li><p>from后，作表；(select查询语句本来就会产生一张虚拟表)</p>
</li>
</ul>
</li>
<li><p>子查询结果集的形式：</p>
<ul>
<li>单行单列（用于条件）</li>
<li>单行多列（用于条件）</li>
<li>多行单列（用于条件）</li>
<li>多行多列（用于表）</li>
</ul>
</li>
<li><p><strong>实例：工资高于30号部门所有人的员工信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROMemp WHERE sal&gt;(SELECT MAX(sal) FROM emp WHERE deptno&#x3D;30);</span><br></pre></td></tr></table></figure>
<p>查询条件：工资高于30部门所有人工资，其中30部门所有人工资是子查询。高于所有需要使用all关键字。</p>
<p>第一步：查询30部门所有人工资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT sal FROM emp WHERE deptno&#x3D;30;</span><br></pre></td></tr></table></figure>
<p>第二步：查询高于30部门所有人工资的员工信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE sal &gt; ALL (第一步);</span><br><span class="line">SELECT * FROM emp WHERE sal &gt; ALL (SELECT sal FROM emp WHERE deptno&#x3D;30;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="5-扩展"><a href="#5-扩展" class="headerlink" title="5. 扩展"></a>5. 扩展</h1><p>核心：多表操作必然是要先建立多表关系（内连，外联，自然）</p>
<h2 id="5-1-多表更新（多表联调）"><a href="#5-1-多表更新（多表联调）" class="headerlink" title="5.1 多表更新（多表联调）"></a>5.1 多表更新（多表联调）</h2><ul>
<li><p><code>update 表1,表2 set 列名=列值 where 表1.列名=表2.列名 and 其他限定条件</code></p>
</li>
<li><p><code>update 表1 inner join 表2 on 表1.列名=表2.列名 set 列名=列值 where 限定条件</code><br>实例：</p>
<p><code>update employee e,salary s set title=&#39;助工&#39;,salary=1000
where e.empid=s.empid and name=&#39;李四&#39;</code></p>
<p>意义：将employee表和salary表中的李四对应的title和salary值进行更改</p>
</li>
</ul>
<h2 id="5-2-多表删除"><a href="#5-2-多表删除" class="headerlink" title="5.2 多表删除"></a>5.2 多表删除</h2><p><code>delete 被删除数据的表 from 删除操作中使用的表 where 限定条件</code> #注：多张表之间使用逗号间隔</p>
<p>实例：</p>
<p>//删除人事部的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete d,e,s from department d,employee e,salary s</span><br><span class="line">where d.depid&#x3D;e.depid and s.empid&#x3D;e.empid and depname&#x3D;&#39;人事部&#39;</span><br></pre></td></tr></table></figure>
<h2 id="5-3-日期运算函数"><a href="#5-3-日期运算函数" class="headerlink" title="5.3 日期运算函数"></a>5.3 日期运算函数</h2><p>now() 获得当前系统时间<br>year，month，day(日期值字段) 获得日期值中的相关数据<br>date_add(日期,interval 计算值 计算的字段);<br>注：计算值大于0表示往后推日期，小于0表示往前推日期<br>示例：<br>date_add(now(),interval -40 year);//40年前的日期</p>
<h1 id="6-数据库优化"><a href="#6-数据库优化" class="headerlink" title="6. 数据库优化"></a>6. 数据库优化</h1><p><a href="https://www.zhihu.com/question/36431635/answers/updated" target="_blank" rel="noopener">https://www.zhihu.com/question/36431635/answers/updated</a></p>
<ol>
<li><p>对查询进行优化，要尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引</p>
<ul>
<li>补充：索引的分类：主键索引，唯一索引，普通索引，全文索引（<a href="https://blog.csdn.net/jmx_bigdata/article/details/88873268" target="_blank" rel="noopener">MYSQL的索引</a>）</li>
</ul>
</li>
<li><p>应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
<p><code>select id from t where num is null</code>最好不要给数据库留NULL，尽可能的使用 NOT NULL填充数据库.备注、描述、评论之类的可以设置为 NULL，其他的，最好不要使用NULL。</p>
</li>
<li><p>应尽量避免在 where 子句中使用 != 或 &lt;&gt; 操作符，否则引擎将放弃使用索引而进行全表扫描。</p>
</li>
<li><p>应尽量避免在 where 子句中使用 or 来连接条件，如果一个字段有索引，一个字段没有索引，将导致引擎放弃使用索引而进行全表扫描，如：<code>select id from t where num=10 or Name = &#39;admin</code></p>
<p>可以这样查询：</p>
<p><code>select id from t where num = 10
union all
select id from t where Name = &#39;admin&#39;</code></p>
</li>
<li><p>in 和 not in 也要慎用，否则会导致全表扫描，如：<code>select id from t where num in(1,2,3)</code><br>对于连续的数值，能用 between 就不要用 in 了：<code>select id from t where num between 1 and 3</code><br>很多时候用 exists 代替 in 是一个好的选择</p>
</li>
</ol>
<h1 id="7-数据库进阶-事务"><a href="#7-数据库进阶-事务" class="headerlink" title="7. 数据库进阶-事务"></a>7. 数据库进阶-事务</h1><p>事务（Transaction）是由一系列对系统中数据进⾏访问与更新的操作所组成的⼀个程序执行逻辑单元。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210401095444.png" alt="image-20210401095437816"></p>
<h2 id="7-1-事务的语法"><a href="#7-1-事务的语法" class="headerlink" title="7.1 事务的语法"></a>7.1 事务的语法</h2><ol>
<li>启动：start transaction; begin;</li>
<li>提交：commit; 使得当前的修改确认</li>
<li>回滚：rollback; 使得当前的修改被放弃</li>
</ol>
<p>注意：当前数据库引擎为innoDB，其余引擎不支持</p>
<p>可以看出和git的操作很接近，也就是对事务流程进行控制</p>
<p>前面提到的数据库数据的增删改查语句，是自动实现提交的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select * from grade;</span><br><span class="line">#自动提交</span><br><span class="line">insert into grade values(4,&#39;aa&#39;);</span><br><span class="line">#手动提交</span><br><span class="line">begin；</span><br><span class="line">insert into grade values(5,&#39;bb&#39;);#此时临时添加数据到内存，未添加到数据库</span><br><span class="line">commit;</span><br><span class="line">#回滚</span><br><span class="line">begin;</span><br><span class="line">insert into grade values(6,&#39;cc&#39;);</span><br><span class="line">rollback；#在事务提交之前都可以回滚</span><br></pre></td></tr></table></figure>
<h2 id="7-2-事务的特性-ACID"><a href="#7-2-事务的特性-ACID" class="headerlink" title="7.2 事务的特性-ACID"></a>7.2 事务的特性-ACID</h2><ul>
<li><strong>原⼦性（Atomicity）</strong><br>事务的原⼦性是指事务必须是⼀个原子的操作序列单元。事务中包含的各项操作在⼀次执⾏过程中，只允许出现两种状态之一。<br>（1）全部执行成功<br>（2）全部执行失败<br><strong>事务开始后所有操作，要么全部做完，要么全部不做</strong>，不可能停滞在中间环节。事务执⾏过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发⽣一样。也就是说<strong>事务是⼀个不可分割的整体</strong>，就像化学中学过的原子，是物质构成的基本单位。</li>
<li><p><strong>⼀致性（Consistency）</strong><br>事务的一致性是指事务的执⾏不能破坏数据库数据的完整性和一致性，一个事务在执⾏之前和执行之后，数据库都必须处于⼀致性状态。<br>比如：如果从A账户转账到B账户，不可能因为A账户扣了钱，⽽B账户没有加钱</p>
</li>
<li><p><strong>隔离性（Isolation）</strong><br>事务的隔离性是指在并发环境中，并发的事务是互相隔离的。也就是说，不同的事务并发操作相同的数据时，每个事务都有各自完整的数据空间。<br>⼀个事务内部的操作及使用的数据对其它并发事务是隔离的，并发执行的各个事务是不能互相干扰的。隔离性分4个级别，下面会介绍。</p>
</li>
<li><strong>持久性（Duration）</strong><br>事务的持久性是指事务⼀旦提交后，数据库中的数据必须被永久的保存下来。即使服务器系统崩溃或服务器宕机等故障。只要数据库重新启动，那么一定能够将其恢复到事务成功结束后的状态</li>
</ul>
<h2 id="7-3-事务的并发问题"><a href="#7-3-事务的并发问题" class="headerlink" title="7.3 事务的并发问题"></a>7.3 事务的并发问题</h2><p>脏读：</p>
<p>读取到了没有提交的数据, 事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的 数据是脏数据。 </p>
<p>不可重复读：</p>
<p>同⼀条命令返回不同的结果集（更新）.事务 A 多次读取同一数据，事务 B 在事务A 多次读取的过程中，对数据做了更新并提交，导致事务A多次读取同一数据时，结果不一致。 </p>
<p>幻读：</p>
<p>重复查询的过程中，数据就发⽣了量的变化（insert， delete）</p>
<h2 id="7-4-事务的隔离级别-解决并发问题"><a href="#7-4-事务的隔离级别-解决并发问题" class="headerlink" title="7.4 事务的隔离级别-解决并发问题"></a>7.4 事务的隔离级别-解决并发问题</h2><p><img src="https://gitee.com/biongd/img/raw/master/img/20210401101450.png" alt="image-20210401101450719"></p>
<p>4种事务隔离级别从上往下，级别越高，并发性越差，安全性就越来越高。 ⼀般数据默认级别是读以提交或可重复读<br><strong>查看当前会话中事务的隔离级别</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line">1 row in set, 1 warning (0.93 sec)</span><br></pre></td></tr></table></figure>
<p><strong>设置当前会话中的事务隔离级别</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set session transaction isolation level read uncommitted; </span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>.读未提交（READ_UNCOMMITTED）<br>读未提交，该隔离级别允许脏读取，其隔离级别是最低的。换句话说，如果一个事务正在处理理某一数据，并对其进⾏了更新，但同时尚未完成事务，因此还没有提交事务；而以此同时，允许另一个事务也能够访问该数据。<br>脏读示例：<br>在事务A和事务B同时执行时可能会出现如下场景：</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210401102540.png" alt="image-20210401102540501"></p>
<p>余额应该为1500元才对。请看T5时间点，事务A此时查询的余额为0，这个数据就是脏数据，他是事务B 造成的，很明显是事务没有进行隔离造成的。</p>
</li>
<li><p>读已提交（READ_COMMITTED）<br><strong>读已提交是不同的事务执行的时候只能获取到已经提交的数据</strong>（未提交的数据不被承认，避免了回滚的影响）。 这样就不会出现上面的脏读的情况了。但是在同一个事务中执行同一个读取,结果不一致不可重复读示例</p>
<p>虽然解决了脏读问题，但是还是解决不了可重复读问题。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210401103400.png" alt="image-20210401103400305"></p>
<p>事务A其实除了了查询两次以外，其它什什么事情都没做，结果钱就从1000变成0了了，这就是不不可重复读的 问题。</p>
</li>
<li><p>可重复读（REPEATABLE_READ）<br>可重复读就是保证在事务处理理过程中，多次读取同一个数据时，该数据的值和事务开始时刻是一致的。</p>
<p><strong>核心：以事务A为例，只有本身的修改（update）才会改变查询结果，并发事务的修改提交都不会对自己的查询结果造成影响！！！</strong></p>
<p><strong>只有当事务A也进行提交后，结果为获取到已经提交的数据</strong></p>
<p><strong>但是：刚才所提到的修改是有限制的，对于数据量上的变化（insert，delete）仍会对查询结果造成影响！！！</strong></p>
<p>因此该事务级别限制了不可重复读和脏读，但是有可能出现幻读的数据。</p>
</li>
<li><p>幻读<br>幻读就是指同样的事务操作，在前后两个时间段内执行对同一个数据项的读取，可能出现不一致的结果。诡异的更新事件</p>
</li>
</ul>
<h2 id="7-5-不同的隔离级别的锁的情况-了解"><a href="#7-5-不同的隔离级别的锁的情况-了解" class="headerlink" title="7.5 不同的隔离级别的锁的情况(了解)"></a>7.5 不同的隔离级别的锁的情况(了解)</h2><ul>
<li>读未提交（RU）: 有行级的锁，没有间隙锁。它与RC的区别是能够查询到未提交的数据。</li>
<li>读已提交（RC）：有行级的锁，没有间隙锁，读不到没有提交的数据。</li>
<li>可重复读（RR）：有行级的锁，也有间隙锁，每次读取的数据都是一样的，但可能出现幻读的情况。</li>
<li>序列化（S）：有行级锁，也有间隙锁，读表的时候，就已经上锁了</li>
</ul>
<h2 id="7-6-乐观锁和悲观锁"><a href="#7-6-乐观锁和悲观锁" class="headerlink" title="7.6 乐观锁和悲观锁"></a>7.6 乐观锁和悲观锁</h2><h3 id="7-6-1-概念"><a href="#7-6-1-概念" class="headerlink" title="7.6.1 概念"></a>7.6.1 概念</h3><ul>
<li><p>并发控制：</p>
<p>常说的并发控制，一般都和数据库管理系统(DBMS)有关。在 DBMS 中的并发控制的任务，是确保在多个事务同时存取数据库中同一数据时，不破坏事务的隔离性、一致性和数据库的统一性。</p>
<p>实现并发控制的主要手段大致可以分为乐观并发控制和悲观并发控制两种。</p>
</li>
<li><p>首先要明确：无论是悲观锁还是乐观锁，都是人们定义出来的概念，可以认为是一种思想。其实不仅仅是关系型数据库系统中有乐观锁和悲观锁的概念，像 hibernate、<a href="https://www.jianshu.com/p/72fc26ec5216" target="_blank" rel="noopener">tair</a>、memcache 等都有类似的概念。所以，不应该拿乐观锁、悲观锁和其他的数据库锁等进行对比。乐观锁比较适用于读多写少的情况(多读场景)，悲观锁比较适用于写多读少的情况(多写场景)。</p>
</li>
</ul>
<h3 id="7-6-2-悲观锁-Pessimistic-Lock"><a href="#7-6-2-悲观锁-Pessimistic-Lock" class="headerlink" title="7.6.2 悲观锁(Pessimistic Lock)"></a>7.6.2 悲观锁(Pessimistic Lock)</h3><h4 id="啥是悲观锁（咋悲观的）"><a href="#啥是悲观锁（咋悲观的）" class="headerlink" title="啥是悲观锁（咋悲观的）"></a>啥是悲观锁（咋悲观的）</h4><p>当要对数据库中的一条数据进行修改的时候，为了避免同时被其他人修改，最好的办法就是直接对该数据进行加锁以防止并发。</p>
<p>这种<font color="red"><strong>借助数据库锁机制，在修改数据之前先锁定，再修改</strong></font>的方式被称之为悲观并发控制【Pessimistic Concurrency Control，缩写“PCC”，又名“悲观锁”】</p>
<p>悲观锁，正如其名，具有强烈的独占和排他特性。</p>
<p>它指的是对数据被外界事务(包括本系统当前的其他事务，以及来自外部系统的事务处理)修改持保守态度。因此，在整个数据处理过程中，将数据处于锁定状态。悲观锁的实现，往往依靠数据库提供的锁机制(也只有数据库层提供的锁机制才能真正保证数据访问的排他性，否则，即使在本系统中实现了加锁机制，也无法保证外部系统不会修改数据)。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210406101715.jpeg" alt="img"></p>
<p>之所以叫做悲观锁，是因为这是一种对数据的修改持有悲观态度的并发控制方式。总是假设最坏的情况，每次读取数据的时候都默认其他线程会更改数据，因此需要进行加锁操作，当其他线程想要访问数据时，都需要阻塞挂起。悲观锁的实现：</p>
<ol>
<li>传统的关系型数据库使用这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。</li>
<li>Java 里面的同步 <a href="https://www.jianshu.com/p/c8f997e7f75c" target="_blank" rel="noopener">synchronized</a> 关键字的实现。</li>
</ol>
<h4 id="悲观锁的分类"><a href="#悲观锁的分类" class="headerlink" title="悲观锁的分类"></a>悲观锁的分类</h4><p>共享锁【shared locks】又称为读锁，简称S锁。顾名思义，共享锁就是多个事务对于同一数据可以共享一把锁，都能访问到数据，但是只能读不能修改。</p>
<p>排他锁【exclusive locks】又称为写锁，简称X锁。顾名思义，排他锁就是不能与其他锁并存，如果一个事务获取了一个数据行的排他锁，其他事务就不能再获取该行的其他锁，包括共享锁和排他锁，但是获取排他锁的事务是可以对数据行读取和修改。</p>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>即线程加锁的缺点，在效率方面，处理加锁的机制会让数据库产生额外的开销，还有增加产生死锁的机会。另外还会降低并行性，一个事务如果锁定了某行数据，其他事务就必须等待该事务处理完才可以处理那行数据。</p>
<h3 id="7-6-3-乐观锁-Optimistic-Locking"><a href="#7-6-3-乐观锁-Optimistic-Locking" class="headerlink" title="7.6.3 乐观锁(Optimistic Locking)"></a>7.6.3 乐观锁(Optimistic Locking)</h3><p>乐观锁是相对悲观锁而言的，乐观锁<font color="red"><strong>假设数据一般情况下不会造成冲突，所以在数据进行提交更新的时候，才会正式对数据的冲突与否进行检测</strong></font>，如果发现冲突了，则返回给用户错误的信息，让用户决定如何去做。乐观锁适用于读操作多的场景，这样可以提高程序的吞吐量。</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210406104012.jpeg" alt="img"></p>
<p><strong>和git类似的版本检测，冲突抛出的功能</strong></p>
<p>乐观锁机制采取了更加宽松的加锁机制。乐观锁是相对悲观锁而言，也是为了避免数据库幻读、业务处理时间过长等原因引起数据处理错误的一种机制，但<strong>乐观锁不会刻意使用数据库本身的锁机制，而是依据数据本身来保证数据的正确性。</strong>乐观锁的实现：</p>
<ul>
<li><p>CAS 实现：Java 中java.util.concurrent.atomic包下面的原子变量使用了乐观锁的一种 CAS 实现方式。</p>
</li>
<li><p>版本号控制：一般是在数据表中加上一个数据版本号 version 字段，表示数据被修改的次数。当数据被修改时，version 值会+1。当线程A要更新数据值时，在读取数据的同时也会读取 version 值，在提交更新时，若刚才读取到的 version 值与当前数据库中的 version 值相等时才更新，否则重试更新操作，直到更新成功</p>
</li>
</ul>
<p>乐观并发控制相信事务之间的数据竞争(data race)的概率是比较小的，因此尽可能直接做下去，直到提交的时候才去锁定，所以不会产生任何锁和死锁。</p>
<h3 id="7-6-4-两种锁的具体实现"><a href="#7-6-4-两种锁的具体实现" class="headerlink" title="7.6.4 两种锁的具体实现"></a>7.6.4 两种锁的具体实现</h3><ul>
<li><p>悲观锁</p>
<p>悲观锁的实现，往往依靠数据库提供的锁机制。在数据库中，悲观锁的流程如下：</p>
<ol>
<li>在对记录进行修改前，先尝试为该记录加上排他锁(exclusive locks)。</li>
<li>如果加锁失败，说明该记录正在被修改，那么当前查询可能要等待或者抛出异常。具体响应方式由开发者根据实际需要决定。</li>
<li>如果成功加锁，那么就可以对记录做修改，<a href="https://www.jianshu.com/p/7e76ce65e3ad" target="_blank" rel="noopener">事务</a>完成后就会解锁了。</li>
<li>期间如果有其他对该记录做修改或加排他锁的操作，都会等待解锁或直接抛出异常。</li>
</ol>
<p><strong>实例： 拿比较常用的 <a href="https://www.jianshu.com/p/1ed1c5319b09" target="_blank" rel="noopener">MySql Innodb 引擎</a>举例，来说明一下在 SQL 中如何使用悲观锁。</strong></p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210406113542.jpeg" alt="img"></p>
<p>以上，在对id = 1的记录修改前，先通过 <a href="https://www.jianshu.com/p/6ecc0d21dc50" target="_blank" rel="noopener">for update</a> 的方式进行加锁，然后再进行修改。这就是比较典型的悲观锁策略。</p>
<p>如果以上修改库存的代码发生并发，同一时间只有一个线程可以开启事务并获得id=1的锁，其它的事务必须等本次事务提交之后才能执行。这样可以保证当前的数据不会被其它事务修改。</p>
<p>上面提到，使用 <a href="https://www.jianshu.com/p/6ecc0d21dc50" target="_blank" rel="noopener">select…for update</a> 会把数据给锁住，不过需要注意一些锁的级别，MySQL InnoDB 默认行级锁。行级锁都是基于索引的，如果一条 SQL 语句用不到索引是不会使用行级锁的，会使用表级锁把整张表锁住，这点需要注意。</p>
</li>
<li><p>乐观锁</p>
<p>主要就是两个步骤：冲突检测和数据更新。比较典型的就是 CAS (Compare and Swap)。</p>
<p>CAS 即比较并交换。是解决多线程并行情况下使用锁造成性能损耗的一种机制，CAS 操作包含三个操作数——内存位置(V)、预期原值(A)和新值(B)。如果内存位置的值(V)与预期原值(A)相匹配，那么处理器会自动将该位置值更新为新值(B)。否则，处理器不做任何操作。无论哪种情况，它都会在 CAS 指令之前返回该位置的值。CAS 有效地说明了“我认为位置(V)应该包含值(A)。如果包含该值，则将新值(B)放到这个位置；否则，不要更改该位置，只告诉我这个位置现在的值即可”。Java 中，sun.misc.Unsafe 类提供了硬件级别的原子操作来实现这个 CAS。<a href="https://www.jianshu.com/p/67076450de38" target="_blank" rel="noopener">java.util.concurrent</a>包下大量的类都使用了这个 Unsafe.java 类的 CAS 操作。</p>
<p>当多个线程尝试使用 CAS 同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。比如前面的扣减库存问题，通过乐观锁可以实现如下：</p>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210406165844.jpeg" alt="img"></p>
<p>乐观锁使用</p>
<p>在更新之前，先查询一下库存表中当前库存数(quantity)，然后在做 update 的时候，以库存数作为一个修改条件。当提交更新的时候，判断数据库表对应记录的当前库存数与第一次取出来的库存数进行比对，如果数据库表当前库存数与第一次取出来的库存数相等，则予以更新，否则认为是过期数据</p>
</li>
</ul>
<h3 id="7-6-5-CAS的理解"><a href="#7-6-5-CAS的理解" class="headerlink" title="7.6.5 CAS的理解"></a>7.6.5 CAS的理解</h3><p><a href="https://blog.csdn.net/ls5718/article/details/52563959" target="_blank" rel="noopener">https://blog.csdn.net/ls5718/article/details/52563959</a></p>
<h1 id="8-JDBC"><a href="#8-JDBC" class="headerlink" title="8. JDBC"></a>8. JDBC</h1><h2 id="8-1-概念"><a href="#8-1-概念" class="headerlink" title="8.1 概念"></a>8.1 概念</h2><p>JDBC（Java DataBase Connectivity,java数据库连接）是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问，它由</p>
<p>一组用Java语言编写的类和接口组成。JDBC提供了一种基准，据此可以构建更高级的工具和接口，使数据库开发人员能够编写数据库应用</p>
<p>程序Java 具有坚固、安全、易于使用、易于理解和可从网络上自动下载等特性，是编写数据库应用程序的杰出语言。所需要的只是 Java</p>
<p>应用程序与各种不同数据库之间进行对话的方法。JDBC可以在各种平台上使用Java，如Windows，Mac OS和各种版本的UNIX。JDBC库</p>
<p>包括通常与数据库使用相关的下面提到的每个任务的API。</p>
<ul>
<li>连接数据库。</li>
<li>创建SQL或MySQL语句。</li>
<li>在数据库中执行SQL或MySQL查询。</li>
<li>查看和修改生成的记录。</li>
</ul>
<h3 id="JDBC体系结构"><a href="#JDBC体系结构" class="headerlink" title="JDBC体系结构"></a><strong>JDBC体系结构</strong></h3><p>JDBC API支持用于数据库访问的两层和三层处理模型，但通常，JDBC体系结构由两层组成：</p>
<ul>
<li>JDBC API：这提供了应用程序到JDBC管理器连接。</li>
<li>JDBC驱动程序API：这支持JDBC管理器到驱动程序连接。<br>JDBC API使用驱动程序管理器和特定于数据库的驱动程序来提供与异构数据库的透明连接</li>
</ul>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210401194652.png" alt="image-20210401194645837" style="zoom:67%;" /></p>
<h3 id="JDBC核心组件"><a href="#JDBC核心组件" class="headerlink" title="JDBC核心组件"></a>JDBC核心组件</h3><ul>
<li>DriverManager： 此类管理数据库驱动程序列表。使用通信子协议将来自java应用程序的连接请求与适当的数据库驱动程序匹配</li>
<li>Driver:此接口处理与数据库服务器的通信，我们很少会直接与Driver对象进行交互。而是使用</li>
<li>DriverManager对象来管理这种类型的对象。</li>
<li>Connection：该界面具有用于联系数据库的所有方法。连接对象表示通信上下文，即，与数据库的所有通信仅通过连接对象。</li>
<li>Statement：使用从此接口创建的对象将SQL语句提交到数据库。除了执行存储过程之外，一些派生接口还接受参数。</li>
<li>ResultSet：在使用Statement对象执行SQL查询后，这些对象保存从数据库检索的数据。它作为一个迭代器，允许我们移动其数据。</li>
<li>SQLException：此类处理数据库应用程序中发生的任何错误</li>
</ul>
<h2 id="8-2-使用步骤"><a href="#8-2-使用步骤" class="headerlink" title="8.2 使用步骤"></a>8.2 使用步骤</h2><p>构建JDBC应用程序涉及以下六个步骤：</p>
<ul>
<li><p>导入包：需要导入包含数据库编程所需的JDBC类的包。大多数情况下，使用import java.sql.*就足够了。</p>
</li>
<li><p>注册JDBC驱动程序：要求您初始化驱动程序，以便您可以打开与数据库的通信通道。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//反射式加载</span></span><br><span class="line">Class.forName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br><span class="line"><span class="comment">//静态方法</span></span><br><span class="line">Driver myDriver = <span class="keyword">new</span> com.mysql.cj.jdbc.Driver();</span><br><span class="line">DriverManager.registerDriver( myDriver );</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开连接：需要使用DriverManager.getConnection（）方法创建一个Connection对象，该对象表示与数据库的物理连接。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = DriverManager.getConnection(url,userName,passWord);</span><br></pre></td></tr></table></figure>
<p>注意：不同数据库执行驱动和连接的差异：<strong>驱动地址和连接地址不同</strong></p>
<p>| RDBMS  | JDBC驱动程序名称                | 网址格式                                                   |<br>| ——— | ———————————————- | ————————————————————————————— |<br>| MYSQL8 | com.mysql.cj.jdbc.Driver        | jdbc:mysql://hostname:3306/databaseName?serverTimezone=UTC |<br>| MySQL  | com.mysql.jdbc.Driver           | jdbc:mysql://hostname:3306/databaseName                    |<br>| ORACLE | oracle.jdbc.driver.OracleDriver | jdbc:oracle:thin:@hostname:port Number：databaseName       |<br>| DB2    | COM.ibm.db2.jdbc.net.DB2Driver  | jdbc:db2:hostname:port Number / databaseName               |<br>| SYBASE | com.sybase.jdbc.SybDriver       | jdbc:sybase:Tds:hostname:port Number / databaseName        |</p>
</li>
<li><p>行查询：需要使用类型为Statement的对象来构建和提交SQL语句到数据库。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义sql，创建状态通道，进行sql语句的发送</span></span><br><span class="line">Statement state = conn.createStatement();</span><br><span class="line"><span class="comment">//执行查询，获得结果集</span></span><br><span class="line">ResultSet rs = state.executeQuery(<span class="string">"select * from student"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>从结果集中提取数据：需要使用相应的ResultSet.getXXX（）方法从结果集中检索数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">    <span class="comment">//获取每行的信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>释放资源：需要明确地关闭所有数据库资源，而不依赖于JVM的垃圾收集。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将数据库连接，状态通道，结果集全部关闭</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    Statement state = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//加载驱动</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Class.forName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br><span class="line">        <span class="comment">//获得连接</span></span><br><span class="line">        String userName = <span class="string">"root"</span>;</span><br><span class="line">        String passWord = <span class="string">"QW06125231!"</span>;</span><br><span class="line">        String url = <span class="string">"jdbc:mysql://localhost:3306/mydb1?serverTimezone=UTC"</span>;</span><br><span class="line">        conn = DriverManager.getConnection(url,userName,passWord);</span><br><span class="line">        <span class="comment">//定义sql，创建状态通道，进行sql语句的发送</span></span><br><span class="line">        state = conn.createStatement();</span><br><span class="line">        <span class="comment">//执行查询，获得结果集</span></span><br><span class="line">        rs = state.executeQuery(<span class="string">"select * from student"</span>);</span><br><span class="line">        <span class="comment">//取出结果</span></span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="comment">//取出数据：rs.getXXX(“列名”); XXX表示数据类型</span></span><br><span class="line">            System.out.println(<span class="string">"姓名"</span>+rs.getString(<span class="string">"stuname"</span>)+<span class="string">"生日"</span></span><br><span class="line">                    +rs.getDate(<span class="string">"birthday"</span>)+<span class="string">"年龄"</span>+rs.getInt(<span class="string">"stuage"</span>)+<span class="string">"性别"</span>+rs.getString(<span class="string">"stusex"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(rs != <span class="keyword">null</span>)&#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(state != <span class="keyword">null</span>)&#123;</span><br><span class="line">                state.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="增删改"><a href="#增删改" class="headerlink" title="增删改"></a>增删改</h3><p>上面查询语句 <code>ResultSet rs = state.executeQuery(&quot;select * from student&quot;);</code>应该改为<code>executeUpdaet()</code>方法</p>
<p>以增加记录为例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int rs = state.executeUpdate("<span class="keyword">insert</span> <span class="keyword">into</span> student(stuname,stuage,stusex,birthday) <span class="keyword">value</span>(<span class="string">'张三9'</span>,<span class="number">18</span>,<span class="string">'a'</span>,<span class="string">'2000-1-1)");</span></span><br></pre></td></tr></table></figure>
<h2 id="8-3-SQL注入"><a href="#8-3-SQL注入" class="headerlink" title="8.3 SQL注入"></a>8.3 SQL注入</h2><p>就是通过把SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。具体来说，它是利用现有应用程序，将（恶意的）SQL命令注入到后台数据库引擎执行的能力，它可以通过在Web表单中输入（恶意）SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行SQL语句。比如先前的很多影视网站泄露VIP会员密码大多就是通过WEB表单递交查询字符暴出的，这类表单特别容易受到SQL注入式攻击。</p>
<p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String username =<span class="string">"admin"</span>;</span><br><span class="line">String password=<span class="string">" 'abc' or 1=1 "</span>;</span><br><span class="line">String sql=<span class="string">"select * from users where username= '"</span>+username+<span class="string">"' and password="</span>+password;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如何避免SQL注入？</p>
</blockquote>
<h3 id="预状态通道PreparedStatement"><a href="#预状态通道PreparedStatement" class="headerlink" title="预状态通道PreparedStatement"></a>预状态通道PreparedStatement</h3><p>该PreparedStatement的接口扩展了Statement接口，它为您提供了一个通用的Statement对象有两个优点附加功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String sql = <span class="string">"select * from where username =? and password=?"</span>;</span><br><span class="line">PreparedStatement pps = conn.prepareStatement(sql);</span><br><span class="line">pps.setString(<span class="number">1</span>, userName);</span><br><span class="line">pps.setString(<span class="number">2</span>, passWord);</span><br><span class="line"><span class="comment">//获得结果集</span></span><br><span class="line">rs = pps.executeQuery();</span><br></pre></td></tr></table></figure>
<p>JDBC中的所有用于判断的参数都由？符号，这被称为参数标记。在执行SQL语句之前，必须为每个参数提供值。所述的setXXX()方法将值绑定到所述参数，其中XXX代表要绑定到输入参数的值的Java数据类型。如果忘记提供值，将收到一个SQLException。</p>
<p>每个参数标记由其顺序位置引用。<strong>第一个标记表示位置1</strong>，下一个位置2等等。该方法与Java数组索引不同!</p>
<blockquote>
<p>statement和PreparedStatement的区别</p>
</blockquote>
<p>(1)statement属于状态通道，PreparedStatement属于预状态通道</p>
<p>(2)预状态通道会先编译sql语句,再去执行，比statement执行效率高</p>
<p>(3)预状态通道支持占位符? 给占位符赋值的时候，位置从1开始</p>
<p>(4)预状态通道可以防止sql注入，原因:预状态通道在处理值的时候以字符串的方式处理</p>
<blockquote>
<p>防止sql注入原理</p>
</blockquote>
<p>首先这个类进行语句执行不是直接进行语句的拼接，而是先进行预编译，用? 进行占位 再set()的时候 将属性左右加上 ‘ (int类型不会)  </p>
<p>然后会把用户输入的所有字符集全部遍历 如果识别出 一些特殊字符 比如  换行符、 、双引号、单引号 还有一些特殊字符会进行编译</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> login <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'xx'</span> <span class="keyword">and</span> pwd =<span class="string">' \'</span> <span class="keyword">or</span> \<span class="string">'1\'</span> = \<span class="string">'1\'</span>  <span class="string">'</span></span><br></pre></td></tr></table></figure>
<p>所以使用了PreparedStatement 就 无法截断SQL语句，也就是说  无法拼接SQL语句，防止了sql注入。</p>
<h2 id="8-4-多表关系操作"><a href="#8-4-多表关系操作" class="headerlink" title="8.4 多表关系操作"></a>8.4 多表关系操作</h2><p>分类：双向一对一，一对多，多对一，多对多</p>
<p><strong>多表关系处理数据：</strong></p>
<ul>
<li><p>数据库通过外键建立两表关系</p>
</li>
<li><p><strong>实体类通过属性的方式建立两表关系</strong></p>
<p>实体类要求：类名=表名，列名=属性名</p>
</li>
</ul>
<h3 id="8-4-1-一对多和多对一"><a href="#8-4-1-一对多和多对一" class="headerlink" title="8.4.1 一对多和多对一"></a>8.4.1 一对多和多对一</h3><p>以学生和老师为例：</p>
<h4 id="一对多（老师-学生）"><a href="#一对多（老师-学生）" class="headerlink" title="一对多（老师-学生）"></a>一对多（老师-学生）</h4><p>核心：一的一方增加一个List属性，存放多方的对象，一对多的联系就建立了</p>
<ul>
<li><p>bean层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> tid;</span><br><span class="line">    <span class="keyword">private</span> String tname;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; list=<span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;Student&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTid</span><span class="params">(<span class="keyword">int</span> tid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tid = tid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTname</span><span class="params">(String tname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tname = tname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">student</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stuid;</span><br><span class="line">    <span class="keyword">private</span> String stuname;</span><br><span class="line">    <span class="comment">//外键列一般不生成属性</span></span><br><span class="line">    <span class="comment">// private int teacherid;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStuid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuid</span><span class="params">(<span class="keyword">int</span> stuid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuid = stuid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStuname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuname;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuname</span><span class="params">(String stuname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuname = stuname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>dao层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义dao接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TeacherDao</span> </span>&#123;</span><br><span class="line"><span class="comment">//定义操作方法</span></span><br><span class="line"><span class="comment">//1.定义一个根据老师id查询老师信息(学生的信息)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Teacher <span class="title">getById</span><span class="params">(<span class="keyword">int</span> tid)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDaoImpl</span> <span class="keyword">implements</span> <span class="title">TeacherDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Teacher <span class="title">getById</span><span class="params">(<span class="keyword">int</span> tid)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//操作数据库</span></span><br><span class="line">        Connection connection =<span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement pps =<span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            Class.forName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br><span class="line">            <span class="comment">//2.获得链接</span></span><br><span class="line">            String userName=<span class="string">"root"</span>;</span><br><span class="line">            String passWord=<span class="string">"123456"</span>;</span><br><span class="line">            String url=<span class="string">"jdbc:mysql://localhost:3306/yhp3?serverTimezone=UTC"</span>;</span><br><span class="line">                connection = DriverManager.getConnection(url, userName, passWord);</span><br><span class="line">            <span class="comment">//3.定义sql,创建预状态通道(进行sql语句的发送)</span></span><br><span class="line">            String sql=<span class="string">"select * from student s,teacher t where</span></span><br><span class="line"><span class="string">            s.teacherid=t.tid and t.tid=?"</span>;</span><br><span class="line">            pps = connection.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//给占位符赋值 （下标，内容） 从1开始</span></span><br><span class="line">            pps.setInt(<span class="number">1</span>,tid);</span><br><span class="line">            <span class="comment">//执行sql</span></span><br><span class="line">            resultSet = pps.executeQuery();</span><br><span class="line">            Teacher teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">            List&lt;Student&gt; students=<span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next())&#123;</span><br><span class="line">            	<span class="comment">//1.取出各自的信息</span></span><br><span class="line">                teacher.setTid(resultSet.getInt(<span class="string">"tid"</span>));</span><br><span class="line">                teacher.setTname(resultSet.getString(<span class="string">"tname"</span>));</span><br><span class="line">                Student student = <span class="keyword">new</span> Student();</span><br><span class="line">                student.setStuId(resultSet.getInt(<span class="string">"stuid"</span>));</span><br><span class="line">                student.setStuName(resultSet.getString(<span class="string">"stuname"</span>));</span><br><span class="line">                <span class="comment">//2.建立学生和老师之间的关系</span></span><br><span class="line">                students.add(student);</span><br><span class="line">            &#125;</span><br><span class="line">            teacher.setStudentList(students);</span><br><span class="line">            <span class="keyword">return</span> teacher;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//5.关闭资源</span></span><br><span class="line">                <span class="keyword">if</span> (resultSet != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (pps != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    pps.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="多对一（学生-老师）"><a href="#多对一（学生-老师）" class="headerlink" title="多对一（学生-老师）"></a>多对一（学生-老师）</h4><p>同理：在多方中存放老师的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; students=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">while</span> (resultSet.next())&#123;</span><br><span class="line">    <span class="comment">//1.取出各自的信息</span></span><br><span class="line">    Student student = <span class="keyword">new</span> Student();</span><br><span class="line">    student.setStuId(resultSet.getInt(<span class="string">"stuid"</span>));</span><br><span class="line">    student.setStuName(resultSet.getString(<span class="string">"stuname"</span>));</span><br><span class="line">    Teacher teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">    teacher.setTid(resultSet.getInt(<span class="string">"tid"</span>));</span><br><span class="line">    teacher.setTname(resultSet.getString(<span class="string">"tname"</span>));</span><br><span class="line">    <span class="comment">//2.建立学生和老师之间的关系</span></span><br><span class="line">    student.setTeacher(teacher);</span><br><span class="line">    students.add(student);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> students;</span><br></pre></td></tr></table></figure>
<h3 id="8-4-2-一对一（妻子丈夫）"><a href="#8-4-2-一对一（妻子丈夫）" class="headerlink" title="8.4.2 一对一（妻子丈夫）"></a>8.4.2 一对一（妻子丈夫）</h3><p>两方的属性中都由对方的对象！</p>
<h3 id="8-4-3-多对多-科目-学生"><a href="#8-4-3-多对多-科目-学生" class="headerlink" title="8.4.3 多对多(科目-学生)"></a>8.4.3 多对多(科目-学生)</h3><p>多对多的关系最少要三张表，中间表用于存放stuid和subid(联系两表的桥梁)</p>
<p>两方互相有对方的集合</p>
<h2 id="8-5-JDBC-事务应用"><a href="#8-5-JDBC-事务应用" class="headerlink" title="8.5 JDBC 事务应用"></a>8.5 JDBC 事务应用</h2><p>如果JDBC连接处于自动提交模式，默认情况下，则每个SQL语句在完成后都会提交到数据库。事务使您能够控制是否和何时更改应用于数据库。它将单个SQL语句或一组SQL语句视为一个逻辑单元，如果任何语句失败，则整个事务将失败。</p>
<p>要启用手动事务支持，而不是JDBC驱动程序默认使用的自动提交模式，请使用Connection对象的setAutoCommit（）方法。如果将boolean false传递给setAutoCommit（），则关闭自动提交。我们可以传递一个布尔值true来重新打开它。</p>
<blockquote>
<p><strong>为什么要搞一个手动提交</strong></p>
</blockquote>
<p>答：因为很多时候数据库操作是夹杂着业务逻辑的，通过将其组建为事务，保证其原子性，即出现错误则全不执行！！</p>
<p>完成更改后，我们要提交更改，然后在连接对象上调用commit（）方法</p>
<p><code>conn.commit( );</code></p>
<p>否则，要使用连接名为conn的数据库回滚更新，请使用以下代码</p>
<p><code>conn.rollback( );</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//Assume a valid connection object conn</span></span><br><span class="line">    conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">    Statement stmt = conn.createStatement();</span><br><span class="line">    String SQL = <span class="string">"INSERT INTO Employees values (106, 20, 'Rita', 'Tez')"</span>;</span><br><span class="line">    stmt.executeUpdate(SQL);</span><br><span class="line">    <span class="comment">//Submit a malformed SQL statement that breaks</span></span><br><span class="line">    String SQL = <span class="string">"INSERTED IN Employees VALUES (107, 22, 'Sita', 'Singh')"</span>;</span><br><span class="line">    stmt.executeUpdate(SQL);</span><br><span class="line">    <span class="comment">// If there is no error.</span></span><br><span class="line">    conn.commit();</span><br><span class="line">&#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">    <span class="comment">// If there is any error.</span></span><br><span class="line">    conn.rollback();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Savepoints"><a href="#Savepoints" class="headerlink" title="Savepoints"></a>Savepoints</h3><p>设置保存点时，可以在事务中定义逻辑回滚点。如果通过保存点发生错误，则可以使用回滚方法来撤消所有更改或仅保存在保存点之后所做的更改。</p>
<p>Connection对象有两种新的方法来帮助您管理保存点 </p>
<ul>
<li><p>setSavepoint（String savepointName）：定义新的保存点。它还返回一个Savepoint对象。</p>
</li>
<li><p>releaseSavepoint（Savepoint savepointName）：删除保存点。请注意，它需要一个Savepoint对象作为参数。此对象通常是由</p>
<p>setSavepoint（）方法生成的保存点。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//Assume a valid connection object conn</span></span><br><span class="line">    conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">    Statement stmt = conn.createStatement();</span><br><span class="line">    Savepoint savepoint1 = conn.setSavepoint(<span class="string">"Savepoint1"</span>);</span><br><span class="line">    String SQL = <span class="string">"INSERT INTO Employees VALUES (106, 20, 'Rita', 'Tez')"</span>;</span><br><span class="line">    stmt.executeUpdate(SQL);</span><br><span class="line">    String SQL = <span class="string">"INSERTED IN Employees VALUES (107, 22, 'Sita', 'Tez')"</span>;</span><br><span class="line">    stmt.executeUpdate(SQL);</span><br><span class="line">    conn.commit();</span><br><span class="line">&#125;<span class="keyword">catch</span>(SQLException se)&#123;</span><br><span class="line">    conn.rollback(savepoint1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-6-批处理"><a href="#8-6-批处理" class="headerlink" title="8.6 批处理"></a>8.6 批处理</h2><p>批量处理允许您将相关的SQL语句分组到批处理中，并通过对数据库的一次调用提交它们。当您一次向数据库发送多个SQL语句时，可以减少连接数据库的开销，从而提高性能。</p>
<p>单个或多个T—SQL语句的集合，由应用程序一次性发送给SQL Server解析执行处理内的所有语句指令。</p>
<h3 id="8-6-1-Statement批处理"><a href="#8-6-1-Statement批处理" class="headerlink" title="8.6.1 Statement批处理"></a>8.6.1 Statement批处理</h3><p>以下是使用语句对象的批处理的典型步骤序列</p>
<ul>
<li>使用createStatement（）方法创建Statement对象。</li>
<li>使用setAutoCommit（）将auto-commit设置为false 。</li>
<li>使用addBatch（）方法在创建的语句对象上添加您喜欢的SQL语句到批处理中。</li>
<li>在创建的语句对象上使用executeBatch（）方法执行所有SQL语句。</li>
<li>最后，使用commit（）方法提交所有更改。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Statement stmt = conn.createStatement();</span><br><span class="line">conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//sql1</span></span><br><span class="line">String SQL = <span class="string">"INSERT INTO Employees (id, first, last, age) VALUES(200,'Zia','Ali', 30)"</span>;</span><br><span class="line">stmt.addBatch(SQL);</span><br><span class="line"><span class="comment">//sql2</span></span><br><span class="line">String SQL = <span class="string">"INSERT INTO Employees (id, first, last, age) VALUES(201,'Raj','Kumar', 35)"</span>;</span><br><span class="line">stmt.addBatch(SQL);</span><br><span class="line"><span class="comment">//sql3</span></span><br><span class="line">String SQL = <span class="string">"UPDATE Employees SET age = 35 WHERE id = 100"</span>;</span><br><span class="line">stmt.addBatch(SQL);</span><br><span class="line"><span class="keyword">int</span>[] count = stmt.executeBatch();</span><br><span class="line">conn.commit();</span><br></pre></td></tr></table></figure>
<h3 id="8-6-2-PreparedStatement批处理"><a href="#8-6-2-PreparedStatement批处理" class="headerlink" title="8.6.2 PreparedStatement批处理"></a>8.6.2 PreparedStatement批处理</h3><ul>
<li>使用占位符创建SQL语句。</li>
<li>使用<code>prepareStatement（）</code> 方法创建PrepareStatement对象。</li>
<li>使用<code>setAutoCommit（）</code>将auto-commit设置为false 。</li>
<li>使用<code>addBatch（）</code>方法在创建的语句对象上添加SQL语句到批处理中。</li>
<li>在创建的语句对象上使用<code>executeBatch（）</code>方法执行所有SQL语句。</li>
<li>最后，使用<code>commit（）</code>方法提交所有更改。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">String SQL = <span class="string">"INSERT INTO Employees (id, first, last, age) VALUES(?, ?, ?, ?)"</span>;</span><br><span class="line">PreparedStatement pps = conn.prepareStatement(SQL);</span><br><span class="line">conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">// Set the variables</span></span><br><span class="line">pps.setInt( <span class="number">1</span>, <span class="number">400</span> );</span><br><span class="line">pps.setString( <span class="number">2</span>, <span class="string">"Pappu"</span> );</span><br><span class="line">pps.setString( <span class="number">3</span>, <span class="string">"Singh"</span> );</span><br><span class="line">pps.setInt( <span class="number">4</span>, <span class="number">33</span> );</span><br><span class="line"><span class="comment">// Add it to the batch</span></span><br><span class="line">pps.addBatch();</span><br><span class="line"><span class="comment">// Set the variables</span></span><br><span class="line">pps.setInt( <span class="number">1</span>, <span class="number">401</span> );</span><br><span class="line">pps.setString( <span class="number">2</span>, <span class="string">"Pawan"</span> );</span><br><span class="line">pps.setString( <span class="number">3</span>, <span class="string">"Singh"</span> );</span><br><span class="line">pps.setInt( <span class="number">4</span>, <span class="number">31</span> );</span><br><span class="line"><span class="comment">// Add it to the batch</span></span><br><span class="line">pps.addBatch();</span><br><span class="line"><span class="comment">//add more batches</span></span><br><span class="line"><span class="comment">//Create an int[] to hold returned values</span></span><br><span class="line"><span class="keyword">int</span>[] count = stmt.executeBatch();</span><br><span class="line"><span class="comment">//Explicitly commit statements to apply changes</span></span><br><span class="line">conn.commit();</span><br></pre></td></tr></table></figure>
<h2 id="8-7-反射处理结果集"><a href="#8-7-反射处理结果集" class="headerlink" title="8.7 反射处理结果集"></a>8.7 反射处理结果集</h2><p>面对问题：正经的数据库表的列数可能有几十列，通过<code>rs.getXXX()</code>方法获取结果集的信息，然后用私有属性的set方法添加到对象中过于繁琐</p>
<p>答：通过反射简化结果集的获取</p>
<p>以8-4的学生表为例，应该做的修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同样要先打开驱动，建立连接</span></span><br><span class="line"><span class="comment">//建立状态通道，获取结果集</span></span><br><span class="line">String sqla = <span class="string">"select * from student"</span>;</span><br><span class="line">pps = con.prepareStatement(sqla);</span><br><span class="line">rs = pps.executeQuery();</span><br><span class="line"><span class="comment">/***修改部分，通过反射自动装填属性信息***/</span></span><br><span class="line"><span class="comment">//1. 返回数据库中的相关信息</span></span><br><span class="line">ResultSetMetaData metaData = rs.getMetaData();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 得到列数</span></span><br><span class="line"><span class="keyword">int</span> count=metaData.getColumnCount();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 取得列名，存入字符串数组</span></span><br><span class="line">String[] columnnames = <span class="keyword">new</span> String[count];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">    <span class="comment">// System.out.println(metaData.getColumnName(i+1));//列的位置从1开始</span></span><br><span class="line">    columnnames[i]=metaData.getColumnName(i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 得到实体类中的所有的方法</span></span><br><span class="line">Method[] methods =cla.getDeclaredMethods();</span><br><span class="line"><span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">    Object stu=cla.newInstance();<span class="comment">//调取无参构造创建对象</span></span><br><span class="line">    <span class="comment">//需要暴力匹配的两方：1.列名，2.属性名，3.如果匹配就执行对应的get或set方法</span></span><br><span class="line">    <span class="keyword">for</span> (String columnname : columnnames) &#123;</span><br><span class="line">        String name=<span class="string">"set"</span>+columnname;<span class="comment">//setstuid</span></span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            <span class="keyword">if</span>(method.getName().equalsIgnoreCase(name))&#123;</span><br><span class="line">                method.invoke(s,rs.getObject(columnname));<span class="comment">//执行对应的set方法</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    list.add(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-8-封装工具类"><a href="#8-8-封装工具类" class="headerlink" title="8.8 封装工具类"></a>8.8 封装工具类</h2><p>通过修改6，7两个方法也可以实现批处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.定义需要的工具类对象</span></span><br><span class="line">    <span class="keyword">protected</span> Connection connection=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> PreparedStatement pps=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> ResultSet rs=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> k=<span class="number">0</span>;<span class="comment">//受影响的行数</span></span><br><span class="line">    <span class="keyword">private</span> String url=<span class="string">"jdbc:mysql://localhost:3306/yhp"</span>;</span><br><span class="line">    <span class="keyword">private</span> String username=<span class="string">"root"</span>;</span><br><span class="line">    <span class="keyword">private</span> String password=<span class="string">"123456"</span>;</span><br><span class="line">    <span class="comment">//2.加载驱动</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.获得连接</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection=DriverManager.getConnection(url,username,password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.创建通道</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> PreparedStatement <span class="title">getPps</span><span class="params">(String sql)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            getConnection();<span class="comment">//insert into users values(?,?,?,?,)</span></span><br><span class="line">            pps=connection.prepareStatement(sql);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pps;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.给占位符赋值 list中保存的是给占位符所赋的值</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setParams</span><span class="params">(List list)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(list!=<span class="keyword">null</span>&amp;&amp;list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;list.size();i++) &#123;</span><br><span class="line">                    pps.setObject(i+<span class="number">1</span>,list.get(i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.增删改调取的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql,List params)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            getPps(sql);</span><br><span class="line">            setParams(params);</span><br><span class="line">            k= pps.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> k;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.查询的时候调取一个方法</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> ResultSet <span class="title">query</span><span class="params">(String sql,List list)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            getPps(sql);</span><br><span class="line">            setParams(list);</span><br><span class="line">            rs=pps.executeQuery();</span><br><span class="line">            <span class="keyword">return</span> rs;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//8.关闭资源</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">closeall</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (pps != <span class="keyword">null</span>) &#123;</span><br><span class="line">                pps.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-8-1-属性文件"><a href="#8-8-1-属性文件" class="headerlink" title="8.8.1 属性文件"></a>8.8.1 属性文件</h3><p>对于上述封装工具类中的属性很有可能是动态变化的，因此也需要我们能够动态的引入变化的属性</p>
<p>方法1：创建db.properties文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.jc.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/yhp?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>
<p>工具类中读取属性文件:</p>
<blockquote>
<p>此处用到的反射加载配置文件的方法见（java-基础 12.3.2）</p>
<p>Properties类的使用见（java基础 7.10）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String driverName;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String username;</span><br><span class="line">   <span class="comment">//2.加载驱动</span></span><br><span class="line">   <span class="keyword">static</span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           InputStream inputStream = BaseDao.class.getClassLoader().getResourceAsStream("db.properties");</span><br><span class="line">           Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">           properties.load(inputStream);</span><br><span class="line">           driverName = properties.getProperty(<span class="string">"driver"</span>);</span><br><span class="line">           url = properties.getProperty(<span class="string">"url"</span>);</span><br><span class="line">           username = properties.getProperty(<span class="string">"user"</span>);</span><br><span class="line">           password = properties.getProperty(<span class="string">"password"</span>);</span><br><span class="line">           Class.forName(driverName);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-9-连接池"><a href="#8-9-连接池" class="headerlink" title="8.9 连接池"></a>8.9 连接池</h2><p>连接池基本的思想是在系统初始化的时候，将数据库连接作为对象存储在内存中，当用户需要访问数据库时，并非建立一个新的连接，而是从连接池中取出一个已建立的空闲连接对象。使用完毕后，用户也并非将连接关闭，而是将连接放回连接池中，以供下一个请求访问使用。而连接的建立、断开都由连接池自身来管理。同时，还可以通过设置连接池的参数来控制连接池中的初始连接数、连接的上下限数以及每个连接的最大使用次数、最大空闲时间等等，也可以通过其自身的管理机制来监视数据库连接的数量、使用情况等</p>
<h3 id="8-9-1-自定义连接池"><a href="#8-9-1-自定义连接池" class="headerlink" title="8.9.1 自定义连接池"></a>8.9.1 自定义连接池</h3><p>连接池轮廓</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pool</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> LinkedList&lt;Connection&gt; list = <span class="keyword">new</span> LinkedList&lt;Connection&gt;();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            Connection connection = JDBCUtils.newInstance().getConnection();</span><br><span class="line">            list.add(connection);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 从连接池子中获取连接的方式</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">//JDBCUtils类是自定义类，封装了连接数据库的信息代码</span></span><br><span class="line">            Connection connection = JDBCUtils.newInstance().getConnection();</span><br><span class="line">            list.addLast(connection);</span><br><span class="line">        &#125;</span><br><span class="line">        Connection conn = list.removeFirst();</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 返回到连接池子中</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addBack</span><span class="params">(Connection conn)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.size() &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            list.addLast(conn); <span class="comment">//10</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取连接池子中连接数量的方法</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-9-2-java规范实现连接池"><a href="#8-9-2-java规范实现连接池" class="headerlink" title="8.9.2 java规范实现连接池"></a>8.9.2 java规范实现连接池</h3><p>Java为连接池实现提供了一个规范(接口),规范的写法,我们需要实现DataSource接口!</p>
<p>但是实现DataSource接口有一个弊端,没有提供回收链接方法!这里我们将使用装饰者模式!</p>
<p>装饰Connection!具体实现代码如下(创建装饰Connection)：</p>
<p>尤其是重写的close方法，保证了关闭连接时能够回归连接池</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConnection</span> <span class="keyword">implements</span> <span class="title">Connection</span></span>&#123;</span><br><span class="line"><span class="comment">//将被装饰者导入</span></span><br><span class="line"><span class="keyword">private</span> Connection conn;</span><br><span class="line"><span class="keyword">private</span> LinkedList&lt;Connection&gt; list;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MyConnection</span><span class="params">(Connection conn, LinkedList&lt;Connection&gt; list)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.conn = conn;</span><br><span class="line"><span class="keyword">this</span>.list = list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">unwrap</span><span class="params">(Class&lt;T&gt; iface)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> conn.unwrap(iface);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWrapperFor</span><span class="params">(Class&lt;?&gt; iface)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> conn.isWrapperFor(iface);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Statement <span class="title">createStatement</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> conn.createStatement();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PreparedStatement <span class="title">prepareStatement</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> conn.prepareStatement(sql);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CallableStatement <span class="title">prepareCall</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">nativeSQL</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAutoCommit</span><span class="params">(<span class="keyword">boolean</span> autoCommit)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getAutoCommit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">conn.commit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">conn.rollback();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">list.addLast(conn);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于规范实现的连接池</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建一个规范的连接池子</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourcePool</span> <span class="keyword">implements</span> <span class="title">DataSource</span></span>&#123;</span><br><span class="line"><span class="keyword">static</span> LinkedList&lt;Connection&gt; list = <span class="keyword">new</span> LinkedList&lt;Connection&gt;();</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">Connection connection = JDBCUtils.newInstance().getConnection();</span><br><span class="line">list.add(connection);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> list.size();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">Connection conn = list.removeFirst();</span><br><span class="line">MyConnection conn1 = <span class="keyword">new</span> MyConnection(conn, list);</span><br><span class="line"><span class="keyword">return</span> conn1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PrintWriter <span class="title">getLogWriter</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogWriter</span><span class="params">(PrintWriter out)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLoginTimeout</span><span class="params">(<span class="keyword">int</span> seconds)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLoginTimeout</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Logger <span class="title">getParentLogger</span><span class="params">()</span> <span class="keyword">throws</span> SQLFeatureNotSupportedException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">unwrap</span><span class="params">(Class&lt;T&gt; iface)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWrapperFor</span><span class="params">(Class&lt;?&gt; iface)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">SQLException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>最小连接数:<br>是数据库一直保持的数据库连接数，所以如果应用程序对数据库连接的使用量不大，将有大量的数据库资源被浪费。</li>
<li>初始化连接数：<br>连接池启动时创建的初始化数据库连接数量。</li>
<li>最大连接数：<br>是连接池能申请的最大连接数，如果数据库连接请求超过此数，后面的数据库连接请求被加入到等待队列中。</li>
<li>最大等待时间：<br>当没有可用连接时，连接池等待连接被归还的最大时间，超过时间则抛出异常，可设置参数为0或者负数使得无限等待(根据不同连接池配置)。</li>
</ul>
<p><img src="https://gitee.com/biongd/img/raw/master/img/20210404162953.png" alt="image-20210404162945856"></p>
<p>注1:在DBCP连接池的配置中，还有一个maxIdle的属性，表示最大空闲连接数，超过的空闲连接将被释放，默认值为8。对应的该属性在Druid连接池已不再使用，配置了也没有效果，c3p0连接池则没有对应的属性。</p>
<p>注2：数据库连接池在初始化的时候会创建initialSize个连接，当有数据库操作时，会从池中取出一个连接。如果当前池中正在使用的连接数等于maxActive，则会等待一段时间，等待其他操作释放掉某一个连接，如果这个等待时间超过了maxWait，则会报错；如果当前正在使用的连接数没有达到maxActive，则判断当前是否空闲连接，如果有则直接使用空闲连接，如果没有则新建立一个连接。在连接使用完毕后，不是将其物理连接关闭，而是将其放入池中等待其他操作复用。</p>
<h3 id="8-9-3-DBCP连接池"><a href="#8-9-3-DBCP连接池" class="headerlink" title="8.9.3 DBCP连接池"></a>8.9.3 DBCP连接池</h3><p>DBCP是一个依赖Jakarta commons-pool对象池机制的数据库连接池.DBCP可以直接的在应用程序中使用，Tomcat的数据源使用的就是DBCP。</p>
<h4 id="DBCP连接池的使用"><a href="#DBCP连接池的使用" class="headerlink" title="DBCP连接池的使用"></a>DBCP连接池的使用</h4><ul>
<li><p>导入相应jar包</p>
<p>mysql-jdbc.jar</p>
<p>commons-dbcp.jar</p>
<p>commons-pool.jar</p>
</li>
<li><p>硬编码使用DBCP</p>
<p>所谓的硬编码方式就是在代码中添加配置</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHard</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">    <span class="comment">// 硬编码 使用DBCP连接池子</span></span><br><span class="line">    BasicDataSource source = <span class="keyword">new</span> BasicDataSource();</span><br><span class="line">    <span class="comment">//设置连接的信息</span></span><br><span class="line">    source.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">    source.setUrl(<span class="string">"jdbc:mysql://localhost:3306/day2"</span>);</span><br><span class="line">    source.setUsername(<span class="string">"root"</span>);</span><br><span class="line">    source.setPassword(<span class="string">"111"</span>);</span><br><span class="line">    Connection connection = source.getConnection();</span><br><span class="line">    String sql = <span class="string">"select * from student"</span>;</span><br><span class="line">    Statement createStatement = connection.createStatement();</span><br><span class="line">    ResultSet executeQuery = createStatement.executeQuery(sql);</span><br><span class="line">    <span class="keyword">while</span> (executeQuery.next()) &#123;</span><br><span class="line">    System.out.println(executeQuery.getString(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    connection.close(); <span class="comment">//回收</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>软编码使用DBCP</p>
<p>所谓的软编码,就是在项目中添加配置文件,这样就不需要每次代码中添加配合!</p>
<blockquote>
<p>项目中添加配置<br>文件名称: info.properties<br>文件位置: src下</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#连接设置</span><br><span class="line">driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql:<span class="comment">//localhost:3306/day2</span></span><br><span class="line">username=root</span><br><span class="line">password=<span class="number">111</span></span><br><span class="line">#&lt;!-- 初始化连接 --&gt;</span><br><span class="line">initialSize=<span class="number">10</span></span><br><span class="line">#最大连接数量</span><br><span class="line">maxActive=<span class="number">50</span></span><br><span class="line">#&lt;!-- 最大空闲连接 --&gt;</span><br><span class="line">maxIdle=<span class="number">20</span></span><br><span class="line">#&lt;!-- 最小空闲连接 --&gt;</span><br><span class="line">minIdle=<span class="number">5</span></span><br><span class="line">#&lt;!-- 超时等待时间以毫秒为单位 6000毫秒/1000等于60秒 --&gt;</span><br><span class="line">maxWait=<span class="number">6000</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>DButils工具类 代码实现</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建dbcp的工具类对象</span></span><br><span class="line"><span class="keyword">static</span> BasicDataSource datasource=<span class="keyword">new</span> BasicDataSource();</span><br><span class="line"><span class="comment">//2.加载驱动</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//加载属性文件</span></span><br><span class="line">        <span class="comment">//1.使用工具类 ，参数是属性文件的文件名（不要加后缀）</span></span><br><span class="line">        ResourceBundle bundle = ResourceBundle.getBundle(<span class="string">"db"</span>);</span><br><span class="line">        driverClass = bundle.getString(<span class="string">"driverclass"</span>);</span><br><span class="line">        url = bundle.getString(<span class="string">"url"</span>);</span><br><span class="line">        username = bundle.getString(<span class="string">"uname"</span>);</span><br><span class="line">        password = bundle.getString(<span class="string">"upass"</span>);</span><br><span class="line">        init=bundle.getString(<span class="string">"initsize"</span>);</span><br><span class="line">        <span class="comment">//2.将驱动地址等信息传递给dbcp</span></span><br><span class="line">        datasource.setDriverClassName(driverClass);</span><br><span class="line">        datasource.setUrl(url);</span><br><span class="line">        datasource.setUsername(username);</span><br><span class="line">        datasource.setPassword(password);</span><br><span class="line">        datasource.setInitialSize(Integer.parseInt(init));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.获得连接</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        con= datasource.getConnection();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> con;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="C3P0连接池"><a href="#C3P0连接池" class="headerlink" title="C3P0连接池"></a>C3P0连接池</h4><p>c3p0是一个开放源代码的JDBC连接池，它在lib目录中与Hibernate一起发布,包括了实现jdbc3和jdbc2扩展规范说明的Connection 和Statement 池的DataSources 对象。</p>
<ul>
<li><p>c3p0与dbcp区别</p>
<ol>
<li>dbcp没有自动回收空闲连接的功能，c3p0有自动回收空闲连接功能</li>
<li>dbcp需要手动设置配置文件，c3p0不需要手动设置</li>
</ol>
</li>
<li><p>实现方式</p>
<ol>
<li>手动设置 ComboPooledDataSource</li>
<li>加载配置文件方式</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src/c3p0-config.xml（文件名固定）</span><br><span class="line">ComboPooledDataSource cpds = new ComboPooledDataSource();</span><br><span class="line">加载 文件中 <span class="tag">&lt;<span class="name">default-config</span>&gt;</span>中的配置</span><br><span class="line">ComboPooledDataSource cpds = new ComboPooledDataSource("aaa");</span><br><span class="line">加载 <span class="tag">&lt;<span class="name">named-config</span> <span class="attr">name</span>=<span class="string">"aaa"</span>&gt;</span> 中的配置</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现步骤</p>
<ul>
<li>导入jar包<br>c3p0-0.9.1.2.jar<br>mysql-connector-java-5.0.8.jar</li>
<li>添加配置文件</li>
</ul>
<blockquote>
<p>c3p0是在外部添加配置文件,工具直接进行应用,因为直接引用,所以要求固定的命名和文件位置<br>文件位置: src<br>文件命名:c3p0-config.xml/c3p0-config.properties</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 默认配置，如果没有指定则使用这个配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">default-config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 基本配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span>&gt;</span>jdbc:mysql://localhost:3306/day2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>111<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--扩展配置--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接超过30秒报错--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"checkoutTimeout"</span>&gt;</span>30000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--30秒检查空闲连接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleConnectionTestPeriod"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 30秒不适用丢弃--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdleTime"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxStatements"</span>&gt;</span>200<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">default-config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 命名的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">named-config</span> <span class="attr">name</span>=<span class="string">"abc"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span>&gt;</span>jdbc:mysql://localhost:3306/day2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>111<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果池中数据连接不够时一次增长多少个 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"acquireIncrement"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span>&gt;</span>40<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxStatements"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxStatementsPerConnection"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">named-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c3p0-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注意: </p>
<p>c3p0的配置文件内部可以包含命名配置文件和默认配置文件!默认是选择默认配置!如果需要切换命名配置可以在创建c3p0连接池的时候填入命名即可!</p>
</li>
<li><p>```java<br>Connection con=null;<br>ComboPooledDataSource db=new ComboPooledDataSource(“abc”);<br>public Connection getCon(){<br>try {<br>con=db.getConnection();<br>System.out.println(“初始化的链接数量:”+db.getInitialPoolSize());<br>} catch (SQLException e) {<br>e.printStackTrace();<br>}<br>return con;<br>}</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### <span class="constructor">Druid(德鲁伊)</span>连接池</span><br><span class="line"></span><br><span class="line">阿里出品，淘宝和支付宝专用数据库连接池，但它不仅仅是一个数据库连接池，它还包含一个ProxyDriver（代理驱动），一系列内置的JDBC组件库，一个SQL <span class="constructor">Parser(<span class="params">sql</span>解析器)</span>。支持所有JDBC兼容的数据库，包括Oracle、MySql、Derby、Postgresql、SQL Server、H2等等。Druid针对Oracle和MySql做了特别优化，比如Oracle的PS Cache内存占用优化，MySql的ping检测优化。</span><br><span class="line">Druid提供了MySql、Oracle、Postgresql、SQL-<span class="number">92</span>的SQL的完整支持，这是一个手写的高性能SQLParser，支持Visitor模式，使得分析SQL的抽象语法树很方便。简单SQL语句用时<span class="number">10</span>微秒以内，复杂SQL用时<span class="number">30</span>微秒。通过Druid提供的SQL Parser可以在JDBC层拦截SQL做相应处理，比如说分库分表、审计等。Druid防御SQL注入攻击的WallFilter就是通过Druid的SQL Parser分析语义实现的。Druid 是目前比较流行的高性能的，分布式列存储的OLAP框架(具体来说是MOLAP)。它有如下几个特点：</span><br><span class="line">一. 亚秒级查询</span><br><span class="line">druid提供了快速的聚合能力以及亚秒级的OLAP查询能力，多租户的设计，是面向用户分析应用的理想方式。</span><br><span class="line">二.实时数据注入</span><br><span class="line">druid支持流数据的注入，并提供了数据的事件驱动，保证在实时和离线环境下事件的实效性和统一性</span><br><span class="line">三.可扩展的PB级存储</span><br><span class="line">druid集群可以很方便的扩容到PB的数据量，每秒百 万级别的数据注入。即便在加大数据规模的情况下，也能保证时其效性</span><br><span class="line">四.多环境部署</span><br><span class="line">druid既可以运行在商业的硬件上，也可以运行在云上。它可以从多种数据系统中注入数据，包括hadoop，spark，kafka，storm和samza等</span><br><span class="line">五.丰富的社区</span><br><span class="line">druid拥有丰富的社区，供大家学习</span><br><span class="line"></span><br><span class="line">- 使用步骤</span><br><span class="line"></span><br><span class="line">  导入jar包</span><br><span class="line"></span><br><span class="line">  编写工具类</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 阿里的数据库连接池</span></span><br><span class="line"><span class="comment">* 性能最好的</span></span><br><span class="line"><span class="comment">* Druid</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line">public <span class="keyword">class</span> DruidUtils &#123;</span><br><span class="line">    <span class="comment">//声明连接池对象</span></span><br><span class="line">    <span class="keyword">private</span> static DruidDataSource ds;</span><br><span class="line">    static&#123;</span><br><span class="line">        <span class="comment">///实例化数据库连接池对象</span></span><br><span class="line">        ds=<span class="keyword">new</span> <span class="constructor">DruidDataSource()</span>;</span><br><span class="line">        <span class="comment">//实例化配置对象</span></span><br><span class="line">        Properties properties=<span class="keyword">new</span> <span class="constructor">Properties()</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//加载配置文件内容</span></span><br><span class="line">            properties.load(<span class="module-access"><span class="module"><span class="identifier">DruidUtils</span>.</span></span><span class="keyword">class</span>.get<span class="constructor">ResourceAsStream(<span class="string">"dbcpconfig.properties"</span>)</span>);</span><br><span class="line">            <span class="comment">//设置驱动类全称</span></span><br><span class="line">            ds.set<span class="constructor">DriverClassName(<span class="params">properties</span>.<span class="params">getProperty</span>(<span class="string">"driverClassName"</span>)</span>);</span><br><span class="line">            <span class="comment">//设置连接的数据库</span></span><br><span class="line">            ds.set<span class="constructor">Url(<span class="params">properties</span>.<span class="params">getProperty</span>(<span class="string">"url"</span>)</span>);</span><br><span class="line">            <span class="comment">//设置用户名</span></span><br><span class="line">            ds.set<span class="constructor">Username(<span class="params">properties</span>.<span class="params">getProperty</span>(<span class="string">"username"</span>)</span>);</span><br><span class="line">            <span class="comment">//设置密码</span></span><br><span class="line">            ds.set<span class="constructor">Password(<span class="params">properties</span>.<span class="params">getProperty</span>(<span class="string">"password"</span>)</span>);</span><br><span class="line">            <span class="comment">//设置最大连接数量</span></span><br><span class="line">            ds.set<span class="constructor">MaxActive(Integer.<span class="params">parseInt</span>(<span class="params">properties</span>.<span class="params">getProperty</span>(<span class="string">"maxActive"</span>)</span>));</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取连接对象</span></span><br><span class="line">    public static Connection get<span class="constructor">Connection()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            return ds.get<span class="constructor">Connection()</span>;</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注:在Druid连接池的配置中，driverClassName可配可不配，如果不配置会根据url自动识别dbType(数据库类型)，然后选择相应的driverClassName。</p>
<h1 id="9-实例和问题"><a href="#9-实例和问题" class="headerlink" title="9. 实例和问题"></a>9. 实例和问题</h1><blockquote>
<p>project：day44_JDBC</p>
</blockquote>
<h2 id="9-1-PreparedStatement状态通道的占位符"><a href="#9-1-PreparedStatement状态通道的占位符" class="headerlink" title="9.1 PreparedStatement状态通道的占位符"></a>9.1 PreparedStatement状态通道的占位符</h2><p>只能对where后的参数进行占位，在将如下sql语句传入后执行报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql=<span class="string">"update airinfo set flightId=?, flightNum=?,address=?,date=? where flightId=?"</span>;</span><br></pre></td></tr></table></figure>
<p>修改如下：</p>
<figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"update airinfo set </span></span><br><span class="line"><span class="string">flightId="</span>+a.getFlightId()+<span class="string">",</span></span><br><span class="line"><span class="string">flightNum='</span><span class="string">"+a.getFlightNum()+"</span><span class="string">',</span></span><br><span class="line"><span class="string">address='</span><span class="string">"+a.getAddress()+"</span><span class="string">',</span></span><br><span class="line"><span class="string">date='</span><span class="string">"+a.getDate()+"</span><span class="string">' </span></span><br><span class="line"><span class="string">where flightId=?"</span>;</span><br></pre></td></tr></table></figure>
<p>注意：每个字符类型的数据在加入字符串时需要用单引号包裹</p>
<h2 id="9-2-“-t”占位符的使用"><a href="#9-2-“-t”占位符的使用" class="headerlink" title="9.2 “\t”占位符的使用"></a>9.2 “\t”占位符的使用</h2><p>java里的\t是补全当前字符串长度到8的整数倍，最少1个最多8个空格。补多少要看你\t前字符串长度，比如当前字符串长度10，那么\t后长度是16，也就是补6个空格，如果当前字符串长度12，此时\t后长度是16，补4个空格</p>
<p>这就导致可能无法对齐的情况，我的解决方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(address.length()&gt;=<span class="number">8</span>) </span><br><span class="line">            <span class="keyword">return</span>  flightId + <span class="string">"\t\t"</span> + flightNum + <span class="string">"\t\t"</span> + address +<span class="string">"\t"</span> +  date+ <span class="string">"\t\t"</span> ;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">return</span>  flightId + <span class="string">"\t\t"</span> + flightNum + <span class="string">"\t\t"</span> + address +<span class="string">"\t\t"</span> +  date+ <span class="string">"\t\t"</span> ;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>因为address的长度在8以下和以上都存在</p>
<h2 id="9-3-数据库为设置时区信息导致报错"><a href="#9-3-数据库为设置时区信息导致报错" class="headerlink" title="9.3 数据库为设置时区信息导致报错"></a>9.3 数据库为设置时区信息导致报错</h2><ul>
<li><p>错误日志</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.sql.SQLException: The server time zone value <span class="string">'�й���׼ʱ��'</span> is unrecognized or represents more than one time zone. <span class="function">You must configure either the server or JDBC <span class="title">driver</span> <span class="params">(via the serverTimezone configuration property)</span> to use a more specifc time zone value <span class="keyword">if</span> you want to utilize time zone support.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>解决方法</p>
<ul>
<li><p><strong>解决办法1</strong>：修改数据库时区</p>
<p>在cmd命令中进入mysql输入如下命令即可</p>
</li>
<li><p><strong>解决办法2</strong>：在MySQL的配置文件my.ini中加入</p>
<p><code>default-time_zone = &#39;+8:00&#39;</code></p>
</li>
<li><p><strong>解决办法3</strong>：根据提示需要在配置数据库的连接信息中，在MySQL的URL后面加上“<strong>?serverTimezone=UTC</strong>” ，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">url=jdbc:mysql:<span class="comment">//localhost:3306/yhp?serverTimezone=UTC</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/09/03/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%BA%BF%E7%A8%8B/" rel="next" title="操作系统-线程">
                <i class="fa fa-chevron-left"></i> 操作系统-线程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/10/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="prev" title="计算机网络">
                计算机网络 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="xujunjie'blog" />
            
              <p class="site-author-name" itemprop="name">xujunjie'blog</p>
              <p class="site-description motion-element" itemprop="description">使一个人有限的生命更加有效也即等于延长了人的生命</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">67</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-数据库简介"><span class="nav-text">1. 数据库简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-简介"><span class="nav-text">1.1 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-常见数据库管理系统"><span class="nav-text">1.2 常见数据库管理系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-三大范式（规范）"><span class="nav-text">1.3 三大范式（规范）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-MySQL安装和卸载"><span class="nav-text">1.4 MySQL安装和卸载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-1-安装"><span class="nav-text">1.4.1 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-2-卸载"><span class="nav-text">1.4.2 卸载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-数据库的导入和导出"><span class="nav-text">1.5 数据库的导入和导出</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-SQL语言"><span class="nav-text">2. SQL语言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-概述"><span class="nav-text">2.1 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-DDL-数据定义"><span class="nav-text">2.2 DDL(数据定义)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-DDL操作表"><span class="nav-text">2.3 DDL操作表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-创建新表"><span class="nav-text">2.3.1 创建新表:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-CRUD"><span class="nav-text">2.3.2 CRUD</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-DML（数据操作）"><span class="nav-text">2.4 DML（数据操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-插入操作：INSERT"><span class="nav-text">2.4.1 插入操作：INSERT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2-修改操作：update"><span class="nav-text">2.4.2 修改操作：update</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-3-删除操作：DELETE"><span class="nav-text">2.4.3 删除操作：DELETE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-DCL（数据控制）"><span class="nav-text">2.5 DCL（数据控制）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-1-创建用户"><span class="nav-text">2.5.1 创建用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-2-用户授权"><span class="nav-text">2.5.2 用户授权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-3-用户权限查询"><span class="nav-text">2.5.3 用户权限查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-4-撤销用户权限"><span class="nav-text">2.5.4 撤销用户权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-5-删除用户"><span class="nav-text">2.5.5 删除用户</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-DQL数据查询"><span class="nav-text">2.6 DQL数据查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1-简单查询"><span class="nav-text">2.6.1 简单查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-2-条件查询"><span class="nav-text">2.6.2 条件查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-3-模糊查询"><span class="nav-text">2.6.3 模糊查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-4-字段控制查询"><span class="nav-text">2.6.4 字段控制查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-5-排序"><span class="nav-text">2.6.5 排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-6-聚合函数"><span class="nav-text">2.6.6 聚合函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-7-分组查询"><span class="nav-text">2.6.7 分组查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-8-having"><span class="nav-text">2.6.8 having</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-9-limit（分页"><span class="nav-text">2.6.9 limit（分页)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-总结"><span class="nav-text">2.6 总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-客户端工具"><span class="nav-text">2.7 客户端工具</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-数据库高级"><span class="nav-text">3. 数据库高级</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-数据库的完整性"><span class="nav-text">3.1 数据库的完整性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-实体完整性（记录）"><span class="nav-text">3.2 实体完整性（记录）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-域完整性"><span class="nav-text">3.3 域完整性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-数据类型"><span class="nav-text">3.3.1 数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-非空和默认约束（not-null-default）"><span class="nav-text">3.3.2 非空和默认约束（not null&#x2F;default）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-引用完整性"><span class="nav-text">3.4 引用完整性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-多表查询（联查）"><span class="nav-text">4. 多表查询（联查）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-多表的关系"><span class="nav-text">4.1 多表的关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-一对多-多对一关系"><span class="nav-text">4.1.1 一对多&#x2F;多对一关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-多对多关系"><span class="nav-text">4.1.2 多对多关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-3-一对一关系"><span class="nav-text">4.1.3 一对一关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-多表查询方式"><span class="nav-text">4.2 多表查询方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-合并结果集"><span class="nav-text">4.2.1 合并结果集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-连接查询"><span class="nav-text">4.2.2 连接查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-连接查询-内联查询"><span class="nav-text">4.2.3 连接查询-内联查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-连接查询-外联查询"><span class="nav-text">4.3.3 连接查询-外联查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-连接查询-自然连接"><span class="nav-text">4.3.4 连接查询-自然连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-5-子查询"><span class="nav-text">4.3.5 子查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-扩展"><span class="nav-text">5. 扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-多表更新（多表联调）"><span class="nav-text">5.1 多表更新（多表联调）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-多表删除"><span class="nav-text">5.2 多表删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-日期运算函数"><span class="nav-text">5.3 日期运算函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-数据库优化"><span class="nav-text">6. 数据库优化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-数据库进阶-事务"><span class="nav-text">7. 数据库进阶-事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-事务的语法"><span class="nav-text">7.1 事务的语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-事务的特性-ACID"><span class="nav-text">7.2 事务的特性-ACID</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-事务的并发问题"><span class="nav-text">7.3 事务的并发问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-事务的隔离级别-解决并发问题"><span class="nav-text">7.4 事务的隔离级别-解决并发问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-5-不同的隔离级别的锁的情况-了解"><span class="nav-text">7.5 不同的隔离级别的锁的情况(了解)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-6-乐观锁和悲观锁"><span class="nav-text">7.6 乐观锁和悲观锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-1-概念"><span class="nav-text">7.6.1 概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-2-悲观锁-Pessimistic-Lock"><span class="nav-text">7.6.2 悲观锁(Pessimistic Lock)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#啥是悲观锁（咋悲观的）"><span class="nav-text">啥是悲观锁（咋悲观的）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#悲观锁的分类"><span class="nav-text">悲观锁的分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#缺点"><span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-3-乐观锁-Optimistic-Locking"><span class="nav-text">7.6.3 乐观锁(Optimistic Locking)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-4-两种锁的具体实现"><span class="nav-text">7.6.4 两种锁的具体实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-5-CAS的理解"><span class="nav-text">7.6.5 CAS的理解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-JDBC"><span class="nav-text">8. JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-概念"><span class="nav-text">8.1 概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JDBC体系结构"><span class="nav-text">JDBC体系结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JDBC核心组件"><span class="nav-text">JDBC核心组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-使用步骤"><span class="nav-text">8.2 使用步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#增删改"><span class="nav-text">增删改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-SQL注入"><span class="nav-text">8.3 SQL注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#预状态通道PreparedStatement"><span class="nav-text">预状态通道PreparedStatement</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-多表关系操作"><span class="nav-text">8.4 多表关系操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-1-一对多和多对一"><span class="nav-text">8.4.1 一对多和多对一</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一对多（老师-学生）"><span class="nav-text">一对多（老师-学生）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多对一（学生-老师）"><span class="nav-text">多对一（学生-老师）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-2-一对一（妻子丈夫）"><span class="nav-text">8.4.2 一对一（妻子丈夫）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-3-多对多-科目-学生"><span class="nav-text">8.4.3 多对多(科目-学生)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-JDBC-事务应用"><span class="nav-text">8.5 JDBC 事务应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Savepoints"><span class="nav-text">Savepoints</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-批处理"><span class="nav-text">8.6 批处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-6-1-Statement批处理"><span class="nav-text">8.6.1 Statement批处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-6-2-PreparedStatement批处理"><span class="nav-text">8.6.2 PreparedStatement批处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-7-反射处理结果集"><span class="nav-text">8.7 反射处理结果集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-8-封装工具类"><span class="nav-text">8.8 封装工具类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-8-1-属性文件"><span class="nav-text">8.8.1 属性文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-9-连接池"><span class="nav-text">8.9 连接池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-9-1-自定义连接池"><span class="nav-text">8.9.1 自定义连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-9-2-java规范实现连接池"><span class="nav-text">8.9.2 java规范实现连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-9-3-DBCP连接池"><span class="nav-text">8.9.3 DBCP连接池</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DBCP连接池的使用"><span class="nav-text">DBCP连接池的使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#C3P0连接池"><span class="nav-text">C3P0连接池</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-实例和问题"><span class="nav-text">9. 实例和问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-PreparedStatement状态通道的占位符"><span class="nav-text">9.1 PreparedStatement状态通道的占位符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-“-t”占位符的使用"><span class="nav-text">9.2 “\t”占位符的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-数据库为设置时区信息导致报错"><span class="nav-text">9.3 数据库为设置时区信息导致报错</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xujunjie'blog</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>


  
  <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>


  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "./public/search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  

</body>
</html>
